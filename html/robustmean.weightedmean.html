
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module robustmean.weightedmean</title>
<meta name="description" content="Documentation of Coq module robustmean.weightedmean" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init('proofscript')">
<h1 class="title">Module robustmean.weightedmean</h1>
<div class="coq">
<span class="vernacular">From</span> <span class="id">mathcomp</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.all_ssreflect.html">all_ssreflect</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssralg.html">ssralg</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssrnum.html">ssrnum</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.matrix.html">matrix</a></span>.<br/>
<span class="vernacular">From</span> <span class="id">mathcomp</span> <span class="vernacular">Require</span> <span class="id"><a href="NOTFOUND the module url for mathcomp.classical.boolp">boolp</a></span>.<br/>
<span class="vernacular">From</span> <span class="id">mathcomp</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id"><a href="NOTFOUND the module url for mathcomp.analysis.Rstruct">Rstruct</a></span> <span class="id"><a href="NOTFOUND the module url for mathcomp.analysis.reals">reals</a></span> <span class="id"><a href="NOTFOUND the module url for mathcomp.classical.mathcomp_extra">mathcomp_extra</a></span>.<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Reals.html">Reals</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.micromega.Lra.html">Lra</a></span>.<br/>
<span class="vernacular">From</span> <span class="id">infotheo</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR">ssrR</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.Reals_ext">Reals_ext</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.realType_ext">realType_ext</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.logb">logb</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssr_ext">ssr_ext</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssralg_ext">ssralg_ext</a></span>.<br/>
<span class="vernacular">From</span> <span class="id">infotheo</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.bigop_ext">bigop_ext</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.fdist">fdist</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba">proba</a></span>.<br/>
<br/>
<br/>
<span class="gallina-kwd">Set</span> <span class="vernacular">Implicit</span> <span class="vernacular">Arguments</span>.<br/>
<span class="vernacular">Unset</span> <span class="vernacular">Strict</span> <span class="vernacular">Implicit</span>.<br/>
<span class="vernacular">Unset</span> <span class="vernacular">Printing</span> <span class="vernacular">Implicit</span> <span class="vernacular">Defensive</span>.<br/>
<br/>
<span class="vernacular">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">R_scope</span>.<br/>
<span class="vernacular">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">reals_ext_scope</span>.<br/>
<span class="vernacular">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">fdist_scope</span>.<br/>
<span class="vernacular">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">proba_scope</span>.<br/>
<br/>
<span class="vernacular">Import</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#Order.POrderTheory">Order.POrderTheory</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#Order.Theory">Order.Theory</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssrnum.html#Num.Theory">Num.Theory</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssralg.html#GRing.Theory">GRing.Theory</a></span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span id="R" class="id"><a name="R" class="">R</a></span> <span class="id">:=</span> <span class="id"><a href="NOTFOUND the module url for mathcomp.analysis.Rstruct#real_realType">real_realType</a></span>.<br/>
<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id"><a href="NOTFOUND the module url for Interval.Tactic">Interval.Tactic</a></span>.<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id"><a href="robustmean.robustmean.html">robustmean</a></span>.<br/>
<br/>
<pre class="ssrdoc">
                                                                           
    mu_hat == empirical/estimate mean of the data,                         
              weighted mean of all the points                              
   var_hat == empirical variance                                           
     tau i == (x i - mu_hat)^2                                             
   mu_wave == mean of the at least 1 - epsilon fraction (under c) of       
              remaining good points                                        
 invariant == the amount of mass removed from the good points is smaller   
              than that removed from the bad points.                       
   is_01 C := forall i, 0 &lt;= C i &lt;= 1                                      
invariant1 == consequence of invariant (p.62,l.-1)                         
  filter1d == robust mean estimation by comparing mean and variance        
                                                                           
</pre>
<br/>
<span class="vernacular">Section</span> <span id="move_to_infotheo" class="id"><a name="move_to_infotheo" class="">move_to_infotheo</a></span>.<br/>
<span class="vernacular">Section</span> <span id="move_to_infotheo.rExtrema" class="id"><a name="move_to_infotheo.rExtrema" class="">rExtrema</a></span>. <br/>
<span class="vernacular">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">ring_scope</span>.<br/>
<span class="vernacular">Variables</span> (<span id="move_to_infotheo.rExtrema.I" class="id"><a name="move_to_infotheo.rExtrema.I" class="">I</a></span> <span class="id">:</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.fintype.html#Finite.Exports.finType">finType</a></span>) (<span id="move_to_infotheo.rExtrema.i0" class="id"><a name="move_to_infotheo.rExtrema.i0" class="">i0</a></span> <span class="id">:</span> <span class="id"><a href="robustmean.weightedmean.html#I:1">I</a></span>) (<span id="move_to_infotheo.rExtrema.F" class="id"><a name="move_to_infotheo.rExtrema.F" class="">F</a></span> <span class="id">:</span> <span class="id"><a href="robustmean.weightedmean.html#I:1">I</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x">-&gt;</a></span> <span class="id"><a href="robustmean.robustmean.html#R">R</a></span>) (<span id="move_to_infotheo.rExtrema.P" class="id"><a name="move_to_infotheo.rExtrema.P" class="">P</a></span> <span class="id">:</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#64f8873130736b599801d4930af00e74">{pred</a></span> <span class="id"><a href="robustmean.weightedmean.html#I:1">I}</a></span>).<br/>
<span class="vernacular">Lemma</span> <span id="arg_rmax2_cond" class="id"><a name="arg_rmax2_cond" class="">arg_rmax2_cond</a></span> <span class="id">:</span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.rExtrema.P">P</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.rExtrema.i0">i0</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x">-&gt;</a></span> <span class="gallina-kwd">forall</span> <span id="j:5" class="id"><a name="j:5" class="">j,</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.rExtrema.P">P</a></span> <span class="id"><a href="robustmean.weightedmean.html#j:5">j</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x">-&gt;</a></span> (<span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.rExtrema.F">F</a></span> <span class="id"><a href="robustmean.weightedmean.html#j:5">j</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#6267442e1f81ed96252446fa7b1c579b">&lt;=</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.rExtrema.F">F</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#cc13311bd8d6ef35a7c1186b7a1a4c3d">[arg</a></span> <span class="id">max_</span>(<span id="i:7" class="id"><span id="i:6" class="id"><a name="i:7" class="">i</a></span></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#cc13311bd8d6ef35a7c1186b7a1a4c3d">&gt;</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.rExtrema.i0">i0</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#cc13311bd8d6ef35a7c1186b7a1a4c3d">|</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.rExtrema.P">P</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:6">i</a></span>) <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.rExtrema.F">F</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:7">i]%O</a></span>)<span class="id">%O</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
<span class="id">move=&gt;</span> <span class="id">Pi0</span> <span class="id">j</span> <span class="id">Pj;</span> <span class="id">case:</span> (<span class="id">@Order</span>.<span class="id">TotalTheory.arg_maxP</span> <span class="id">_</span> <span class="id">_</span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.rExtrema.I">I</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.rExtrema.i0">i0</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.rExtrema.P">P</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.rExtrema.F">F</a></span> <span class="id">Pi0</span>) <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">move/</span>(<span class="id">_</span> <span class="id">j</span> <span class="id">Pj</span>).<br/>
Qed.</div>
<span class="vernacular">End</span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.rExtrema">rExtrema</a></span>.<br/>
<br/>
<span class="vernacular">Section</span> <span id="move_to_infotheo.nneg_fun" class="id"><a name="move_to_infotheo.nneg_fun" class="">nneg_fun</a></span>. <br/>
<br/>
<span class="vernacular">Lemma</span> <span id="nneg_fun_le0" class="id"><a name="nneg_fun_le0" class="">nneg_fun_le0</a></span> (<span id="I:8" class="id"><a name="I:8" class="">I</a></span> <span class="id">:</span> <span class="gallina-kwd">Type</span>) (<span id="F:9" class="id"><a name="F:9" class="">F</a></span> <span class="id">:</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.Reals_ext#nneg_fun">nneg_fun</a></span> <span class="id"><a href="robustmean.weightedmean.html#I:8">I</a></span>) <span id="i:10" class="id"><a name="i:10" class="">i</a></span> <span class="id">:</span> (<span class="id"><a href="robustmean.weightedmean.html#F:9">F</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:10">i</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#df45e8c2e8370fd4f0f7c4fdaf208180">==</a></span> <span class="id">0</span>) <span class="id">=</span> (<span class="id"><a href="robustmean.weightedmean.html#F:9">F</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:10">i</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssrnum.html#cb42ec59ad57b25928e1718b4e69e031">&lt;=</a></span> <span class="id">0</span>)<span class="id">%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</span></div>
<div class="proofscript" id="proof2">
<span class="id">apply/sameP/idP/</span>(<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#iffP">iffP</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#idP">idP</a></span>)<span class="id">;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">move/eqP-&gt;</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">move/RleP/Rle_antisym/</span>(<span class="id">_</span> (<span class="id"><a href="NOTFOUND the module url for infotheo.lib.Reals_ext#nneg_f_ge0">nneg_f_ge0</a></span> <span class="id">_</span> <span class="id">_</span>)) <span class="id">-&gt;</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Variables</span> (<span id="move_to_infotheo.nneg_fun.I" class="id"><a name="move_to_infotheo.nneg_fun.I" class="">I</a></span> <span class="id">:</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#Equality.Exports.eqType">eqType</a></span>) (<span id="move_to_infotheo.nneg_fun.r" class="id"><a name="move_to_infotheo.nneg_fun.r" class="">r</a></span> <span class="id">:</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="robustmean.weightedmean.html#I:11">I</a></span>) (<span id="move_to_infotheo.nneg_fun.P" class="id"><a name="move_to_infotheo.nneg_fun.P" class="">P</a></span> <span class="id">:</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#pred">pred</a></span> <span class="id"><a href="robustmean.weightedmean.html#I:11">I</a></span>) (<span id="move_to_infotheo.nneg_fun.F" class="id"><a name="move_to_infotheo.nneg_fun.F" class="">F</a></span> <span class="id">:</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.Reals_ext#nneg_fun">nneg_fun</a></span> <span class="id"><a href="robustmean.weightedmean.html#I:11">I</a></span>).<br/>
<span class="vernacular">Lemma</span> <span id="nneg_fun_bigmaxR0P" class="id"><a name="nneg_fun_bigmaxR0P" class="">nneg_fun_bigmaxR0P</a></span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#reflect">reflect</a></span> (<span class="gallina-kwd">forall</span> <span id="i:15" class="id"><a name="i:15" class="">i</a></span> <span class="id">:</span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_fun.I">I,</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:15">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#b09457274bcb94927e289b8a9e9cd3f7">\in</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_fun.r">r</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x">-&gt;</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_fun.P">P</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:15">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x">-&gt;</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_fun.F">F</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:15">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">=</a></span> <span class="id">0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#3305435f10890efb5a23fed7dbc9cd01">\rmax_</a></span>(<span id="i:18" class="id"><span id="i:17" class="id"><span id="i:16" class="id"><a name="i:18" class="">i</a></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#3305435f10890efb5a23fed7dbc9cd01">&lt;-</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_fun.r">r</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#3305435f10890efb5a23fed7dbc9cd01">|</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_fun.P">P</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:16">i</a></span>) <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_fun.F">F</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:16">i</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#df45e8c2e8370fd4f0f7c4fdaf208180">==</a></span> <span class="id">0</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</span></div>
<div class="proofscript" id="proof3">
<span class="id">apply:</span> (<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#iffP">iffP</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#idP">idP</a></span>) <span class="id">=&gt;</span> <span class="id">[/eqP</span> <span class="id">H</span> <span class="id">i</span> <span class="id">ir</span> <span class="id">Pi|</span> <span class="id">H]</span>.<br/>
<span class="id">-</span> <span class="id">apply/eqP;</span> <span class="id">rewrite</span> <span class="id"><a href="robustmean.weightedmean.html#nneg_fun_le0">nneg_fun_le0</a></span> <span class="id">-coqRE</span> <span class="id">-H;</span> <span class="id">apply/RleP</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-big_filter;</span> <span class="id">apply:</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#leR_bigmaxR">leR_bigmaxR</a></span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#mem_filter">mem_filter</a></span> <span class="id">ir</span> <span class="id">Pi</span>.<br/>
<span class="id">-</span> <span class="id">rewrite</span> <span class="id">-big_filter</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#big_seq">big_seq</a></span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#eq_bigr">eq_bigr=&gt;</a></span> <span class="id">i</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#mem_filter">mem_filter=&gt;</a></span> <span class="id">/andP</span> <span class="id">[]</span> <span class="id">/[swap]</span> <span class="id">/</span>(<span class="id">H</span> <span class="id">i</span>) <span class="id">/[apply]</span> <span class="id">-&gt;</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-big_seq</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#big_const_seq">big_const_seq</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.ssrnat.html#iter_fix">iter_fix</a></span> <span class="id">//</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#maxRR">maxRR</a></span>.<br/>
Qed.</div>
<span class="vernacular">End</span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_fun">nneg_fun</a></span>.<br/>
<br/>
<span class="vernacular">Section</span> <span id="move_to_infotheo.nneg_finfun" class="id"><a name="move_to_infotheo.nneg_finfun" class="">nneg_finfun</a></span>. <br/>
<span class="vernacular">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">R_scope</span>.<br/>
<span class="vernacular">Lemma</span> <span id="nneg_finfun_le0" class="id"><a name="nneg_finfun_le0" class="">nneg_finfun_le0</a></span> (<span id="I:19" class="id"><a name="I:19" class="">I</a></span> <span class="id">:</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.fintype.html#Finite.Exports.finType">finType</a></span>) (<span id="F:20" class="id"><a name="F:20" class="">F</a></span> <span class="id">:</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.Reals_ext#nneg_finfun">nneg_finfun</a></span> <span class="id"><a href="robustmean.weightedmean.html#I:19">I</a></span>) <span id="i:21" class="id"><a name="i:21" class="">i</a></span> <span class="id">:</span> (<span class="id"><a href="robustmean.weightedmean.html#F:20">F</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:21">i</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#df45e8c2e8370fd4f0f7c4fdaf208180">==</a></span> <span class="id">0</span>) <span class="id">=</span> (<span class="id"><a href="robustmean.weightedmean.html#F:20">F</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:21">i</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssrnum.html#cb42ec59ad57b25928e1718b4e69e031">&lt;=</a></span> <span class="id">0</span>)<span class="id">%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
<span class="id">apply/idP/idP</span> <span class="id">=&gt;</span> <span class="id">[/eqP</span> <span class="id">-&gt;</span> <span class="id">//|]</span>.<br/>
<span class="id">case:</span> <span class="id">F</span> <span class="id">=&gt;</span> <span class="id">F</span> <span class="id">/=</span> <span class="id">/forallP</span> <span class="id">/</span>(<span class="id">_</span> <span class="id">i</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#Order.POrderTheory.eq_le">eq_le</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#coqRE">coqRE</a></span> <span class="id">=&gt;</span> <span class="id">-&gt;</span> <span class="id">-&gt;</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Variables</span> (<span id="move_to_infotheo.nneg_finfun.I" class="id"><a name="move_to_infotheo.nneg_finfun.I" class="">I</a></span> <span class="id">:</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.fintype.html#Finite.Exports.finType">finType</a></span>) (<span id="move_to_infotheo.nneg_finfun.r" class="id"><a name="move_to_infotheo.nneg_finfun.r" class="">r</a></span> <span class="id">:</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="robustmean.weightedmean.html#I:22">I</a></span>) (<span id="move_to_infotheo.nneg_finfun.P" class="id"><a name="move_to_infotheo.nneg_finfun.P" class="">P</a></span> <span class="id">:</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#pred">pred</a></span> <span class="id"><a href="robustmean.weightedmean.html#I:22">I</a></span>) (<span id="move_to_infotheo.nneg_finfun.F" class="id"><a name="move_to_infotheo.nneg_finfun.F" class="">F</a></span> <span class="id">:</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.Reals_ext#nneg_finfun">nneg_finfun</a></span> <span class="id"><a href="robustmean.weightedmean.html#I:22">I</a></span>).<br/>
<span class="vernacular">Fail</span> <span class="vernacular">Check</span> <span class="id">F</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssreflect.html#::core_scope:x_':'_x">:</a></span> <span class="id">pos_fun</span> <span class="id">_</span>. <br/>
<span class="vernacular">Lemma</span> <span id="pos_ffun_bigmaxR0P" class="id"><a name="pos_ffun_bigmaxR0P" class="">pos_ffun_bigmaxR0P</a></span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#reflect">reflect</a></span> (<span class="gallina-kwd">forall</span> <span id="i:26" class="id"><a name="i:26" class="">i</a></span> <span class="id">:</span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_finfun.I">I,</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:26">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#b09457274bcb94927e289b8a9e9cd3f7">\in</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_finfun.r">r</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x">-&gt;</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_finfun.P">P</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:26">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x">-&gt;</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_finfun.F">F</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:26">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">=</a></span> <span class="id">0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#3305435f10890efb5a23fed7dbc9cd01">\rmax_</a></span>(<span id="i:29" class="id"><span id="i:28" class="id"><span id="i:27" class="id"><a name="i:29" class="">i</a></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#3305435f10890efb5a23fed7dbc9cd01">&lt;-</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_finfun.r">r</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#3305435f10890efb5a23fed7dbc9cd01">|</a></span> <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_finfun.P">P</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:27">i</a></span>) <span class="id"><a href="robustmean.weightedmean.html#move_to_infotheo.nneg_finfun.F">F</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:27">i</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#df45e8c2e8370fd4f0f7c4fdaf208180">==</a></span> <span class="id">0</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
<span class="id">apply:</span> (<span class="id">iffP</span> <span class="id">idP</span>) <span class="id">=&gt;</span> <span class="id">[/eqP</span> <span class="id">H</span> <span class="id">i</span> <span class="id">ir</span> <span class="id">Pi|H]</span>.<br/>
<span class="id">-</span> <span class="id">apply/eqP;</span> <span class="id">rewrite</span> <span class="id">nneg_finfun_le0</span> <span class="id">-coqRE</span> <span class="id">-H</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-big_filter;</span> <span class="id">apply/RleP;</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#leR_bigmaxR">apply:</a></span> <span class="id">leR_bigmaxR</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">mem_filter</span> <span class="id">ir</span> <span class="id">Pi</span>.<br/>
<span class="id">-</span> <span class="id">rewrite</span> <span class="id">-big_filter</span> <span class="id">big_seq</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id">eq_bigr=&gt;</span> <span class="id">i</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">mem_filter=&gt;</span> <span class="id">/andP</span> <span class="id">[]</span> <span class="id">/[swap]</span> <span class="id">/</span>(<span class="id">H</span> <span class="id">i</span>) <span class="id">/[apply]</span> <span class="id">-&gt;</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-big_seq</span> <span class="id">big_const_seq</span> <span class="id">iter_fix</span> <span class="id">//</span> <span class="id">maxRR</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">nneg_finfun</span>.<br/>
<span class="vernacular">End</span> <span class="id">move_to_infotheo</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">move_to_mathcomp</span>.<br/>
<span class="vernacular">Lemma</span> <span class="id">setT_bool</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Datatypes.html#bool">:</a></span> <span class="id">[set:</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#f714e54c16ed806ac79437fa972e90ff">bool]</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Datatypes.html#true">=</a></span> <span class="id">[set</span> <span class="id">true;</span> <span class="id">false]</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</span></div>
<div class="proofscript" id="proof6">
<span class="id">apply/eqP;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#eqEsubset">rewrite</a></span> <span class="id">eqEsubset;</span> <span class="id">apply/andP;</span> <span class="id">split</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply/subsetP</span> <span class="id">=&gt;</span> <span class="id">x;</span> <span class="id">rewrite</span> <span class="id">!inE;</span> <span class="id">case:</span> <span class="id">x</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">pmax_eq0</span> <span class="id">[I</span> <span class="id">:</span> <span class="id">eqType]</span> (<span class="id"><a href="robustmean.weightedmean.html#I:30">r</a></span> <span class="id">:</span> <span id="P:32" class="id"><a name="P:32" class="">seq</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#pred">I</a></span>) <span class="id">[P</span> <span class="id"><a href="robustmean.weightedmean.html#I:30">:</a></span> <span class="id">pred</span> <span class="id"><a href="robustmean.weightedmean.html#I:30">I]</a></span> <span class="id">[F</span> <span class="id"><a href="robustmean.robustmean.html#R">:</a></span> <span class="id">I</span> <span class="id">-&gt;</span> <span class="id">R]</span> <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#i:34">:</a></span> <span class="id">I,</span> <span class="id">P</span> <span class="id">i</span> <span class="id">-&gt;</span> (<span class="id">0</span> <span class="id">&lt;=</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x">F</a></span> <span class="id">i</span>)<span class="id">%mcR</span>) <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#3305435f10890efb5a23fed7dbc9cd01">-&gt;</a></span><br/>
&nbsp;&nbsp;((<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#3305435f10890efb5a23fed7dbc9cd01">\rmax_</a></span>(<span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#P:32">&lt;-</a></span> <span class="id">r</span> <span class="id"><a href="robustmean.weightedmean.html#F:33">|</a></span> <span class="id">P</span> <span class="id">i</span>) <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#df45e8c2e8370fd4f0f7c4fdaf208180">F</a></span> <span class="id">i</span>)<span class="id">%mcR</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">==</a></span> <span class="id">0%mcR</span>) <span class="id">=</span> <span class="id">all</span> (<span class="gallina-kwd">fun</span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#P:32">:</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#a133e82bab56729f895f9b2b31e837cd">I</a></span> <span class="id">=&gt;</span> <span class="id">P</span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#i:38">==&gt;</a></span> (<span class="id">F</span> <span class="id">i</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#a133e82bab56729f895f9b2b31e837cd">==</a></span> <span class="id"><a href="robustmean.weightedmean.html#r:31">0%mcR</a></span>)) <span class="id">r</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
<span class="id">elim:</span> <span class="id">r</span> <span class="id">=&gt;</span> <span class="id">/=</span> <span class="id">[|h</span> <span class="id">t</span> <span class="id">ih</span> <span class="id">PF0]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#big_nil">rewrite</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#eqxx">big_nil</a></span> <span class="id">eqxx</span>.<br/>
<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#big_cons">rewrite</a></span> <span class="id">big_cons</span>.<br/>
<span class="id">case:</span> <span class="id">ifP</span> <span class="id">=&gt;</span> <span class="id">Ph</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#implyTb">rewrite</a></span> <span class="id">implyTb;</span> <span class="id">apply/idP/andP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span> <span class="id">[Fh|Fh]</span> <span class="id">:=</span> <span class="id">leP</span> (<span class="id">F</span> <span class="id">h</span>) (<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#3305435f10890efb5a23fed7dbc9cd01">\rmax_</a></span>(<span class="id">j</span> <span class="id">&lt;-</span> <span class="id">t</span> <span class="id">|</span> <span class="id">P</span> <span class="id">j</span>) <span class="id">F</span> <span class="id">j</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rbasic_fun.html#Rmax_right">rewrite</a></span> <span class="id">Rmax_right//;</span> <span class="id">last</span> <span class="id">exact/RleP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span> <span class="id">tPF;</span> <span class="id">rewrite</span> <span class="id">-ih//;</span> <span class="id">split</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#Order.POrderTheory.eq_le">rewrite</a></span> <span class="id">eq_le</span> <span class="id">PF0//</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#eqP">andbT</a></span> <span class="id">-</span>(<span class="id">eqP</span> <span class="id">tPF</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rbasic_fun.html#Rmax_left">rewrite</a></span> <span class="id">Rmax_left//;</span> <span class="id">last</span> <span class="id">exact/ltRW/RltP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span> <span class="id">Fh0;</span> <span class="id">rewrite</span> <span class="id">Fh0;</span> <span class="id">split</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-ih//</span> <span class="id">eq_le;</span> <span class="id">apply/andP;</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-</span>(<span class="id">eqP</span> <span class="id">Fh0</span>)<span class="id"><a href="NOTFOUND the module url for mathcomp.analysis.Rstruct#RleP">;</a></span> <span class="id">exact/RleP/ltRW/RltP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/RleP;</span> <span class="id">rewrite</span> <span class="id">-big_filter;</span> <span class="id">apply/bigmaxR_ge0</span> <span class="id">=&gt;</span> <span class="id">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#mem_filter">rewrite</a></span> <span class="id">mem_filter</span> <span class="id">=&gt;</span> <span class="id">/andP[/PF0</span> <span class="id">/RleP]</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span> <span class="id">[/eqP</span> <span class="id">Fh0</span> <span class="id">/allP</span> <span class="id">tPF]</span>.<br/>
&nbsp;<span class="id">rewrite</span> <span class="id">Fh0;</span> <span class="id">apply/eqP/Rmax_left;</span> <span class="id">apply/leR_eqVlt;</span> <span class="id">left</span>.<br/>
&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply/eqP;</span> <span class="id">rewrite</span> <span class="id">ih//;</span> <span class="id">apply/allP</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#implyFb">rewrite</a></span> <span class="id">implyFb</span> <span class="id">/=</span> <span class="id">ih</span>.<br/>
Qed.</div>
<span class="vernacular">End</span> <span class="id">move_to_mathcomp</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">is_01</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">C</span> <span class="id"><a href="robustmean.weightedmean.html#U:42">:</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x">{ffun</a></span> <span class="id">U</span> <span class="id">-&gt;</span> <span class="id">R}</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span> <span class="id"><a href="robustmean.weightedmean.html#C:43">i,</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#fbdebc8c1a732d40499de973c18a9a13">0</a></span> <span class="id">&lt;=</span> <span class="id">C</span> <span class="id">i</span> <span class="id">&lt;=</span> <span class="id">1</span>).<br/>
<br/>
<div class="doc">given a distribution d0 and a non-negative function f,
    Weighted.d is the distribution a |-&gt; f a * d0 a / \sum_a f a * d0 a </div>
<span class="vernacular">Module</span> <span class="id">Weighted</span>.<br/>
<span class="vernacular">Section</span> <span class="id">def</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">d0</span> <span class="id">:</span> <span class="id"><a href="robustmean.weightedmean.html#A:45">{fdist</a></span> <span class="id">A}</span>) (<span class="id">c</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">A</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">total</span> <span class="id">:=</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="robustmean.weightedmean.html#Weighted.def.c">a</a></span> <span class="gallina-kwd">in</span> <span class="id">A</span>) <span class="id">c</span> <span class="id">a</span> <span class="id">*</span> <span class="id">d0</span> <span class="id">a</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span> <span class="id">total_neq0</span> <span class="id">:</span> <span class="id">total</span> <span class="id">!=</span> <span class="id">0</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">f</span> <span class="id">:=</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#f6cd22e759500ffb5ebfcc5c9dcc97ef">[ffun</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">a</a></span> <span class="id">=&gt;</span> <span class="id">c</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">a</a></span> <span class="id">*</span> <span class="id">d0</span> <span class="id">a</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#f6cd22e759500ffb5ebfcc5c9dcc97ef">/</a></span> <span class="id">total]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">total_gt0</span> <span class="id"><a href="robustmean.weightedmean.html#Weighted.total">:</a></span> (<span class="id">0</span> <span class="id">&lt;</span> <span class="id">total</span>)<span class="id">%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#Order.POrderTheory.lt_neqAle">rewrite</a></span> <span class="id">lt_neqAle</span> <span class="id">eq_sym</span> <span class="id">total_neq0/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">/total</span>.<br/>
<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssrnum.html#Num.Theory.sumr_ge0">rewrite</a></span> <span class="id">sumr_ge0//</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_</span>. <br/>
<span class="id">apply/mulr_ge0/FDist</span>.<span class="id">ge0</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">case:</span> <span class="id">c</span> <span class="id">=&gt;</span> <span class="id">c'</span> <span class="id">/=</span> <span class="id">/forallP</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Let</span> <span class="id">f0</span> <span class="id">a</span> <span class="id"><a href="robustmean.weightedmean.html#Weighted.f">:</a></span> (<span class="id">0</span> <span class="id">&lt;=</span> <span class="id">f</span> <span class="id">a</span>)<span class="id">%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</span></div>
<div class="proofscript" id="proof9">
<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#ffunE">rewrite</a></span> <span class="id">ffunE</span> <span class="id">/f</span> <span class="id">coqRE</span> <span class="id">divr_ge0//;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/ltW/total_gt0</span>.<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#coqRE">rewrite</a></span> <span class="id">coqRE</span> <span class="id">mulr_ge0</span> <span class="id">//</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">case:</span> <span class="id">c</span> <span class="id">=&gt;</span> <span class="id">?</span> <span class="id">/=</span> <span class="id">/forallP;</span> <span class="id">exact</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Let</span> <span class="id">f1</span> <span id="a:60" class="id"><span id="a:59" class="id"><span id="a:58" class="id"><span id="a:57" class="id"><span id="a:56" class="id"><a name="a:60" class="">:</a></span></span></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="robustmean.weightedmean.html#Weighted.f">a</a></span> <span class="gallina-kwd">in</span> <span class="id">A</span>) <span class="id">f</span> <span class="id">a</span> <span class="id">=</span> <span class="id">1</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</span></div>
<div class="proofscript" id="proof10">
<span class="id">rewrite</span> <span class="id">/f</span>.<br/>
<span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">do</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#ffunE">rewrite</a></span> <span class="id">ffunE</span> <span class="id">divRE</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-big_distrl</span> <span class="id">/=</span> <span class="id">mulRV</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">d</span> <span class="id">:</span> <span class="id"><a href="robustmean.weightedmean.html#Weighted.def.A">{fdist</a></span> <span class="id">A}</span> <span class="id">:=</span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.fdist#FDist.make">locked</a></span> (<span class="id">FDist.make</span> <span class="id">f0</span> <span class="id">f1</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">dE</span> <span class="id">a</span> <span class="id"><a href="robustmean.weightedmean.html#Weighted.def.c">:</a></span> <span class="id"><a href="robustmean.weightedmean.html#a:61">d</a></span> <span class="id">a</span> <span class="id"><a href="robustmean.weightedmean.html#Weighted.def.d0">=</a></span> <span class="id">c</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">a</a></span> <span class="id">*</span> <span class="id">d0</span> <span class="id">a</span> <span class="id">/</span> <span class="id">total</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</span></div>
<div class="proofscript" id="proof11">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/d;</span> <span class="id">unlock;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#ffunE">rewrite</a></span> <span class="id">ffunE</span>. Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">def</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">prop</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">d0</span> <span class="id">:</span> <span class="id"><a href="robustmean.weightedmean.html#A:62">{fdist</a></span> <span class="id">A}</span>) (<span class="id">p</span> <span class="id"><a href="robustmean.robustmean.html#R">:</a></span> <span class="id">prob</span> <span class="id">R</span>)  (<span class="id">c</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">A</span>).<br/>
<span class="vernacular">End</span> <span class="id">prop</span>.<br/>
<span class="vernacular">End</span> <span class="id">Weighted</span>.<br/>
<br/>
<span class="vernacular">Module</span> <span class="id">Split</span>.<br/>
<span class="vernacular">Section</span> <span class="id">def</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">d0</span> <span class="id">:</span> <span class="id"><a href="robustmean.weightedmean.html#A:66">{fdist</a></span> <span class="id">A}</span>) (<span class="id">c</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">A</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">g</span> <span id="x:69" class="id"><a name="x:69" class="">:=</a></span> <span class="gallina-kwd">fun</span> <span class="id"><a href="robustmean.weightedmean.html#x:69">x</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrfun.html#::pair_scope:x_'.2'">=&gt;</a></span> <span class="gallina-kwd">if</span> <span class="id">x</span>.<span class="id">2</span> <span class="gallina-kwd">then</span> <span class="id">c</span> <span class="id">x</span>.<span class="id">1</span> <span class="gallina-kwd">else</span> (<span class="id">1</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x">-</a></span> <span class="id">c</span> <span class="id">x</span>.<span class="id">1</span>).<br/>
<span class="vernacular">Hypothesis</span> <span class="id">weight_C</span> <span class="id"><a href="robustmean.weightedmean.html#Split.def.c">:</a></span> <span class="id">is_01</span> <span class="id">c</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">f</span> <span class="id">:=</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#f6cd22e759500ffb5ebfcc5c9dcc97ef">[ffun</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">x</a></span> <span class="id">=&gt;</span> <span class="id">g</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrfun.html#::pair_scope:x_'.1'">x</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#f6cd22e759500ffb5ebfcc5c9dcc97ef">*</a></span> <span class="id">d0</span> <span class="id">x</span>.<span class="id">1]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">g_ge0</span> <span class="id">x</span> <span class="id"><a href="robustmean.weightedmean.html#Split.g">:</a></span> (<span class="id">0</span> <span class="id">&lt;=</span> <span class="id">g</span> <span class="id">x</span>)<span class="id">%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</span></div>
<div class="proofscript" id="proof12">
<span class="id"><a href="robustmean.weightedmean.html#Split.g">rewrite/g</a></span>.<br/>
<span class="id">case:</span> <span class="id">ifPn</span> <span class="id">=&gt;</span> <span class="id">_</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">case:</span> <span class="id">c</span> <span class="id">=&gt;</span> <span class="id">c'</span> <span class="id">/=</span> <span class="id">/forallP</span>.<br/>
<span class="id">have</span> <span class="id">[_</span> <span class="id">?]</span> <span class="id">:=</span> <span class="id">weight_C</span> <span class="id">x</span>.<span class="id">1</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply/RleP;</span> <span class="id">apply</span> <span class="id">subR_ge0</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Let</span> <span class="id">f0</span> <span class="id">a</span> <span class="id"><a href="robustmean.weightedmean.html#Split.f">:</a></span> (<span class="id">0</span> <span class="id">&lt;=</span> <span class="id">f</span> <span class="id">a</span>)<span class="id">%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</span></div>
<div class="proofscript" id="proof13">
<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#ffunE">rewrite</a></span> <span class="id">ffunE</span> <span class="id">/f</span> <span class="id">coqRE</span>.<br/>
<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssrnum.html#Num.Theory.mulr_ge0">rewrite</a></span> <span class="id">mulr_ge0</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
<span class="id">exact:</span> <span class="id">g_ge0</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Let</span> <span class="id">f1</span> <span id="a:76" class="id"><span id="a:75" class="id"><span id="a:74" class="id"><a name="a:76" class="">:</a></span></span></span> <span class="id"><a href="robustmean.weightedmean.html#Split.f">\sum_a</a></span> <span class="id">f</span> <span class="id">a</span> <span class="id">=</span> <span class="id">1</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</span></div>
<div class="proofscript" id="proof14">
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">x</span> <span class="gallina-kwd">in</span> (<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssr_ext#dc2312b445cefe5154d72c71c36b35ce">[set:</a></span> <span class="id">A]</span> <span class="id">`*</span> <span class="id">setT</span>)<span class="id"><a href="robustmean.weightedmean.html#x:77">%SET</a></span>) <span class="id">f</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">eq_bigl</span> <span class="id">=&gt;</span> <span class="id">/=</span> <span class="id">-[a</span> <span class="id">b];</span> <span class="id">rewrite</span> <span class="id">!inE</span>.<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.bigop_ext#big_setX">rewrite</a></span> <span class="id">big_setX/=</span> <span class="id">exchange_big//=</span> <span class="id">setT_bool</span>.<br/>
<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#big_setU1">rewrite</a></span> <span class="id">big_setU1//=</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#big_set1">?inE//</a></span> <span class="id">big_set1//=</span>.<br/>
<span class="id">rewrite</span> <span class="id">-big_split//=</span> <span class="id">-</span>(<span class="id"><a href="robustmean.weightedmean.html#Split.def.d0">Pr_setT</a></span> <span class="id">d0</span>).<br/>
<span class="id">rewrite</span> <span class="id">/Pr/=</span>.<br/>
<span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">a</span> <span class="id">_</span>.<br/>
<span class="id">rewrite</span> <span class="id"><a href="robustmean.weightedmean.html#Split.g">!ffunE/g/=</a></span>.<br/>
<span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">d</span> <span class="id">:</span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.fdist#ace7319b60c40bb8a888ede7917d5f1a">{fdist</a></span> <span class="id">_}</span> <span class="id">:=</span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.fdist#FDist.make">locked</a></span> (<span class="id">FDist.make</span> <span class="id">f0</span> <span class="id">f1</span>).<br/>
<span class="vernacular">Definition</span> <span id="X:87" class="id"><a name="X:87" class="">fst_RV</a></span> (<span class="id"><a href="robustmean.weightedmean.html#Split.def.d0">X</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#8fe87352e8bd617fea784762bca86e00">:</a></span> <span class="id">{RV</span> <span class="id">d0</span> <span class="id">-&gt;</span> <span class="id">R}</span>) <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#8fe87352e8bd617fea784762bca86e00">:</a></span> <span class="id">{RV</span> <span class="id">d</span> <span class="id">-&gt;</span> <span class="id">R}</span> <span id="x:88" class="id"><a name="x:88" class="">:=</a></span> <span class="gallina-kwd">fun</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrfun.html#::pair_scope:x_'.1'">x</a></span> <span class="id">=&gt;</span> <span class="id">X</span> <span class="id">x</span>.<span class="id">1</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">dE</span> <span class="id">a</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">:</a></span> <span class="id">d</span> <span class="id"><a href="robustmean.weightedmean.html#a:89">a</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrfun.html#::pair_scope:x_'.2'">=</a></span> (<span class="gallina-kwd">if</span> <span class="id">a</span>.<span class="id">2</span> <span class="gallina-kwd">then</span> <span class="id">c</span> <span class="id">a</span>.<span class="id">1</span> <span class="gallina-kwd">else</span> (<span class="id">1</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x">-</a></span> <span class="id">c</span> <span class="id"><a href="robustmean.weightedmean.html#Split.def.d0">a</a></span>.<span class="id">1</span>)) <span class="id">*</span> <span class="id">d0</span> <span class="id">a</span>.<span class="id">1</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</span></div>
<div class="proofscript" id="proof15">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/d;</span> <span class="id">unlock;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#ffunE">rewrite</a></span> <span class="id">ffunE</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">H1</span> <span class="id">good</span> <span class="id"><a href="robustmean.weightedmean.html#good:90">:</a></span> <span class="id">Pr</span> <span class="id">d0</span> <span class="id">good</span> <span class="id"><a href="robustmean.weightedmean.html#good:90">=</a></span> <span class="id">Pr</span> <span class="id">d</span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#d1cce020b4b43370087fd70de1477ab6">good</a></span> <span class="id">`*</span> <span class="id">[set:</span> <span class="id">bool]</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</span></div>
<div class="proofscript" id="proof16">
<span class="id">rewrite</span> <span class="id">/Pr</span> <span class="id">big_setX/=</span>.<br/>
<span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">u</span> <span class="id">ugood</span>.<br/>
<span class="id"><a href="robustmean.weightedmean.html#setT_bool">rewrite</a></span> <span class="id">setT_bool</span> <span class="id">big_setU1//=</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#big_set1">?inE//</a></span> <span class="id">big_set1</span>.<br/>
<span class="id">rewrite</span> <span class="id">!dE/=</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#addRCA">-mulRDl</a></span> <span class="id">addRCA</span> <span class="id">addR_opp</span> <span class="id">subRR</span> <span class="id">addR0</span> <span class="id">mul1R</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">cEx</span> (<span class="id"><a href="robustmean.weightedmean.html#Split.def.d0">X</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#8fe87352e8bd617fea784762bca86e00">:</a></span> <span class="id">{RV</span> <span class="id">d0</span> <span id="good:92" class="id"><a name="good:92" class="">-&gt;</a></span> <span class="id">R}</span>) <span class="id">good</span> <span class="id"><a href="robustmean.weightedmean.html#X:91">:</a></span><br/>
&nbsp;&nbsp;<span class="id"><a href="robustmean.weightedmean.html#good:92">`E_[X</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">|</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#fbc8212ffd5606b6d221ca2062136a11">good]</a></span> <span class="id">=</span> <span class="id">`E_[fst_RV</span> <span class="id">X</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssr_ext#dc2312b445cefe5154d72c71c36b35ce">|</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#d1cce020b4b43370087fd70de1477ab6">good</a></span> <span class="id">`*</span> <span class="id">[set:</span> <span class="id">bool]</span>)<span class="id">]</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</span></div>
<div class="proofscript" id="proof17">
<span class="id">rewrite</span> <span class="id">!cExE;</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">congr</a></span> (<span class="id">_</span> <span class="id">/</span> <span class="id">_</span>)<span class="id">;</span> <span class="id">last</span> <span class="id">exact:</span> <span class="id">H1</span>.<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.bigop_ext#big_setX">rewrite</a></span> <span class="id">big_setX//=;</span> <span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">u</span> <span class="id">ugood</span>.<br/>
<span class="id"><a href="robustmean.weightedmean.html#setT_bool">rewrite</a></span> <span class="id">setT_bool</span> <span class="id">big_setU1//=</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#big_set1">?inE//</a></span> <span class="id">big_set1</span>.<br/>
<span class="id">rewrite</span> <span class="id"><a href="robustmean.weightedmean.html#Split.fst_RV">!dE/=</a></span> <span class="id">/fst_RV/=</span>.<br/>
<span class="id">rewrite</span> <span class="id">-mulRDr</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#addRCA">-mulRDl</a></span> <span class="id">addRCA</span> <span class="id">addR_opp</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#subRR">rewrite</a></span> <span class="id">subRR</span> <span class="id">addR0</span> <span class="id">mul1R</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">def</span>.<br/>
<span class="vernacular">Section</span> <span class="id">prop</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">d0</span> <span class="id">:</span> <span class="id"><a href="robustmean.weightedmean.html#A:93">{fdist</a></span> <span class="id">A}</span>) (<span class="id">p</span> <span class="id"><a href="robustmean.robustmean.html#R">:</a></span> <span class="id">prob</span> <span class="id">R</span>)  (<span class="id">c</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id"><a href="robustmean.weightedmean.html#Split.prop">A</a></span>).<br/>
<span class="vernacular">End</span> <span class="id">prop</span>.<br/>
<span class="vernacular">End</span> <span class="id">Split</span>.<br/>
<br/>
<div class="doc">part 1 of lemma 1.4, pg 5 </div>
<span class="vernacular">Section</span> <span class="id">bounding_empirical_mean</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id"><a href="robustmean.weightedmean.html#U:97">{fdist</a></span> <span class="id">U}</span>) (<span class="id"><a href="robustmean.weightedmean.html#P:98">X</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#8fe87352e8bd617fea784762bca86e00">:</a></span> <span class="id">{RV</span> <span class="id">P</span> <span id="bounding_empirical_mean.C" class="id"><a name="bounding_empirical_mean.C" class="">-&gt;</a></span> <span class="id">R}</span>) (<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>).<br/>
<span class="vernacular">Variable</span> <span class="id">good</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.U">:</a></span> <span class="id">{set</span> <span class="id">U}</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">eps</span> <span class="id">:</span> <span class="id">R</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span> <span class="id">weight_C</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">:</a></span> <span class="id">is_01</span> <span class="id">C</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span id="bounding_empirical_mean.P'" class="id"><a name="bounding_empirical_mean.P'" class="">0</a></span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">P'</span> <span class="id">:=</span> <span class="id">Weighted.d</span> <span class="id">PC_neq0</span>.<br/>
<span class="vernacular">Let</span> <span class="id">P''</span> <span class="id">:=</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.P">Split.d</a></span> <span class="id">P</span> <span class="id">weight_C</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">bad</span> <span class="id">:=</span> <span class="id">~:</span> <span class="id">good</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">eps_max</span> <span class="id">:=</span> <span class="id">1/16</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span> <span class="id">pr_bad</span> <span class="id"><a href="robustmean.weightedmean.html#bad">:</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">Pr</a></span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">P</a></span> <span class="id">bad</span> <span class="id">=</span> <span class="id">eps</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">low_eps</span> <span class="id">:</span> <span class="id">eps</span> <span class="id">&lt;=</span> <span class="id">eps_max</span>.<br/>
<span class="vernacular">Let</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#77d341fe206b2891763e25999ffddca2">eps0</a></span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">:</a></span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">eps</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</span></div>
<div class="proofscript" id="proof18">
 <span class="id">rewrite</span> <span class="id">-pr_bad</span>. <span class="id">exact:</span> <span class="id">Pr_ge0</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">C0'</span> <span class="id">:</span> (<span class="gallina-kwd">forall</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">u,</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x">0</a></span> <span class="id">&lt;=</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.fintype.html#ce8c9a990e3e773a56ef37417d3761c6">C</a></span> <span class="id">u</span>) <span class="id">-&gt;</span> <span id="a:110" class="id"><span id="a:109" class="id"><span id="a:108" class="id"><a name="a:110" class="">[forall</a></span></span></span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">a,</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.fintype.html#ce8c9a990e3e773a56ef37417d3761c6">0</a></span> <span class="id">&lt;=</span> <span class="id">C</span> <span class="id">a]%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</span></div>
<div class="proofscript" id="proof19">
 <span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">h;</span> <span class="id">apply/forallP</span> <span class="id">=&gt;</span> <span class="id">u;</span> <span class="id">apply/RleP</span>. Qed.</div>
<span class="vernacular">Definition</span> <span class="id">Cpos_fun</span> <span class="id">h</span> <span class="id">:=</span> <span class="id">mkNNFinfun</span> (<span class="id">C0'</span> <span class="id">h</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">X'</span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#8fe87352e8bd617fea784762bca86e00">:</a></span> <span class="id">{RV</span> <span class="id">P'</span> <span class="id">-&gt;</span> <span class="id">R}</span> <span class="id">:=</span> <span class="id">X</span>.<br/>
<span class="vernacular">Let</span> <span class="id">X''</span> <span class="id">:=</span> <span class="id">Split.fst_RV</span> <span class="id">weight_C</span> <span class="id">X</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">mu</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.X">:=</a></span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.good">`E_[X</a></span> <span class="id">|</span> <span class="id">good]</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">mu_hat</span> <span class="id">:=</span> <span class="id">`E</span> <span class="id">X'</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">mu_wave</span> <span class="id"><a href="robustmean.weightedmean.html#X'">:=</a></span> <span class="id">`E_[X'</span> <span class="id">|</span> <span class="id">good]</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">var</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.X">:=</a></span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.good">`V_[X</a></span> <span class="id">|</span> <span class="id">good]</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">var_hat</span> <span class="id">:=</span> <span class="id">`V</span> <span class="id">X'</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">var_wave</span> <span class="id"><a href="robustmean.weightedmean.html#X'">:=</a></span> <span class="id">`V_[X'</span> <span class="id">|</span> <span class="id">good]</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.X">tau</a></span> <span class="id">:=</span> (<span class="id"><a href="robustmean.weightedmean.html#mu_hat">X</a></span> <span class="id">`-cst</span> <span class="id">mu_hat</span>)<span class="id">`^2</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">mu_hatE</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">mu_hat</span> <span class="id">=</span> (<span class="id">\sum_</span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">i</a></span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id"><a href="robustmean.weightedmean.html#i:112">C</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.X">*</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:112">P</a></span> <span class="id">i</span> <span class="id">*</span> <span class="id">X</span> <span class="id">i</span>) <span id="i:121" class="id"><span id="i:120" class="id"><span id="i:119" class="id"><span id="i:118" class="id"><span id="i:117" class="id"><a name="i:121" class="">/</a></span></span></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">i</a></span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id"><a href="robustmean.weightedmean.html#i:117">C</a></span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</span></div>
<div class="proofscript" id="proof20">
<span class="id">rewrite</span> <span class="id">/mu_hat</span> <span class="id">/Ex</span> <span class="id">/ambient_dist</span> <span class="id">divRE</span>.<br/>
<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#big_distrl">rewrite</a></span> <span class="id">big_distrl/=;</span> <span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">u</span> <span class="id">_</span>.<br/>
<span class="id">rewrite</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRCA">-mulRA</a></span> <span class="id">mulRCA;</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">congr</a></span> (<span class="id">_</span> <span class="id">*</span> <span class="id">_</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/P'</span> <span class="id">Weighted.dE</span> (<span class="id">mulRC</span> <span class="id">_</span> (<span class="id">P</span> <span class="id">u</span>)) <span class="id">-divRE;</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">congr</a></span> (<span class="id">_</span> <span class="id">/</span> <span class="id">_</span>).<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span id="i:122" class="id"><a name="i:122" class="">tau_ge0</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#tau">:</a></span> <span class="id">0</span> <span class="id"><a href="robustmean.weightedmean.html#i:122">&lt;=</a></span> <span class="id">tau</span> <span class="id">i</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</span></div>
<div class="proofscript" id="proof21">
 <span class="id">rewrite</span> <span class="id">/tau</span> <span class="id">sq_RV_pow2;</span> <span class="id">exact:</span> <span class="id">pow2_ge_0</span>. Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">tau_max</span> <span class="id">:=</span> <span id="i:125" class="id"><span id="i:124" class="id"><span id="i:123" class="id"><a name="i:125" class="">\rmax_</a></span></span></span>(<span class="id">i</span> <span class="id">|</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#6e9df56134f2cda6e085e904a3dda126">C</a></span> <span class="id"><a href="robustmean.weightedmean.html#tau">i</a></span> <span class="id">!=</span> <span class="id">0</span>) <span class="id">tau</span> <span class="id">i</span>.<br/>
<span class="vernacular">Lemma</span> <span class="id">tau_max_ge0</span> <span class="id"><a href="robustmean.weightedmean.html#tau_max">:</a></span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">tau_max</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</span></div>
<div class="proofscript" id="proof22">
 <span class="id">rewrite</span> <span class="id">/tau_max</span> <span class="id">-big_filter;</span> <span class="id">apply</span> <span class="id">bigmaxR_ge0=&gt;</span> <span class="id">*;</span> <span class="id">exact:tau_ge0</span>. Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">arg_tau_max</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">[arg</span> <span class="id">max_</span>(<span class="id">i</span> <span class="id">&gt;</span> (<span class="id">fdist_supp_choice</span> <span class="id">P</span>) <span class="gallina-kwd">in</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#d1cce020b4b43370087fd70de1477ab6">[set:</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:129">U]</a></span>) <span class="id">tau</span> <span class="id">i]%O</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">update_ffun</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.U">:</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x">{ffun</a></span> <span class="id">U</span> <span class="id">-&gt;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#f6cd22e759500ffb5ebfcc5c9dcc97ef">R}</a></span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">[ffun</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185">i</a></span> <span class="id"><a href="robustmean.weightedmean.html#tau_max">=&gt;</a></span> <span class="gallina-kwd">if</span> (<span class="id">tau_max</span> <span class="id">==</span> <span class="id">0</span>) <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#df45e8c2e8370fd4f0f7c4fdaf208180">||</a></span> (<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185">C</a></span> <span class="id">i</span> <span class="id">==</span> <span class="id">0</span>) <span class="gallina-kwd">then</span> <span class="id">0</span> <span class="gallina-kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">C</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#tau">*</a></span> (<span class="id"><a href="robustmean.weightedmean.html#i:130">1</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">-</a></span> <span class="id"><a href="robustmean.weightedmean.html#tau_max">tau</a></span> <span class="id">i</span> <span class="id">/</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#f6cd22e759500ffb5ebfcc5c9dcc97ef">tau_max</a></span>)<span class="id">]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">nneg_finfun_ge0</span> (<span class="id">c</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#77d341fe206b2891763e25999ffddca2">U</a></span>) <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#c:131">:</a></span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">c</span> <span class="id">i</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</span></div>
<div class="proofscript" id="proof23">
<span class="id">apply/RleP</span>.<br/>
<span class="id">case:</span> <span class="id">c</span> <span class="id">=&gt;</span> <span class="id">c'</span> <span class="id">/=</span> <span class="id">/forallP</span>. <span class="id">exact</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">update_pos_ffun</span> <span class="id">:</span> <span id="a:135" class="id"><span id="a:134" class="id"><span id="a:133" class="id"><a name="a:135" class="">[forall</a></span></span></span> <span class="id"><a href="robustmean.weightedmean.html#update_ffun">a,</a></span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">update_ffun</span> <span class="id">a]%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</span></div>
<div class="proofscript" id="proof24">
<span class="id">apply/forallP=&gt;</span> <span class="id">u;</span> <span class="id">apply/RleP</span>.<br/>
<span class="id">rewrite</span> <span class="id">/update_ffun</span> <span class="id">ffunE</span>.<br/>
<span class="id">have</span> <span class="id">[_|/=]</span> <span class="id">:=</span> <span class="id">eqVneq</span> <span class="id">tau_max</span> <span class="id">0</span> <span class="id">=&gt;</span> <span class="id">//=</span>.<br/>
<span class="id">move/eqP;</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#eqR_le">rewrite</a></span> <span class="id">eqR_le</span> <span class="id">=&gt;</span> <span class="id">/boolp</span>.<span class="id">not_andP</span> <span class="id">[];</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id"><a href="robustmean.weightedmean.html#tau_max_ge0">move/</a></span>(<span class="id">_</span> <span class="id">tau_max_ge0</span>).<br/>
<span class="id">rewrite</span> <span class="id">-ltRNge</span> <span class="id">=&gt;</span> <span class="id">tau_max_gt0</span>.<br/>
<span class="id">case:</span> <span class="id">ifPn=&gt;</span> <span class="id">[|Cu0];</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">_</span>.<br/>
<span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">first</span> <span class="id">exact:</span> <span class="id">nneg_finfun_ge0</span>.<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#subR_ge0">rewrite</a></span> <span class="id">subR_ge0</span> <span class="id">leR_pdivr_mulr</span> <span class="id">//</span>.<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mul1R">rewrite</a></span> <span class="id">mul1R</span> <span class="id">/tau_max</span>.<br/>
<span class="id">rewrite</span> <span class="id">-big_filter</span>.<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#leR_bigmaxR">apply:</a></span> (<span class="id">leR_bigmaxR</span> <span class="id">_</span> <span class="id">tau</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#mem_filter">rewrite</a></span> <span class="id">mem_filter</span> <span class="id">Cu0</span> <span class="id">mem_index_enum</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">update</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span> <span class="id">:=</span> <span class="id">mkNNFinfun</span> <span class="id">update_pos_ffun</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">update_valid_weight</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">update</span> <span class="id">!=</span> <span class="id">0</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</span></div>
<div class="proofscript" id="proof25">
<span class="id">rewrite</span> <span class="id">/Weighted</span>.<span class="id">total/update/update_ffun/=</span>.<br/>
<span class="id">move=&gt;</span> <span class="id">[:tmp]</span>.<br/>
<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#Order.POrderTheory.gt_eqF">rewrite</a></span> <span class="id">gt_eqF//</span> <span class="id">lt_neqAle;</span> <span class="id">apply/andP;</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#eq_sym">rewrite</a></span> <span class="id">eq_sym</span> <span class="id">psumr_neq0;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">abstract:</span> <span class="id">tmp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span> <span class="id">u</span> <span class="id">uU;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#ffunE">rewrite</a></span> <span class="id">ffunE/=;</span> <span class="id">case:</span> <span class="id">ifPn;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mul0R">rewrite</a></span> <span class="id">mul0R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#negb_or">rewrite</a></span> <span class="id">negb_or</span> <span class="id">=&gt;</span> <span class="id">/andP[taumax0</span> <span class="id">Cu0]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssrnum.html#Num.Theory.mulr_ge0">rewrite</a></span> <span class="id">mulr_ge0//</span> <span class="id">mulr_ge0//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact/RleP/nneg_finfun_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssrnum.html#Num.Theory.subr_ge0">rewrite</a></span> <span class="id">subr_ge0</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssrnum.html#Num.Theory.ler_pdivrMr">RdivE//</a></span> <span class="id">ler_pdivrMr</span> <span class="id">?mul1r//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/tau_max</span> <span class="id">-big_filter;</span> <span class="id">apply/RleP/leR_bigmaxR</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#mem_filter">rewrite</a></span> <span class="id">mem_filter</span> <span class="id">Cu0</span> <span class="id">mem_index_enum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#Order.POrderTheory.lt_neqAle">rewrite</a></span> <span class="id">lt_neqAle</span> <span class="id">eq_sym</span> <span class="id">taumax0/=;</span> <span class="id">apply/RleP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/tau_max</span> <span class="id">-big_filter;</span> <span class="id">apply/bigmaxR_ge0</span> <span class="id">=&gt;</span> <span class="id">v</span> <span class="id">_;</span> <span class="id">exact:</span> <span class="id">tau_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span> <span class="id">PC_neq0;</span> <span class="id">rewrite</span> <span class="id">/Weighted</span>.<span class="id">total</span> <span class="id">psumr_neq0;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">u</span> <span class="id">_;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssrnum.html#Num.Theory.mulr_ge0">rewrite</a></span> <span class="id">mulr_ge0//;</span> <span class="id">exact/RleP/nneg_finfun_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#hasP">move=&gt;</a></span> <span class="id">/hasP[u</span> <span class="id">uU];</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#inE">rewrite</a></span> <span class="id">inE</span> <span class="id">/=</span> <span class="id">=&gt;</span> <span class="id">CuPu</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/hasP</span> <span class="id">=&gt;</span> <span class="id">/=;</span> <span class="gallina-kwd">exists</span> <span class="id">u;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#mem_index_enum">rewrite</a></span> <span class="id">mem_index_enum</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#Order.POrderTheory.lt_neqAle">rewrite</a></span> <span class="id">lt_neqAle</span> <span class="id">tmp//</span> <span class="id">ffunE</span> <span class="id">andbT</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span> <span class="id">ifPn</span> <span class="id">=&gt;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#eqP">[/orP[|/eqP</a></span> <span class="id">Cu0]|]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id">rewrite</span> <span class="id">/tau_max</span> <span class="id">pmax_eq0//;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">?</span> <span class="id">?;</span> <span class="id">exact/RleP/tau_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">admit</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="gallina-kwd">by</span> <span class="id">move:</span> <span class="id">CuPu;</span> <span class="id">rewrite</span> <span class="id">Cu0</span> <span class="id">mul0R</span> <span class="id">=&gt;</span> <span class="id">/RltP/Rlt_irrefl</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#negb_or">rewrite</a></span> <span class="id">negb_or</span> <span class="id">=&gt;</span> <span class="id">/andP[tau_max0</span> <span class="id">Cu0]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#eq_sym">rewrite</a></span> <span class="id">eq_sym</span> <span class="id">mulR_neq0';</span> <span class="id">apply/andP;</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulR_neq0'">rewrite</a></span> <span class="id">mulR_neq0'</span> <span class="id">Cu0/=</span> <span class="id">subr_eq0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">admit</span>.<br/>
<span class="id">apply:</span> <span class="id">sumr_ge0</span>.<br/>
<span class="id">exact:</span> <span class="id">tmp</span>.<br/>
Admitted.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">eqn1_1</span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#Pr">:</a></span><br/>
&nbsp;&nbsp;<span class="id">0</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.good">&lt;</a></span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span> <span class="id">-&gt;</span><br/>
&nbsp;(<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id"><a href="robustmean.weightedmean.html#i:136">good</a></span>) <span class="id"><a href="robustmean.weightedmean.html#i:136">C</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#tau">*</a></span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#i:136">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">*</a></span> <span class="id">tau</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.P">i</a></span>) <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.good">/</a></span> <span class="id">Pr</span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#var">good</a></span> <span class="id">&lt;=</span> <span class="id">var</span> <span class="id"><a href="robustmean.weightedmean.html#mu_hat">+</a></span> (<span class="id">mu</span> <span class="id">-</span> <span class="id">mu_hat</span>)².<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</span></div>
<div class="proofscript" id="proof26">
<span class="id">move</span> <span class="id">=&gt;</span> <span class="id">HPgood</span>.<br/>
<span class="id">apply</span> <span class="id">leR_trans</span> <span class="gallina-kwd">with</span> (<span class="id">y</span> <span class="id"><a href="robustmean.weightedmean.html#tau">:=</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#fbc8212ffd5606b6d221ca2062136a11">`E_[tau</a></span> <span class="id">|</span> <span class="id">good]</span>)<span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">apply/leR_eqVlt;left;apply/cVarDist</span>.<br/>
<span class="id"><a href="robustmean.robustmean.html#cExE">rewrite</a></span> <span class="id">cExE</span>.<br/>
<span class="id">apply</span> <span class="id">leR_pmul2r;</span> <span class="id">[by</span> <span class="id">apply</span> <span class="id">invR_gt0|]</span>.<br/>
<span class="id">apply</span> <span class="id">leR_sumRl</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">Higood;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">[]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">mulRC</span> (<span class="id">tau</span> <span class="id">i</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_wpmul2r;</span> <span class="id">first</span> <span class="id">apply</span> <span class="id">tau_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">[_</span> <span class="id">c1]</span> <span class="id">:=</span> <span class="id">weight_C</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">/RleP</span> <span class="id">hp</span> <span class="id">:=</span> <span class="id">FDist.ge0</span> <span class="id">P</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-{2}</span>(<span class="id">mul1R</span> (<span class="id">P</span> <span class="id">i</span>))<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#leR_wpmul2r">;</a></span> <span class="id">apply</span> <span class="id">leR_wpmul2r</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">mulR_ge0</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">apply</span> <span class="id">tau_ge0</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">invariant</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">good</a></span>) (<span class="id">1</span> <span class="id">-</span> <span class="id">C</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#77d341fe206b2891763e25999ffddca2">i</a></span>) <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">&lt;=</a></span> (<span class="id">1</span> <span class="id">-</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">eps</a></span>) <span class="id">/</span> <span class="id">2</span> <span id="i:150" class="id"><span id="i:149" class="id"><span id="i:148" class="id"><span id="i:147" class="id"><span id="i:146" class="id"><a name="i:150" class="">*</a></span></span></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">i</a></span> <span class="gallina-kwd">in</span> <span class="id">bad</span>) (<span class="id">1</span> <span class="id">-</span> <span class="id">C</span> <span class="id">i</span>) <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>).<br/>
<span class="vernacular">Definition</span> <span class="id">invariant1</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">:=</a></span><br/>
&nbsp;&nbsp;(<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span> <span class="id">&lt;=</span> <span class="id">Pr</span> <span class="id">P'</span> <span class="id">good</span>).<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">pr_good</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.good">:</a></span> <span class="id">Pr</span> <span class="id">P</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">good</a></span> <span class="id">=</span> <span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</span></div>
<div class="proofscript" id="proof27">
 <span class="gallina-kwd">by</span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#Pr_to_cplt">rewrite</a></span> <span class="id">Pr_to_cplt</span> <span class="id">pr_bad</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">lemma1_4_start</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">:</a></span><br/>
&nbsp;&nbsp;<span class="id">0</span> <span id="i:155" class="id"><span id="i:154" class="id"><span id="i:153" class="id"><span id="i:152" class="id"><span id="i:151" class="id"><a name="i:155" class="">&lt;</a></span></span></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">i</a></span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id"><a href="robustmean.weightedmean.html#i:151">C</a></span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">invariant</span> <span class="id">-&gt;</span> <span class="id">invariant1</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</span></div>
<div class="proofscript" id="proof28">
<span class="id">rewrite</span> <span class="id">/invariant/invariant1</span> <span class="id">=&gt;</span> <span class="id">HCi_gt0</span> <span class="id">hinv</span>.<br/>
<span class="id">rewrite</span> <span class="id">-!pr_good</span>.<br/>
<span class="id">apply</span> <span class="id">leR_trans</span> <span class="gallina-kwd">with</span> (<span class="id">y</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.P">:=</a></span> (<span class="id">Pr</span> <span class="id">P</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">good</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3e57074ab0a6a36b253e873a1bdac6ad">/</a></span> <span class="id">2</span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#Pr">*</a></span> (<span class="id">1</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.good">+</a></span> <span class="id">Pr</span> <span class="id">P</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">good</a></span> <span class="id">+</span> (<span class="id">\sum_</span>(<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">i</a></span> <span class="gallina-kwd">in</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">bad</a></span>) <span class="id"><a href="robustmean.weightedmean.html#i:156">C</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">*</a></span> <span class="id">P</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">i</a></span>))) <span class="id">/</span> (<span class="id">\sum_</span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">i</a></span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id"><a href="robustmean.weightedmean.html#i:161">C</a></span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>)).<br/>
<span class="id">apply</span> <span class="id">leR_pmul2r</span> <span class="gallina-kwd">with</span> (<span class="id">m</span> <span class="id">:=</span> (<span class="id">\sum_</span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">i</a></span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id"><a href="robustmean.weightedmean.html#i:176">C</a></span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>) <span class="id">*</span> <span class="id">2</span>)<span class="id">;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">mulR_gt0</span>.<br/>
<span class="id">rewrite</span> <span class="id">!mulRA</span> <span class="id">!</span>(<span class="id">mulRC</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRA">_</a></span> <span class="id">2</span>) <span class="id">-</span>(<span class="id">mulRA</span> <span class="id">_</span> (<span class="id">/</span> <span class="id">_</span>)) <span class="id">mulVR;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">gtR_eqF</span>.<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulR1">rewrite</a></span> <span class="id">mulR1</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRC">!mulRA</a></span> (<span class="id">mulRC</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRA">_</a></span> (<span class="id">/2</span>)) <span class="id">mulRA</span> <span class="id">mulVR;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">gtR_eqF</span>.<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mul1R">rewrite</a></span> <span class="id">mul1R</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRDl">-addRR</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#addRA">mulRDl</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRDr">-addRA</a></span> <span class="id">mulRDr</span>.<br/>
<span class="id">apply</span> <span class="id">leR_add</span>.<br/>
<span class="id">apply</span> <span class="id">leR_pmul2l;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">move:</span> <span class="id">low_eps;</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.pr_good">rewrite</a></span> <span class="id">pr_good</span> <span class="id">/eps_max;</span> <span class="id">lra</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.P">Pr_setT</a></span> <span class="id">P</span>) <span class="id">/Pr</span>.<br/>
<span class="id">apply</span> <span class="id">leR_sumRl</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_//;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mul1R">//-{2}</a></span>(<span class="id">mul1R</span> (<span class="id">P</span> <span class="id">i</span>))<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#leR_wpmul2r">;</a></span> <span class="id">apply</span> <span class="id">leR_wpmul2r;</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.weight_C">[|apply</a></span> <span class="id">weight_C]</span>.<br/>
<span class="id">apply</span> <span class="id">leR_pmul2l;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">move:</span> <span class="id">low_eps;</span> <span class="id">rewrite</span> <span class="id">/eps_max</span> <span class="id">pr_good;</span> <span class="id">lra</span>.<br/>
<span class="id">rewrite</span> <span class="id">/Pr</span> <span class="id">addRC</span> <span class="id">-bigID2</span>.<br/>
<span class="id">apply</span> <span class="id">leR_sumR</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">HiU</span>.<br/>
<span class="id">case:</span> <span class="id">ifPn</span> <span class="id">=&gt;</span> <span class="id">igood;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">Rle_refl</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-{2}</span>(<span class="id">mul1R</span> (<span class="id">P</span> <span class="id">i</span>))<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#leR_pmul">;</a></span> <span class="id">apply</span> <span class="id">leR_pmul;</span> <span class="id">try</span> <span class="id">apply</span> <span class="id">weight_C;</span> <span class="id">auto;</span> <span class="id">right</span>.<br/>
<span class="id">under</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#77d341fe206b2891763e25999ffddca2">[X</a></span> <span class="gallina-kwd">in</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#eq_bigr">_</a></span> <span class="id">&lt;=</span> <span class="id">X]eq_bigr</span> <span class="id">do</span> <span class="id"><a href="robustmean.weightedmean.html#dE">rewrite</a></span> <span class="id">Weighted.dE</span> <span class="id">/Weighted</span>.<span class="id">total</span>.<br/>
<span class="id">rewrite</span> <span class="id">-big_distrl/=</span> <span class="id">divRE</span>.<br/>
<span class="id">apply</span> <span class="id">leR_pmul2r;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">invR_gt0</span>.<br/>
<span class="id">apply</span> <span class="id">Ropp_le_cancel</span>.<br/>
<span class="id">rewrite</span> <span class="id">{2}pr_good</span> <span class="id">addRA</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.pr_bad">-addRA</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRDr">-pr_bad</a></span> <span class="id">mulRDr</span> <span class="id">oppRD</span> <span class="id">addRC</span>.<br/>
<span class="id">apply</span> <span class="id">leR_subl_addr</span>.<br/>
<span class="id">rewrite</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#oppRK">/Rminus</a></span> <span class="id">oppRK</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#addRC">-mulRN</a></span> <span class="id">addRC</span> <span class="id">{1}/Rdiv</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulVR">-mulRA</a></span> <span class="id">mulVR;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">gtR_eqF</span>.<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulR1">rewrite</a></span> <span class="id">mulR1</span> <span class="id">oppRD</span> <span class="id">oppRK</span> <span class="id">!big_morph_oppR-!big_split/=</span>.<br/>
<span class="id">have</span> <span class="id">H:</span> <span class="gallina-kwd">forall</span> <span class="id">S,</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">S</span>) (<span class="id">P</span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#i:188">+</a></span> <span class="id">-</span> (<span class="id"><a href="robustmean.weightedmean.html#i:188">C</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">*</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">P</a></span> <span class="id">i</span>)) <span id="i:197" class="id"><span id="i:196" class="id"><span id="i:195" class="id"><span id="i:194" class="id"><span id="i:193" class="id"><a name="i:197" class="">=</a></span></span></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">i</a></span> <span class="gallina-kwd">in</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">S</a></span>) (<span class="id">1</span> <span class="id">-</span> <span class="id">C</span> <span class="id">i</span>) <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">move</span> <span class="id">=&gt;</span> <span class="id">p</span> <span class="id">S;</span> <span class="id">apply</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_;</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRBl">rewrite</a></span> <span class="id">mulRBl</span> <span class="id">mul1R</span> <span class="id">addR_opp</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">!H</span> <span class="id">pr_good</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">sumCi_ge0</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">:</a></span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">i</a></span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id"><a href="robustmean.weightedmean.html#i:198">C</a></span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</span></div>
<div class="proofscript" id="proof29">
<span class="gallina-kwd">by</span> <span class="id">apply/RleP;</span> <span class="id">apply</span> <span class="id">sumr_ge0</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_;</span><br/>
&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#coqRE">rewrite</a></span> <span class="id">coqRE</span> <span class="id">mulr_ge0//;</span> <span class="id">apply</span> <span class="id">/RleP;</span> <span class="id">apply</span> <span class="id">weight_C</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">h1</span> <span class="id">h</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> (<span class="id">Cpos_fun</span> <span class="id">h</span>) <span class="id">!=</span> <span class="id">0</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</span></div>
<div class="proofscript" id="proof30">
<span class="id">move:</span> <span class="id">PC_neq0</span>.<br/>
<span class="id">rewrite</span> <span class="id">/Weighted</span>.<span class="id">total</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">do</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRC">rewrite</a></span> <span class="id">mulRC</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">lemma_1_4_step1</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">:</a></span><br/>
&nbsp;&nbsp;<span class="id">0</span> <span id="i:208" class="id"><span id="i:207" class="id"><span id="i:206" class="id"><span id="i:205" class="id"><span id="i:204" class="id"><a name="i:208" class="">&lt;</a></span></span></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">i</a></span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id"><a href="robustmean.weightedmean.html#i:204">C</a></span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>  <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.P'">-&gt;</a></span><br/>
&nbsp;&nbsp;<span class="id">Pr</span> <span class="id">P'</span> <span class="id">good</span> <span class="id">!=</span> <span class="id">0</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">invariant1</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">Rsqr</span> (<span class="id">mu_hat</span> <span class="id">-</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#77d341fe206b2891763e25999ffddca2">mu_wave</a></span>) <span class="id">&lt;=</span> <span class="id">var_hat</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">eps</a></span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">/</a></span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</span></div>
<div class="proofscript" id="proof31">
<span class="id">move=&gt;</span> <span class="id">PC0</span> <span class="id">pgoodC</span> <span class="id">invC</span>.<br/>
<span class="id">unfold</span> <span class="id">eps_max</span> <span class="gallina-kwd">in</span> <span class="id">low_eps</span>.<br/>
<span class="id">suff</span> <span class="id">h</span> <span class="id">:</span> <span class="id">`|</span> <span class="id">mu_hat</span> <span class="id">-</span> <span class="id">mu_wave</span> <span class="id">|</span> <span class="id">&lt;=</span> <span class="id">sqrt</span> (<span class="id">var_hat</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">eps</a></span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">/</a></span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>)).<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.R_sqr.html#Rsqr_abs">rewrite</a></span> <span class="id">Rsqr_abs</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#77d341fe206b2891763e25999ffddca2">-[X</a></span> <span class="gallina-kwd">in</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.R_sqrt.html#Rsqr_sqrt">_</a></span> <span class="id">&lt;=</span> <span class="id">X]Rsqr_sqrt;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">apply/invR_ge0/subR_gt0;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">repeat</span> <span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id"><a href="robustmean.robustmean.html#variance_nonneg">[exact:</a></span> <span class="id">variance_nonneg|lra|rewrite</span> <span class="id">-pr_bad;</span> <span class="id">exact:</span> <span class="id">Pr_ge0]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply/Rsqr_incr_1</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#normR_ge0">[exact/normR_ge0|exact:</a></span> <span class="id">sqrt_pos]</span>.<br/>
<span class="id">pose</span> <span class="id">delta</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">:=</a></span> <span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>.<br/>
<span class="id">have</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">{1}-&gt;</a></span> <span class="id">:</span> <span class="id">eps</span> <span class="id">=</span> <span class="id">1</span> <span class="id">-</span> <span class="id">delta</span> <span class="gallina-kwd">by</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#subRB">rewrite</a></span> <span class="id">subRB</span> <span class="id">subRR</span> <span class="id">add0R</span>.<br/>
<span class="id">rewrite</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#distRC">-/delta</a></span> <span class="id">distRC</span>.<br/>
<span class="id">rewrite</span> <span class="id">/mu_hat</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">resilience</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">rewrite</span> <span class="id">/delta;</span> <span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">good_mass</span> <span class="id">:</span> <br/>
&nbsp;&nbsp;<span class="id">invariant</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">1</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#77d341fe206b2891763e25999ffddca2">-</a></span> <span class="id">eps/2</span> <span class="id">&lt;=</span> (<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id"><a href="robustmean.weightedmean.html#i:210">good</a></span>) <span class="id"><a href="robustmean.weightedmean.html#i:210">C</a></span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.P">i</a></span>) <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.good">/</a></span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof32')">Proof.</span></div>
<div class="proofscript" id="proof32">
<span class="id">rewrite</span> <span class="id">/eps_max/is_01</span> <span class="id">=&gt;</span> <span class="id">Hinv</span>.<br/>
<span class="id">unfold</span> <span class="id">eps_max</span> <span class="gallina-kwd">in</span> <span class="id">low_eps</span>.<br/>
<span class="id">apply</span> <span class="id">leR_trans</span> <span class="gallina-kwd">with</span> (<span class="id">y</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">:=</a></span> <span class="id">1</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">-</a></span> (<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">1-eps</a></span>)<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.good">/2/Pr</a></span> <span class="id">P</span> <span class="id">good</span> <span class="id"><a href="robustmean.weightedmean.html#bad">*</a></span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">bad</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.pr_bad">rewrite</a></span> <span class="id">pr_bad</span> <span class="id">pr_good</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRC">-!mulRA</a></span> <span class="id">mulRC</span> (<span class="id">mulRC</span> (<span class="id">/</span>(<span class="id">_-_</span>))) <span class="id">mulRA</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulVR">-mulRA</a></span> <span class="id">mulVR;</span> <span class="id">[rewrite</span> <span class="id">mulR1</span> <span class="id">mulRC;</span> <span class="id">right|apply</span> <span class="id">/gtR_eqF;</span> <span class="id">lra]</span>.<br/>
<span class="id">apply</span> <span class="id">leR_trans</span> <span class="gallina-kwd">with</span> (<span class="id">y</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">:=</a></span> <span class="id">1</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">-</a></span> (<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">1-eps</a></span>)<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.good">/2/Pr</a></span> <span class="id">P</span> <span class="id">good</span> <span id="i:224" class="id"><span id="i:223" class="id"><span id="i:222" class="id"><span id="i:221" class="id"><span id="i:220" class="id"><span id="i:219" class="id"><span id="i:218" class="id"><span id="i:217" class="id"><span id="i:216" class="id"><span id="i:215" class="id"><a name="i:224" class="">*</a></span></span></span></span></span></span></span></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">i</a></span> <span class="gallina-kwd">in</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">bad</a></span>) <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">P</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">*</a></span> (<span class="id">1</span> <span class="id">-</span> <span class="id">C</span> <span class="id">i</span>)).<br/>
&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#leR_add2l">rewrite</a></span> <span class="id">leR_add2l</span> <span class="id">leR_oppl</span> <span class="id">oppRK</span> <span class="id">leR_pmul2l;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">last</span> (<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.pr_good">rewrite</a></span> <span class="id">pr_good</span> <span class="id">/Rdiv</span> <span class="id">mulRC</span> <span class="id">mulRA</span> <span class="id">mulVR;</span> <span class="id">[lra|rewrite</span> <span class="id">gt_eqF//;</span> <span class="id">apply/RltP;</span> <span class="id">lra]</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_sumR</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">Hi_bad</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-{2}</span>(<span class="id">mulR1</span> (<span class="id">P</span> <span class="id">i</span>)).<br/>
&nbsp;&nbsp;<span class="id">move:</span> (<span class="id">FDist.ge0</span> <span class="id">P</span> <span class="id">i</span>)<span class="id">;</span> <span class="id">move/RleP</span> <span class="id">=&gt;</span> <span class="id">[HPi_gt0|HPi_eq0]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply/RleP;</span> <span class="id">rewrite</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssrnum.html#Num.Theory.ler_wpM2l">!coqRE</a></span> <span class="id">ler_wpM2l//</span> <span class="id">gerBl//;</span> <span class="id">move:</span> (<span class="id">weight_C</span> <span class="id">i</span>).<span class="id">1</span> <span class="id">=&gt;</span> <span class="id">/RleP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-HPi_eq0</span> <span class="id">!mul0R</span>.<br/>
<span class="id">rewrite</span> <span class="id">-pr_good</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRA">/Rdiv</a></span> <span class="id">-</span>(<span class="id">mulRA</span> (<span class="id">Pr</span> <span class="id">P</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRC">good</a></span>)) (<span class="id">mulRC</span> (<span class="id">/2</span>)) <span class="id">mulRA</span> <span class="id">mulRV;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> (<span class="id">apply</span> <span class="id">gtR_eqF;</span> <span class="id">lra</span>).<br/>
<span class="id">apply</span> <span class="id">leR_pmul2r</span> <span class="gallina-kwd">with</span> (<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.P">m</a></span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.good">:=</a></span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span>)<span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">[rewrite</span> <span class="id">pr_good;</span> <span class="id">lra|rewrite</span> <span class="id">-</span>(<span class="id">mulRA</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.P">_</a></span> (<span class="id">/</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span>)) <span class="id">mulVR;</span> <span class="id">[rewrite</span> <span class="id">mul1R</span> <span class="id">mulR1|apply</span> <span class="id">gtR_eqF;</span> <span class="id">lra]]</span>.<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRDl">rewrite</a></span> <span class="id">mulRDl</span> <span class="id">mul1R</span> <span class="id">{2}pr_good</span> <span class="id">mulRC</span> <span class="id">mulRN</span>.<br/>
<span class="id">apply</span> <span class="id">Rplus_le_reg_l</span> <span class="gallina-kwd">with</span> (<span class="id">r</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.P">:=</a></span> <span class="id">-Pr</span> <span class="id">P</span> <span class="id">good</span>).<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#addRA">rewrite</a></span> <span class="id">addRA</span> (<span class="id">addRC</span> (<span class="id">-</span> <span class="id">_</span>)) <span class="id">addRN</span> <span class="id">add0R</span> <span class="id">mulRA</span>.<br/>
<span class="id">apply</span> <span class="id">leR_oppl</span>.<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#oppRD">rewrite</a></span> <span class="id">oppRD</span> <span class="id">oppRK</span> <span class="id">/Pr</span> <span class="id">-</span>(<span class="id">mul1R</span> (<span class="id">-</span> <span class="id">_</span>)) <span class="id">mulRN</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#big_distrr">-mulNR</a></span> <span class="id">big_distrr</span> <span class="id">-big_split</span> <span class="id">-divRE/=</span>.<br/>
<span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_</span> <span class="id">do</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulNR">rewrite</a></span> <span class="id">mulNR</span> <span class="id">mul1R</span> <span class="id">-{1}</span>(<span class="id">mul1R</span> (<span class="id">P</span> <span class="id">i</span>)) <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.RIneq.html#Rmult_plus_distr_r">-mulNR</a></span> <span class="id">-Rmult_plus_distr_r</span> <span class="id">addR_opp</span>.<br/>
<span class="id">under</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#77d341fe206b2891763e25999ffddca2">[X</a></span> <span class="gallina-kwd">in</span> <span class="id">_</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">&lt;=</a></span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.X">_</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#eq_bigr">/</a></span> <span class="id">_</span> <span class="id">*</span> <span class="id">X]eq_bigr</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_</span> <span class="id">do</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRC">rewrite</a></span> <span class="id">mulRC</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">[]</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">lemma_1_4_step2</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">invariant</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">Rsqr</a></span> (<span class="id">mu</span> <span class="id">-</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#77d341fe206b2891763e25999ffddca2">mu_wave</a></span>) <span class="id">&lt;=</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">var</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">*</a></span> <span class="id">2*eps</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">/</a></span> (<span class="id">2-eps</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof33')">Proof.</span></div>
<div class="proofscript" id="proof33">
<span class="id">move=&gt;</span> <span class="id">Hinv</span>.<br/>
<span class="id">unfold</span> <span class="id">eps_max</span> <span class="gallina-kwd">in</span> <span class="id">low_eps</span>.<br/>
<span class="id">have</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">-&gt;</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#fbc8212ffd5606b6d221ca2062136a11">:</a></span> <span class="id">mu</span> <span class="id">=</span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#fbc8212ffd5606b6d221ca2062136a11">`E_[X''</a></span> <span class="id">|</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#d1cce020b4b43370087fd70de1477ab6">good</a></span> <span class="id">`*</span> <span class="id">[set:</span> <span class="id">bool]]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/mu</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> <span class="id">Split.cEx</span>.<br/>
<span class="id">have</span> <span class="id">-&gt;</span> <span class="id">:</span> <span class="id">mu_wave</span> <span class="id">=</span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#fbc8212ffd5606b6d221ca2062136a11">`E_[X''</a></span> <span class="id">|</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#f5e197738ea7c8e266850f6045418c3f">good</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Datatypes.html#true">`*</a></span> <span class="id">[set</span> <span class="id">true]]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/mu_wave</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#divRE">!cExE</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#big_distrl">!divRE</a></span> <span class="id">!big_distrl/=</span> <span class="id">big_setX//=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/Pr</span> <span class="id">big_setX//=;</span> <span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">u</span> <span class="id">ugood</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#big_set1">rewrite</a></span> <span class="id">big_set1</span> <span class="id">/P'/P''</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/X'</span> <span class="id">/X''</span> <span class="id">/Split</span>.<span class="id">fst_RV</span> <span class="id">/=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-!mulRA</span>.<br/>
&nbsp;&nbsp;<span class="id">congr</span> (<span class="id">X</span> <span class="id">u</span> <span class="id">*</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#eq_bigr">[in</a></span> <span class="id">RHS]eq_bigr</span> <span class="id">do</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#big_set1">rewrite</a></span> <span class="id">big_set1</span> <span class="id">Split.dE</span><span class="id">/=</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="robustmean.weightedmean.html#dE">rewrite</a></span> <span class="id">Split.dE</span><span class="id">/=</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#eq_bigr">[in</a></span> <span class="id">LHS]eq_bigr</span> <span class="id">do</span> <span class="id"><a href="robustmean.weightedmean.html#dE">rewrite</a></span> <span class="id">Weighted.dE</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-big_distrl/=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.RIneq.html#Rdiv_mult_distr">-divRE</a></span> <span class="id">Rdiv_mult_distr</span> <span class="id">divRE</span> <span class="id">invRK</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRC">rewrite</a></span> <span class="id">mulRC</span> <span class="id">!mulRA;</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">congr</a></span> (<span class="id">_</span> <span class="id">*</span> <span class="id">/</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id"><a href="robustmean.weightedmean.html#dE">rewrite</a></span> <span class="id">Weighted.dE</span> <span class="id">mulRA</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#divRE">mulRAC</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#divRR">-divRE</a></span> <span class="id">divRR</span> <span class="id">?mul1R</span>.<br/>
<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.R_sqr.html#Rsqr_neg_minus">rewrite</a></span> <span class="id">Rsqr_neg_minus</span>.<br/>
<span class="id">apply:</span> (<span class="id">@leR_trans</span> (<span class="id"><a href="robustmean.robustmean.html#964c18c6c61b25178ae33d781785d0c7">`V_[</a></span> <span class="id">X''</span> <span class="id">|</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#d1cce020b4b43370087fd70de1477ab6">good</a></span> <span class="id">`*</span> <span class="id">[set:</span> <span class="id">bool]]</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">*</a></span> <span class="id">2</span> <span class="id">*</span> (<span class="id">1</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">-</a></span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">/</a></span> <span class="id">2</span>)<span class="id">%mcR</span>) <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">/</a></span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span> <span class="id">/</span> <span class="id">2</span>)<span class="id">%mcR</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">sqrt_le_0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id">exact:</span> <span class="id">Rle_0_sqr</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id">apply:</span> <span class="id">mulR_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="id">apply:</span> <span class="id">mulR_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span> <span class="id">apply:</span> <span class="id">mulR_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span> <span class="id">exact:</span> <span class="id">cvariance_nonneg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span> <span class="id">rewrite</span> <span class="id">-!coqRE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#subRB">rewrite</a></span> <span class="id">subRB</span> <span class="id">subRR</span> <span class="id">add0R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">divR_ge0</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="id">apply:</span> <span class="id">invR_ge0;</span> <span class="id">rewrite</span> <span class="id">-!coqRE</span> (<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">_</a></span> <span class="id">:</span> <span class="id">2%:R</span> <span class="id">=</span> <span class="id">2</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.R_sqrt.html#sqrt_Rsqr_abs">rewrite</a></span> <span class="id">sqrt_Rsqr_abs</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="robustmean.robustmean.html#cresilience">apply:</a></span> (<span class="id">cresilience</span> (<span class="id">delta</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">:=</a></span> <span class="id">1</span> <span class="id">-</span> <span class="id">eps</span> <span class="id">/</span> <span class="id">2</span>)).<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id">rewrite</span> <span class="id">-!coqRE;</span> <span class="id">interval</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id"><a href="robustmean.weightedmean.html#good_mass">have</a></span> <span class="id">:=</span> <span class="id">good_mass</span> <span class="id">Hinv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-!coqRE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#leR_trans">move=&gt;</a></span> <span class="id">/leR_trans;</span> <span class="id">apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/leR_eqVlt;</span> <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/Pr</span> <span class="id">!big_setX/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">under</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">[X</a></span> <span class="gallina-kwd">in</span> <span class="id">_</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#eq_bigr">=</a></span> <span class="id">X</span> <span class="id">*</span> <span class="id">_]eq_bigr</span> <span class="id">do</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#big_set1">rewrite</a></span> <span class="id">big_set1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">congr</a></span> (<span class="id">_</span> <span class="id">/</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">u</span> <span class="id">ugood</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/P''</span> <span class="id">Split.dE</span><span class="id">/=</span> <span class="id">mulRC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">u</span> <span class="id">ugood</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="robustmean.weightedmean.html#setT_bool">rewrite</a></span> <span class="id">setT_bool</span> <span class="id">big_setU1//=</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#big_set1">?inE//</a></span> <span class="id">big_set1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/P''</span> <span class="id">!Split</span>.<span class="id">dE/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#addRCA">-mulRDl</a></span> <span class="id">addRCA</span> <span class="id">addR_opp</span> <span class="id">subRR</span> <span class="id">addR0</span> <span class="id">mul1R</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id">rewrite</span> <span class="id">/Pr</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#leR_sumRl">-</a></span> <span class="id">apply</span> <span class="id">leR_sumRl</span> <span class="id">=&gt;</span> <span class="id">i;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#inE">rewrite</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#andP">inE</a></span> <span class="id">=&gt;</span> <span class="id">/andP[igood</span> <span class="id">_]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="gallina-kwd">by</span> <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="id"><a href="robustmean.weightedmean.html#dE">rewrite</a></span> <span class="id">Split.dE</span><span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulR_ge0">;</a></span> <span class="id">apply</span> <span class="id">mulR_ge0</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">case:</span> <span class="id">ifPn</span> <span class="id">=&gt;</span> <span class="id">_;</span> <span class="id">move:</span> (<span class="id">weight_C</span> <span class="id">i</span>.<span class="id">1</span>) <span class="id">=&gt;</span> <span class="id">[c0</span> <span class="id">c1]//;</span> <span class="id">apply</span> <span class="id">subR_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="gallina-kwd">by</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#inE">rewrite</a></span> <span class="id">inE</span> <span class="id">igood</span> <span class="id">in_setT</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.fintype.html#subsetP">-</a></span> <span class="id">apply/subsetP</span> <span class="id">=&gt;</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">!inE</span> <span class="id">=&gt;</span> <span class="id">/andP[-&gt;]</span>.<br/>
<span class="id">have</span> <span class="id">-&gt;</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.X''">:</a></span> <span class="id"><a href="robustmean.robustmean.html#964c18c6c61b25178ae33d781785d0c7">`V_[</a></span> <span class="id">X''</span> <span class="id">|</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#d1cce020b4b43370087fd70de1477ab6">good</a></span> <span class="id">`*</span> <span class="id">[set:</span> <span class="id">bool]]</span> <span class="id">=</span> <span class="id">var</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/var</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/cVar</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">-&gt;</span> <span class="id">:</span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#fbc8212ffd5606b6d221ca2062136a11">`E_[X''</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssr_ext#dc2312b445cefe5154d72c71c36b35ce">|</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#d1cce020b4b43370087fd70de1477ab6">good</a></span> <span class="id">`*</span> <span class="id">[set:</span> <span class="id">bool]</span>)<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.X">]</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#fbc8212ffd5606b6d221ca2062136a11">=</a></span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.good">`E_[X</a></span> <span class="id">|</span> <span class="id">good]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/esym</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span> <span class="id">Split.cEx</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/esym</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> <span class="id">Split.cEx</span>.<br/>
<span class="id">rewrite</span> <span class="id">!divRE</span> <span class="id">-</span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">mulRA</a></span> <span class="id">_</span> <span class="id">eps</span>) <span class="id">-</span>(<span class="id">mulRA</span> <span class="id">_</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">_</span>)).<br/>
<span class="id">apply</span> <span class="id">leR_wpmul2l</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id"><a href="robustmean.robustmean.html#cvariance_nonneg">[apply</a></span> <span class="id">cvariance_nonneg|lra]</span>.<br/>
<span class="id">rewrite</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#subRB">-!coqRE</a></span> <span class="id">subRB</span> <span class="id">subRR</span> <span class="id">add0R</span>.<br/>
<span class="id">rewrite</span> <span class="id">-!divRE</span> <span class="id">-Rdiv_mult_distr</span> <span class="id">Rmult_minus_distr_l</span> <span class="id">mulR1</span>.<br/>
<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.RIneq.html#Rmult_div_assoc">rewrite</a></span> <span class="id">Rmult_div_assoc</span> (<span class="id">mulRC</span> <span class="id">2</span>) <span class="id">-Rmult_div_assoc</span> <span class="id">divRR</span> <span class="id">?mulR1</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">_</a></span> <span class="id">:</span> <span class="id">2%:R</span> <span class="id">=</span> <span class="id">2</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> <span class="id">Rle_refl</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply/eqP;</span> <span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">lemma_1_4_1</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">invariant</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">Rabs</a></span> (<span class="id">mu</span> <span class="id">-</span> <span class="id">mu_hat</span>) <span class="id"><a href="robustmean.weightedmean.html#var">&lt;=</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">sqrt</a></span>(<span class="id">var</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">eps</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">/</a></span> (<span class="id">2-eps</span>)) <span class="id"><a href="robustmean.weightedmean.html#var_hat">+</a></span> <span class="id">sqrt</span>(<span class="id">var_hat</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">eps</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">/</a></span> (<span class="id">1-eps</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof34')">Proof.</span></div>
<div class="proofscript" id="proof34">
<span class="id">move=&gt;</span> <span class="id">IC</span>.<br/>
<span class="id">unfold</span> <span class="id">eps_max</span> <span class="gallina-kwd">in</span> <span class="id">low_eps</span>.<br/>
<span class="id">have</span> <span class="id">I1C</span> <span class="id">:</span> <span class="id">invariant1</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">lemma1_4_start</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/RltP;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#Order.POrderTheory.lt_neqAle">rewrite</a></span> <span class="id">lt_neqAle</span> <span class="id">eq_sym</span> <span class="id">PC_neq0/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">sumr_ge0</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_;</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#coqRE">rewrite</a></span> <span class="id">coqRE</span> <span class="id">mulr_ge0//;</span> <span class="id">apply/RleP;</span> <span class="id">apply</span> (<span class="id">weight_C</span> <span class="id">_</span>).<span class="id">1</span>.<br/>
<span class="id">apply:</span> (<span class="id">@Rle_trans</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">_</a></span> (<span class="id">`|mu</span> <span class="id">-</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3e57074ab0a6a36b253e873a1bdac6ad">mu_wave|</a></span> <span class="id">+</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">`|mu_hat</a></span> <span class="id">-</span> <span class="id">mu_wave|</span>)).<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">-&gt;</a></span> <span class="id"><a href="robustmean.weightedmean.html#mu_hat">:</a></span> <span class="id">mu</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">-</a></span> <span class="id">mu_hat</span> <span class="id"><a href="robustmean.weightedmean.html#mu_wave">=</a></span> (<span class="id">mu</span> <span class="id">-</span> <span class="id">mu_wave</span>) <span class="id">+</span> (<span class="id">mu_wave</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3e57074ab0a6a36b253e873a1bdac6ad">-</a></span> <span class="id">mu_hat</span>) <span class="gallina-kwd">by</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.RIneq.html#Rle_trans">apply:</a></span> (<span class="id">Rle_trans</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rbasic_fun.html#Rabs_triang">_</a></span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Rabs_triang</span> <span class="id">_</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Rplus_le_compat_l</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rbasic_fun.html#Rabs_minus_sym">rewrite</a></span> <span class="id">Rabs_minus_sym</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">right</span>.<br/>
<span class="id">have</span> <span class="id">?</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">:</a></span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">eps</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-pr_bad;</span> <span class="id">apply</span> <span class="id">Pr_ge0</span>.<br/>
<span class="id">have</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">?</a></span> <span class="id">:</span> <span class="id">0</span> <span id="i:231" class="id"><span id="i:230" class="id"><span id="i:229" class="id"><span id="i:228" class="id"><span id="i:227" class="id"><a name="i:231" class="">&lt;</a></span></span></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">i</a></span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id"><a href="robustmean.weightedmean.html#i:227">C</a></span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">ltR_neqAle;</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply/eqP;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#eq_sym">rewrite</a></span> <span class="id">eq_sym;</span> <span class="id">apply</span> <span class="id">PC_neq0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">sumCi_ge0</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
<span class="id">apply:</span> <span class="id">leR_add;</span> <span class="id">rewrite</span> <span class="id">-</span>(<span class="id">geR0_norm</span> <span class="id">_</span> (<span class="id">sqrt_pos</span> <span class="id">_</span>))<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.R_sqr.html#Rsqr_le_abs_0">;</a></span> <span class="id">apply</span> <span class="id">Rsqr_le_abs_0;</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.R_sqrt.html#Rsqr_sqrt">rewrite</a></span> <span class="id">Rsqr_sqrt</span>.<br/>
<span class="id"><a href="robustmean.weightedmean.html#lemma_1_4_step2">-</a></span> <span class="id">apply</span> <span class="id">lemma_1_4_step2</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
<span class="id">-</span> <span class="id">repeat</span> <span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">try</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="robustmean.robustmean.html#cvariance_nonneg">+</a></span> <span class="id">apply</span> <span class="id">cvariance_nonneg</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#invR_ge0">+</a></span> <span class="id">apply</span> <span class="id">invR_ge0;</span> <span class="id">lra</span>.<br/>
<span class="id"><a href="robustmean.weightedmean.html#lemma_1_4_step1">-</a></span> <span class="id">apply</span> <span class="id">lemma_1_4_step1</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/invariant1</span> <span class="gallina-kwd">in</span> <span class="id">I1C;</span> <span class="id">apply/eqP;</span> <span class="id">lra</span>.<br/>
<span class="id">-</span> <span class="id">repeat</span> <span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">try</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="robustmean.robustmean.html#variance_nonneg">+</a></span> <span class="id">apply</span> <span class="id">variance_nonneg</span>. <br/>
&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#invR_ge0">+</a></span> <span class="id">apply</span> <span class="id">invR_ge0;</span> <span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">eqn_a6_a9</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#77d341fe206b2891763e25999ffddca2">16</a></span> <span class="id">*</span> <span class="id">var</span> <span class="id">&lt;=</span> <span class="id">var_hat</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">invariant</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id"><a href="robustmean.weightedmean.html#i:232">good</a></span>) <span class="id"><a href="robustmean.weightedmean.html#i:232">C</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#tau">*</a></span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#i:232">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#77d341fe206b2891763e25999ffddca2">*</a></span> <span class="id">tau</span> <span class="id">i</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">&lt;=</a></span> <span class="id">0</span>.<span class="id">25</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">*</a></span> (<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">1</a></span> <span class="id">-</span> <span class="id">eps</span>) <span class="id">*</span> <span class="id">var_hat</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof35')">Proof.</span></div>
<div class="proofscript" id="proof35">
<span class="id">rewrite</span> <span class="id">/eps_max;</span> <span class="id">move</span> <span class="id">=&gt;</span> <span class="id">var16</span> <span class="id">IC</span>.<br/>
<span class="id">unfold</span> <span class="id">eps_max</span> <span class="gallina-kwd">in</span> <span class="id">low_eps</span>.<br/>
<span class="id">have</span> <span class="id">I1C</span> <span class="id">:</span> <span class="id">invariant1</span>. <span class="comment">(*&nbsp;todo:&nbsp;repeated,&nbsp;factor&nbsp;out&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">lemma1_4_start</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/RltP;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#Order.POrderTheory.lt_neqAle">rewrite</a></span> <span class="id">lt_neqAle</span> <span class="id">eq_sym</span> <span class="id">PC_neq0/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">sumr_ge0</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_;</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#coqRE">rewrite</a></span> <span class="id">coqRE</span> <span class="id">mulr_ge0//;</span> <span class="id">apply/RleP;</span> <span class="id">apply</span> (<span class="id">weight_C</span> <span class="id">_</span>).<span class="id">1</span>.<br/>
<span class="id">have</span> <span class="id">[/psumr_eq0P</span> <span class="id">PiCieq0|?]</span> <span class="id">:=</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">eqVneq</a></span> (<span class="id">\sum_</span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">i</a></span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id"><a href="robustmean.weightedmean.html#i:237">C</a></span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>) <span class="id">0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@leR_trans</span> <span class="id">0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right;</span> <span class="id">apply/eqP;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssrnum.html#Num.Theory.psumr_eq0">rewrite</a></span> <span class="id">psumr_eq0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/allP</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_;</span> <span class="id">rewrite</span> <span class="id">PiCieq0//;</span> <span class="id">first</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mul0R">rewrite</a></span> <span class="id">mul0R</span> <span class="id">eqxx</span> <span class="id">implybT//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">i0</span> <span class="id">_;</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#coqRE">rewrite</a></span> <span class="id">coqRE</span> <span class="id">mulr_ge0//;</span> <span class="id">apply/RleP;</span> <span class="id">apply</span> <span class="id">weight_C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;i</span> <span class="id">_</span>. <span class="id">rewrite</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssrnum.html#Num.Theory.mulr_ge0">!coqRE</a></span> <span class="id">mulr_ge0//;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">apply/RleP;</span> <span class="id">apply</span> <span class="id">tau_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.algebra.ssrnum.html#Num.Theory.mulr_ge0">rewrite</a></span> <span class="id">mulr_ge0//;</span> <span class="id">apply/RleP;</span> <span class="id">apply</span> <span class="id">weight_C</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">mulR_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">mulR_ge0</span>. <span class="id">interval</span>. <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@leR_trans</span> (<span class="id">16</span> <span class="id">*</span> <span class="id">var</span>)) <span class="id">=&gt;</span> <span class="id">//</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">first</span> <span class="id">lra;</span> <span class="id">apply</span> <span class="id">cvariance_nonneg</span>.<br/>
<span class="id">have</span> <span class="id">sumCi_gt0</span> <span class="id">:</span> <span class="id">0</span> <span id="i:246" class="id"><span id="i:245" class="id"><span id="i:244" class="id"><span id="i:243" class="id"><span id="i:242" class="id"><a name="i:246" class="">&lt;</a></span></span></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">i</a></span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id"><a href="robustmean.weightedmean.html#i:242">C</a></span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">ltR_neqAle;</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span> <span class="gallina-kwd">by</span> <span class="id">apply/eqP;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#eq_sym">rewrite</a></span> <span class="id">eq_sym</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for mathcomp.analysis.Rstruct#RleP">-</a></span> <span class="id">apply/RleP</span>. <span class="id">apply</span> <span class="id">sumr_ge0</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_</span>. <span class="id"><a href="NOTFOUND the module url for mathcomp.analysis.Rstruct#RmultE">rewrite</a></span> <span class="id">RmultE</span> <span class="id">mulr_ge0//</span>. <span class="id">apply/RleP</span>. <span class="id">apply</span> <span class="id">weight_C</span>.<br/>
<span class="id">have</span> <span class="id">Hvar_hat_2_eps:</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">var_hat</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.pr_bad">-mulRA</a></span> <span class="id">-pr_bad;</span> <span class="id">repeat</span> <span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id"><a href="robustmean.robustmean.html#variance_nonneg">[apply</a></span> <span class="id">variance_nonneg|lra|exact:</span> <span class="id">Pr_ge0]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/var_hat</span>.<br/>
<span class="id">have</span> <span class="id">PrPgoodpos</span> <span class="id">:</span> <span class="id">0</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.good">&lt;</a></span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span> <span class="id">pr_bad;</span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#Pr_of_cplt">rewrite</a></span> <span class="id">Pr_of_cplt;</span> <span class="gallina-kwd">by</span> <span class="id">lra</span>.<br/>
<br/>
<span class="comment">(*a6*)</span><br/>
<span class="id">apply</span> <span class="id">leR_trans</span> <span class="gallina-kwd">with</span> (<span class="id">y</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">:=</a></span> (<span class="id">1</span> <span class="id">-</span> <span class="id"><a href="robustmean.weightedmean.html#var">eps</a></span>) <span class="id">*</span> (<span class="id">var</span> <span class="id"><a href="robustmean.weightedmean.html#mu_hat">+</a></span> (<span class="id">mu</span> <span class="id">-</span> <span class="id">mu_hat</span>)²)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-!pr_good</span> <span class="id">Rmult_comm</span> <span class="id">-leR_pdivr_mulr//;</span> <span class="id">apply</span> <span class="id">eqn1_1</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
<br/>
<span class="comment">(*a6-a7*)</span><br/>
<span class="id">apply</span> <span class="id">leR_trans</span> <span class="gallina-kwd">with</span> (<span class="id">y</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">:=</a></span>(<span class="id">1</span> <span class="id">-</span> <span class="id"><a href="robustmean.weightedmean.html#var">eps</a></span>) <span class="id">*</span> (<span class="id">var</span> <span class="id"><a href="robustmean.weightedmean.html#var">+</a></span> (<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">sqrt</a></span>(<span class="id">var</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">eps</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">/</a></span> (<span class="id">2-eps</span>)) <span class="id"><a href="robustmean.weightedmean.html#var_hat">+</a></span> <span class="id">sqrt</span>(<span class="id">var_hat</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">eps</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">/</a></span> (<span class="id">1-eps</span>)))²)).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_wpmul2l</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#subR_ge0">-pr_bad</a></span> <span class="id">subR_ge0;</span> <span class="gallina-kwd">by</span> <span class="id">exact:</span> <span class="id">Pr_1</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_add2l</span>. <br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Rsqr_le_abs_1</span>. <span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#77d341fe206b2891763e25999ffddca2">[x</a></span> <span class="gallina-kwd">in</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#geR0_norm">_</a></span> <span class="id">&lt;=</span> <span class="id">x]geR0_norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">lemma_1_4_1</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">/addR_ge0/sqrt_pos/sqrt_pos</span>.<br/>
<br/>
<span class="comment">(*a7-a8*)</span><br/>
<span class="id">apply</span> <span class="id">leR_trans</span> <span class="gallina-kwd">with</span> (<span class="id">y</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">:=</a></span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>) <span class="id">*</span> <span class="id">var_hat</span> <span class="id">*</span> (<span class="id">/16</span> <span class="id">+</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.R_sqrt.html#sqrt">*</a></span> (<span class="id">/</span>(<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">4*sqrt</a></span>(<span class="id">2-eps</span>)) <span class="id">+</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">/</a></span>(<span class="id">sqrt</span>(<span class="id">1-eps</span>)))²)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-</span>(<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">mulRA</a></span> (<span class="id">1-eps</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_pmul2l;</span> <span class="id">first</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRDr">rewrite</a></span> <span class="id">mulRDr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_add;</span> <span class="id">first</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRA">rewrite</a></span> <span class="id">mulRA</span> <span class="id">mulRA</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">Rsqr_sqrt</span> (<span class="id">var_hat</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span>))<span class="id">;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="id">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-Rsqr_mult</span> <span class="id">mulRDr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Rsqr_incr_1;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">last</span> (<span class="id">apply</span> <span class="id">addR_ge0;</span> (<span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">first</span> <span class="id">apply</span> <span class="id">sqrt_pos;</span> <span class="id">left;</span> <span class="id">apply</span> <span class="id">invR_gt0;</span> <span class="id">interval</span>))<span class="id">;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">last</span> (<span class="id">apply</span> <span class="id">addR_ge0;</span> <span class="id">apply</span> <span class="id">sqrt_pos</span>).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_add;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[rewrite</span> <span class="id">-</span>(<span class="id">sqrt_Rsqr</span> <span class="id">4</span>)<span class="id">;</span> <span class="id">last</span> <span class="id">lra;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-sqrt_mult/Rsqr;</span> <span class="id">[|lra|lra]|</span> <span class="id">];</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-sqrt_inv</span> <span class="id">-sqrt_mult;</span> <span class="id">try</span> <span class="id">apply:</span> <span class="id">Hvar_hat_2_eps;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">try</span> <span class="id">apply:</span> <span class="id">invR_ge0;</span> <span class="id">try</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">sqrt_le_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span> <span class="id">rewrite</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRA">/Rdiv</a></span> <span class="id">-!mulRA;</span> <span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">cvariance_nonneg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">repeat</span> <span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">[lra|rewrite</span> <span class="id">-pr_bad;</span> <span class="id">apply</span> <span class="id">Pr_ge0|apply</span> <span class="id">invR_ge0;</span> <span class="id">lra]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulR_ge0">-</a></span> <span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">first</span> <span class="id">exact:</span> <span class="id">Hvar_hat_2_eps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">[lra|left;apply</span> <span class="id">invR_gt0;lra]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#invRM">rewrite</a></span> <span class="id">invRM;</span> <span class="id">[|apply</span> <span class="id">/eqP;lra|apply</span> <span class="id">/eqP;</span> <span class="id">lra]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">mulRC</span> (<span class="id">/</span> <span class="id">_</span>)) <span class="id">mulRA</span> (<span class="id">mulRC</span> <span class="id">_</span> (<span class="id">/</span> <span class="id">_</span>)) <span class="id">mulRA</span> <span class="id">mulRA</span> <span class="id">mulRA</span> <span class="id">/Rdiv</span> <span class="id">-4!mulRA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_pmul</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="robustmean.robustmean.html#cvariance_nonneg">-</a></span> <span class="id">apply</span> <span class="id">cvariance_nonneg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span> <span class="id">repeat</span> <span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">[lra</span> <span class="id">|rewrite-pr_bad;</span> <span class="id">apply</span> <span class="id">Pr_ge0|apply</span> <span class="id">invR_ge0;</span> <span class="id">lra]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRC">rewrite</a></span> <span class="id">mulRC</span> <span class="id">/Rsqr;</span> <span class="gallina-kwd">by</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">right</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.R_sqrt.html#Rsqr_sqrt">rewrite</a></span> <span class="id">Rsqr_sqrt;</span> <span class="id">[by</span> <span class="id">right|nra]</span>.<br/>
<br/>
<span class="comment">(*a8-a9*)</span><br/>
<span class="id">apply</span> <span class="id">leR_trans</span> <span class="gallina-kwd">with</span> (<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">y</a></span> <span class="id">:=</span> (<span class="id">1-eps</span>) <span class="id">*</span> <span class="id">var_hat</span> <span class="id">*</span> (<span class="id">/16</span> <span class="id">+</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps_max</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#2299a6ef56270a66cc1b95489d0f6e3a">*</a></span> <span class="id">Rsqr</span> (<span class="id">/</span>(<span class="id">4</span> <span class="id">*</span> <span class="id">sqrt</span> (<span class="id">2</span> <span class="id">-</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#2299a6ef56270a66cc1b95489d0f6e3a">eps_max</a></span>)) <span class="id">+</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">/sqrt</a></span>(<span class="id">1-eps_max</span>)))).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/eps_max</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_pmul</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">first</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">variance_nonneg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">addR_ge0;</span> <span class="id">first</span> <span class="id">lra</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">repeat</span> <span class="id">apply</span> <span class="id">mulR_ge0;[lra|rewrite</span> <span class="id">-pr_bad;</span> <span class="id">apply</span> <span class="id">Pr_ge0|</span> <span class="id">|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">addR_ge0;</span> <span class="id">apply</span> <span class="id">invR_ge0;</span> <span class="id">first</span> <span class="id">apply</span> <span class="id">mulR_gt0;</span> <span class="id">try</span> <span class="id">lra;</span> <span class="id">apply</span> <span class="id">sqrt_lt_R0;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">addR_ge0;</span> <span class="id">apply</span> <span class="id">invR_ge0;</span> <span class="id">first</span> <span class="id">apply</span> <span class="id">mulR_gt0;</span> <span class="id">try</span> <span class="id">lra;</span> <span class="id">apply</span> <span class="id">sqrt_lt_R0;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">right</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">right</span>.  <br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_pmul;</span> <span class="id">first</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">Rle_0_sqr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Rsqr_bounds_le</span>. <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">interval</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">mulR_gt0;</span> <span class="id">first</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">sqrt_lt_R0;</span> <span class="id">first</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_wpmul2l;</span> <span class="id">first</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">sqrt_le_1;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">sqrt_lt_R0;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">sqrt_le_1;</span> <span class="id">lra</span>.<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRC">rewrite</a></span> <span class="id">mulRC</span> <span class="id">mulRA</span>.<br/>
<span class="id">apply</span> <span class="id">leR_wpmul2r</span> <span class="id">=&gt;</span> <span class="id">//</span>. <span class="id">exact:</span> <span class="id">variance_nonneg</span>.<br/>
<span class="id">apply</span> <span class="id">leR_wpmul2r;</span> <span class="id">first</span> <span class="id">lra</span>.<br/>
<span class="id">rewrite</span> <span class="id">/eps_max</span>.<br/>
<span class="id">interval</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">eqn_a10_a11</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#77d341fe206b2891763e25999ffddca2">16</a></span> <span class="id">*</span> <span class="id">var</span> <span class="id">&lt;=</span> <span class="id">var_hat</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">0</span> <span id="i:252" class="id"><span id="i:251" class="id"><span id="i:250" class="id"><span id="i:249" class="id"><span id="i:248" class="id"><a name="i:252" class="">&lt;</a></span></span></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">i</a></span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id"><a href="robustmean.weightedmean.html#i:248">C</a></span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">invariant</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">-&gt;</a></span><br/>
&nbsp;&nbsp;<span class="id">2/3</span> <span class="id">*</span> <span class="id">var_hat</span> <span class="id">&lt;=</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">i</a></span> <span class="gallina-kwd">in</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">bad</a></span>) <span class="id"><a href="robustmean.weightedmean.html#i:253">C</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#tau">*</a></span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#i:253">i</a></span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof36')">Proof.</span></div>
<div class="proofscript" id="proof36">
<span class="id">rewrite</span> <span class="id">/eps_max;</span> <span class="id">move</span> <span class="id">=&gt;</span> <span class="id">var16</span> <span class="id">sumCi_pos</span> <span class="id">HiC</span>.<br/>
<span class="id">unfold</span> <span class="id">eps_max</span> <span class="gallina-kwd">in</span> <span class="id">low_eps</span>.<br/>
<span class="id">have</span> <span class="id">PrPgoodpos</span> <span class="id">:</span> <span class="id">0</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.good">&lt;</a></span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span> <span class="gallina-kwd">by</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.pr_good">rewrite</a></span> <span class="id">pr_good;</span> <span class="id">lra</span>.<br/>
<br/>
<span class="id">have</span> <span class="id">-&gt;:</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">i</a></span> <span class="gallina-kwd">in</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">bad</a></span>) <span class="id"><a href="robustmean.weightedmean.html#i:258">C</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#tau">*</a></span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#i:258">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">*</a></span> <span class="id">tau</span> <span class="id">i</span> <span class="id">=</span><br/>
&nbsp;&nbsp;<span class="id">var_hat</span> <span class="id">*</span> (<span class="id">\sum_</span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">i</a></span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id"><a href="robustmean.weightedmean.html#i:263">C</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">i</a></span> <span class="id">*</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">P</a></span> <span class="id">i</span>) <span class="id">-</span> (<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id"><a href="robustmean.weightedmean.html#i:268">good</a></span>) <span class="id"><a href="robustmean.weightedmean.html#i:268">C</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#tau">*</a></span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#i:268">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#::R_scope:x_'-'_x">*</a></span> <span class="id">tau</span> <span class="id">i</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/var_hat</span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#Ex">/Var{1}/Ex</a></span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.RIneq.html#Rplus_eq_reg_r">apply:</a></span> (<span class="id">Rplus_eq_reg_r</span> (<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id"><a href="robustmean.weightedmean.html#i:273">good</a></span>) <span class="id"><a href="robustmean.weightedmean.html#i:273">C</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#tau">*</a></span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#i:273">i</a></span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.RIneq.html#Rplus_opp_l">-addRA</a></span> <span class="id">Rplus_opp_l</span> <span class="id">addR0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/bad</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">-&gt;</span> <span id="i:287" class="id"><span id="i:286" class="id"><span id="i:285" class="id"><span id="i:284" class="id"><span id="i:283" class="id"><a name="i:287" class="">:</a></span></span></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.good">i</a></span> <span class="gallina-kwd">in</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">~:</a></span> <span class="id"><a href="robustmean.weightedmean.html#i:283">good</a></span>) <span class="id"><a href="robustmean.weightedmean.html#i:283">C</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#tau">*</a></span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#i:283">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3e57074ab0a6a36b253e873a1bdac6ad">*</a></span> <span class="id">tau</span> <span class="id">i</span> <span class="id">+</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id"><a href="robustmean.weightedmean.html#i:288">good</a></span>) <span class="id"><a href="robustmean.weightedmean.html#i:288">C</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#tau">*</a></span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#i:288">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">*</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">tau</a></span> <span class="id">i</span> <span id="i:297" class="id"><span id="i:296" class="id"><span id="i:295" class="id"><span id="i:294" class="id"><span id="i:293" class="id"><a name="i:297" class="">=</a></span></span></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">i</a></span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id"><a href="robustmean.weightedmean.html#i:293">C</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#tau">*</a></span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#i:293">i</a></span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-big_union/=;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#disjoints_subset">rewrite</a></span> <span class="id">disjoints_subset</span> <span class="id">setCK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#setUC">rewrite</a></span> <span class="id">setUC</span> <span class="id">setUCr/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">eq_bigl</span> <span class="id">=&gt;</span> <span class="id">//=</span> <span class="id">u;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finset.html#inE">rewrite</a></span> <span class="id">inE</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#big_distrl">rewrite</a></span> <span class="id">big_distrl/=</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/tau/mu_hat</span> <span class="id">/P'</span> <span class="id">Weighted.dE</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRC">rewrite</a></span> <span class="id">mulRC</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRA">{2}/X'</a></span> <span class="id">-mulRA;</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">congr</a></span> (<span class="id">_</span> <span class="id">*</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/Weighted</span>.<span class="id">total</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Raxioms.html#Rinv_l">-mulRA</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulR1">Rinv_l</a></span> <span class="id">?mulR1//</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> <span class="id">Rgt_not_eq</span>.<br/>
<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#leR_trans">apply</a></span> (<span class="id">@leR_trans</span> (<span class="id">var_hat</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">*</a></span> (<span class="id">1-3/2*eps</span>) <span id="i:307" class="id"><span id="i:306" class="id"><span id="i:305" class="id"><span id="i:304" class="id"><span id="i:303" class="id"><span id="i:302" class="id"><span id="i:301" class="id"><span id="i:300" class="id"><span id="i:299" class="id"><span id="i:298" class="id"><a name="i:307" class="">-</a></span></span></span></span></span></span></span></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id"><a href="robustmean.weightedmean.html#i:298">good</a></span>) <span class="id"><a href="robustmean.weightedmean.html#i:298">C</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#tau">*</a></span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#i:298">i</a></span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span>))<span class="id">;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-!addR_opp;</span> <span class="id">apply:</span> <span class="id">Rplus_le_compat_r</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_wpmul2l;</span> <span class="id">first</span> <span class="id">exact:</span> <span class="id">variance_nonneg</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@leR_trans</span> ((<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span> <span class="id">/</span> <span class="id">2</span>) <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">*</a></span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>)))<span class="id">;</span> <span class="id">first</span> <span class="id">nra</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">leR_trans</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span> (<span class="id">good_mass</span> <span class="id">HiC</span>).<br/>
&nbsp;&nbsp;<span class="id">move/</span>(<span class="id">Rmult_le_compat_r</span> (<span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span>) <span class="id">_</span> <span class="id">_</span> (<span class="id">Pr_ge0</span> <span class="id">_</span> <span class="id">good</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-Rmult_div_swap</span> <span class="id">Rmult_div_l;</span> <span class="id">last</span> <span class="id">exact:</span> <span class="id">Rgt_not_eq</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#Pr_to_cplt">rewrite</a></span> <span class="id">Pr_to_cplt</span> <span class="id">pr_bad;</span> <span class="id">apply</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_sumRl</span> <span class="id">=&gt;</span> <span class="id">//i</span> <span class="id">igood</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span> <span class="gallina-kwd">by</span> <span class="id">right</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">mulR_ge0</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">apply</span> (<span class="id">weight_C</span> <span class="id">_</span>).<span class="id">1</span>.<br/>
<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#leR_trans">apply</a></span> (<span class="id">@leR_trans</span> ((<span class="id">1</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">-</a></span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">3</a></span> <span class="id">/</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span> <span class="id">-</span> <span class="id">0</span>.<span class="id">25</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.eps">*</a></span> (<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">1</a></span> <span class="id">-</span> <span class="id"><a href="robustmean.weightedmean.html#var_hat">eps</a></span>)) <span class="id">*</span> <span class="id">var_hat</span>))<span class="id">;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRBl">rewrite</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRC">mulRBl</a></span> (<span class="id">mulRC</span> <span class="id">var_hat</span>). <br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">leR_add;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">Ropp_le_contravar;</span> <span class="id">exact:</span> <span class="id">eqn_a6_a9</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_wpmul2r;</span> <span class="id">first</span> <span class="id">exact:</span> <span class="id">variance_nonneg</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">right</span>.<br/>
<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#leR_trans">apply</a></span> (<span class="id">@leR_trans</span> ((<span class="id">1</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">-</a></span> <span class="id"><a href="robustmean.weightedmean.html#eps_max">3</a></span> <span class="id">/</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps_max</span> <span class="id">-</span> <span class="id">0</span>.<span class="id">25</span> <span class="id"><a href="robustmean.weightedmean.html#eps_max">*</a></span> (<span class="id">1</span> <span class="id">-</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">eps_max</a></span>)) <span class="id">*</span> <span class="id">var_hat</span>))<span class="id">;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_wpmul2r;</span> <span class="id">first</span> <span class="id">apply</span> <span class="id">variance_nonneg</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/eps_max</span>. <span class="id">nra</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id"><a href="robustmean.weightedmean.html#eps_max">rewrite/eps_max;</a></span> <span class="id">apply</span> <span class="id">leR_wpmul2r;</span> <span class="id">first</span> <span class="id">apply</span> <span class="id">variance_nonneg;</span> <span class="id">nra</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">eqn1_3_4</span> (<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.U">S:</a></span> <span class="id">{set</span> <span class="id">U}</span>)<span id="C':309" class="id"><a name="C':309" class="">:</a></span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span> <span class="id">C'</span> <span class="id">:=</span> <span class="id">update</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">0</span> <span class="id">&lt;</span> <span class="id">tau_max</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">i</a></span> <span class="gallina-kwd">in</span> <span class="id"><a href="robustmean.weightedmean.html#C':309">S</a></span>) (<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">1</a></span> <span class="id">-</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.P">C'</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">i</a></span>) <span class="id">*</span> <span class="id">P</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3e57074ab0a6a36b253e873a1bdac6ad">i</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">=</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">i</a></span> <span class="gallina-kwd">in</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">S</a></span>) (<span class="id">1</span> <span class="id">-</span> <span class="id">C</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3e57074ab0a6a36b253e873a1bdac6ad">i</a></span>) <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>) <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">+</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">1</span> <span class="id">/</span> <span class="id">tau_max</span> <span class="id">*</span> (<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">S</span> ) <span class="id"><a href="robustmean.weightedmean.html#i:320">C</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#tau">*</a></span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#i:320">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">*</a></span> <span class="id">tau</span> <span class="id">i</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof37')">Proof.</span></div>
<div class="proofscript" id="proof37">
<span class="id">move</span> <span class="id">=&gt;</span> <span class="id">C'</span> <span class="id">tau_max_gt0</span>.<br/>
<span class="id">have</span> <span class="id">&lt;-</span> <span id="i:329" class="id"><span id="i:328" class="id"><span id="i:327" class="id"><span id="i:326" class="id"><span id="i:325" class="id"><a name="i:329" class="">:</a></span></span></span></span></span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">\sum_</a></span>(<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">i</a></span> <span class="gallina-kwd">in</span> <span class="id">S</span>) (<span class="id">C</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">i</a></span> <span class="id">-</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.P">C'</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a">i</a></span>) <span class="id">*</span> <span class="id">P</span> <span class="id">i=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">1</span> <span class="id">/</span> <span class="id">tau_max</span> <span class="id">*</span> (<span class="id">\sum_</span>(<span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">i</a></span> <span class="gallina-kwd">in</span> <span class="id">S</span>) <span class="id"><a href="robustmean.weightedmean.html#i:330">C</a></span> <span class="id">i</span> <span class="id"><a href="robustmean.weightedmean.html#tau">*</a></span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#i:330">i</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">*</a></span> <span class="id">tau</span> <span class="id">i</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/C'</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#big_distrr">/update</a></span> <span class="id">big_distrr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_</span> <span class="id">/=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/update_ffun</span> <span class="id">ffunE</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">[-&gt;|Ci-]</span> <span class="id">:=</span> <span class="id"><a href="robustmean.weightedmean.html#bounding_empirical_mean.C">eqVneq</a></span> (<span class="id">C</span> <span class="id">i</span>) <span class="id">0;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#orbT">rewrite</a></span> <span class="id">orbT</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulR0">subRR</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079">!</a></span>(<span class="id">mulR0,mul0R</span>).<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssrbool.html#orbF">rewrite</a></span> <span class="id">orbF</span> <span class="id">ifF;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> (<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#gtR_eqF">negbTE</a></span> (<span class="id">gtR_eqF</span> <span class="id">_</span> <span class="id">_</span> <span class="id">tau_max_gt0</span>))<span class="id">/=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">field;</span> <span class="id">exact/eqP/gtR_eqF</span>.<br/>
<span class="id">rewrite</span> <span class="id">-big_split/=</span>.<br/>
<span class="id">apply</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">HiS</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#addRA">-mulRDl</a></span> <span class="id">addRA</span> <span class="id">subRK</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">bounding_empirical_mean</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">lemma_1_5</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id"><a href="robustmean.weightedmean.html#U:335">{fdist</a></span> <span class="id">U}</span>).<br/>
<span class="vernacular">Variable</span> <span class="id"><a href="robustmean.weightedmean.html#lemma_1_5.P">X</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#8fe87352e8bd617fea784762bca86e00">:</a></span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>.<br/>
<br/>
<span class="vernacular">Variable</span> <span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">good</span> <span class="id"><a href="robustmean.weightedmean.html#lemma_1_5.U">:</a></span> <span class="id">{set</span> <span class="id">U}</span>.<br/>
<br/>
<span class="vernacular">Variable</span> <span class="id">eps</span> <span class="id">:</span> <span class="id">R</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span> <span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">lemma_1_5</span> <span id="C':342" class="id"><a name="C':342" class="">:</a></span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span> <span class="id">C'</span> <span class="id">:=</span> <span class="id">update</span> <span class="id">C</span> <span class="id">PC_neq0</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">0</span> <span class="id">&lt;</span> <span class="id"><a href="robustmean.weightedmean.html#lemma_1_5.C">tau_max</a></span> <span class="id">C</span> <span class="id">PC_neq0</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">good</span>) (<span class="id"><a href="robustmean.weightedmean.html#i:343">C</a></span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>) <span class="id"><a href="robustmean.weightedmean.html#lemma_1_5.PC_neq0">*</a></span> <span class="id">tau</span> <span class="id">C</span> <span class="id"><a href="robustmean.weightedmean.html#i:343">PC_neq0</a></span> <span class="id">i</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">&lt;=</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">1</span> <span class="id">-</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#e1dae7ed53bffa765009199d058dd327">eps</a></span>) <span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">/</a></span> <span class="id">2</span> <span class="id">*</span> (<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> (<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#e768fa080234c1fdf3a88cd16dc231c5">bad</a></span> <span class="id"><a href="robustmean.weightedmean.html#lemma_1_5.C">good</a></span>)) (<span class="id"><a href="robustmean.weightedmean.html#i:348">C</a></span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>) <span class="id"><a href="robustmean.weightedmean.html#lemma_1_5.PC_neq0">*</a></span> <span class="id">tau</span> <span class="id">C</span> <span class="id"><a href="robustmean.weightedmean.html#i:348">PC_neq0</a></span> <span class="id"><a href="robustmean.weightedmean.html#invariant">i</a></span>) <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">invariant</span> <span class="id">P</span> <span class="id">C</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x">good</a></span> <span class="id">eps</span> <span class="id">-&gt;</span> <span class="id">invariant</span> <span class="id">P</span> <span class="id"><a href="robustmean.weightedmean.html#lemma_1_5.eps">C'</a></span> <span class="id">good</span> <span class="id">eps</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof38')">Proof.</span></div>
<div class="proofscript" id="proof38">
<span class="id">rewrite</span> <span class="id">/invariant</span> <span class="id">=&gt;</span> <span class="id">tau_max_gt0'</span> <span class="id">H1</span> <span class="id">IH1</span>.<br/>
<span class="id">rewrite</span> <span class="id">!eqn1_3_4</span> <span class="id">//</span>.<br/>
<span class="id">rewrite</span> <span class="id">!mulRDr</span>.<br/>
<span class="id">apply</span> <span class="id">leR_add;</span> <span class="id">first</span> <span class="id">exact</span> <span class="id">IH1</span>.<br/>
<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulRCA">rewrite</a></span> <span class="id">mulRCA</span>.<br/>
<span class="id">apply</span> <span class="id">leR_pmul2l</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply/divR_gt0</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
<span class="id">exact:</span> <span class="id">H1</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">lemma_1_5</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">base_case</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id"><a href="robustmean.weightedmean.html#A:353">{fdist</a></span> <span class="id">A}</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">eps</span> <span class="id">:</span> <span class="id">R</span>).<br/>
<span class="vernacular">Variable</span> <span class="id">good</span> <span class="id"><a href="robustmean.weightedmean.html#base_case.A">:</a></span> <span class="id">{set</span> <span class="id">A}</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#31493a873acc18a8368490ef56022c0c">ffun1</a></span> <span class="id"><a href="robustmean.weightedmean.html#base_case.A">:</a></span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x">{ffun</a></span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">R}</span> <span class="id">:=</span> <span class="id">[ffun=&gt;</span> <span id="base_case.ffun1_subproof" class="id"><a name="base_case.ffun1_subproof" class="">1]</a></span>.<br/>
<span class="vernacular">Let</span> <span class="id">ffun1_subproof</span> <span class="id">:</span> <span id="a:359" class="id"><span id="a:358" class="id"><span id="a:357" class="id"><a name="a:359" class="">[forall</a></span></span></span> <span class="id"><a href="robustmean.weightedmean.html#ffun1">a,</a></span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">ffun1</span> <span class="id">a]%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof39')">Proof.</span></div>
<div class="proofscript" id="proof39">
 <span class="gallina-kwd">by</span> <span class="id">apply/forallP</span> <span class="id">=&gt;</span> <span class="id">u;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#ffunE">rewrite</a></span> <span class="id">ffunE;</span> <span class="id">apply/RleP</span>. Qed.</div>
<span class="vernacular">Definition</span> <span class="id">Cpos_ffun1</span> <span class="id">:=</span> <span class="id">@mkNNFinfun</span> <span class="id"><a href="robustmean.weightedmean.html#base_case.ffun1_subproof">A</a></span> <span class="id">ffun1</span> <span class="id">ffun1_subproof</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span> <span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">Cpos_ffun1</span>  <span class="id">!=</span> <span class="id">0</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">base_case:</span> <span class="id">Pr</span> <span class="id">P</span> (<span class="id">bad</span> <span class="id"><a href="robustmean.weightedmean.html#base_case.eps">good</a></span>) <span class="id">=</span> <span class="id">eps</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">invariant</span> <span class="id">P</span> <span class="id">Cpos_ffun1</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd">good</a></span> <span class="id">eps</span> <span class="id">/\</span> <span class="id">invariant1</span> <span class="id">good</span> <span class="id">eps</span> <span class="id">PC_neq0</span> <span class="id">/\</span> <span class="id">is_01</span> <span class="id">Cpos_ffun1</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof40')">Proof.</span></div>
<div class="proofscript" id="proof40">
<span class="id">move</span> <span class="id">=&gt;</span> <span class="id">Hbad_ratio</span>.<br/>
<span class="id">rewrite</span> <span class="id">/invariant</span>.<br/>
<span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/Cpos_fun</span> <span class="id">/=</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">do</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#ffunE">rewrite</a></span> <span class="id">ffunE</span> <span class="id">subRR</span> <span class="id">mul0R</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#big1">rewrite</a></span> <span class="id">big1;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">[]</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">do</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#ffunE">rewrite</a></span> <span class="id">ffunE</span> <span class="id">subRR</span> <span class="id">mul0R</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#big1">rewrite</a></span> <span class="id">big1;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">[]</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.lib.ssrR#mulR0">rewrite</a></span> <span class="id">mulR0</span>. <span class="id">exact/RleP</span>.<br/>
<span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/invariant1</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/Pr</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">do</span> <span class="id"><a href="robustmean.weightedmean.html#dE">rewrite</a></span> <span class="id">Weighted.dE</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/Weighted</span>.<span class="id">total</span> <span class="id">/Cpos_ffun1/=</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">/ffun1</span> <span class="id">/=</span> <span class="id">ffunE</span> <span class="id">mul1R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-big_distrl/=</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id">[in</span> <span class="id">X</span> <span class="gallina-kwd">in</span> <span class="id">_</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#2299a6ef56270a66cc1b95489d0f6e3a">&lt;=</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.bigop.html#eq_bigr">_</a></span> <span class="id">*</span> <span class="id">/</span> <span class="id">X]eq_bigr</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">/ffun1</span> <span class="id">/=</span> <span class="id">ffunE</span> <span class="id">mul1R</span>.<br/>
&nbsp;&nbsp;<span class="id"><a href="NOTFOUND the module url for infotheo.probability.fdist#FDist.f1">rewrite</a></span> <span class="id">FDist.f1</span> <span class="id">invR1</span> <span class="id">mulR1</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id"><a href="robustmean.weightedmean.html#base_case.good">-/</a></span>(<span class="id">Pr</span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#Pr_to_cplt">P</a></span> <span class="id">good</span>) <span class="id">Pr_to_cplt</span> <span class="id">Hbad_ratio;</span> <span class="id">exact/RleP</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">move</span> <span class="id">=&gt;</span> <span class="id">i;</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.finfun.html#ffunE">rewrite</a></span> <span class="id">ffunE;</span> <span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">base_case</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">filter1d</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id"><a href="robustmean.weightedmean.html#U:362">{fdist</a></span> <span class="id">U}</span>).<br/>
<span class="vernacular">Variable</span> <span class="id"><a href="robustmean.weightedmean.html#filter1d.P">X</a></span> <span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#8fe87352e8bd617fea784762bca86e00">:</a></span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">good</span> <span class="id"><a href="robustmean.weightedmean.html#filter1d.U">:</a></span> <span class="id">{set</span> <span class="id">U}</span>.<br/>
<span class="vernacular">Variable</span> <span class="id">eps</span> <span class="id">:</span> <span class="id">R</span>.<br/>
<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">Program.Wf</span>.<br/>
<br/>
<span class="vernacular">Local</span> <span class="vernacular">Obligation</span> <span class="vernacular">Tactic</span> <span class="id">:=</span> <span class="id">idtac</span>.<br/>
<span class="id">Program</span> <span class="vernacular">Fixpoint</span> <span class="id">filter1d</span> (<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span> )<br/>
&nbsp;&nbsp;(<span class="id">C01</span> <span class="id"><a href="robustmean.weightedmean.html#C:367">:</a></span> <span class="id">is_01</span> <span class="id">C</span>) (<span class="id"><a href="NOTFOUND the module url for infotheo.probability.proba#Pr">Prbad</a></span> <span class="id"><a href="robustmean.weightedmean.html#bad">:</a></span> <span class="id">Pr</span> <span class="id">P</span> (<span class="id">bad</span> <span class="id"><a href="robustmean.weightedmean.html#filter1d.eps">good</a></span>) <span id="epsmax:370" class="id"><a name="epsmax:370" class="">=</a></span> <span class="id">eps</span>) (<span class="id">epsmax</span> <span class="id">:</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Reals.Rdefinitions.html#3942bfc45fbeaeee49010b741755982b">eps</a></span> <span class="id">&lt;=</span> <span id="HC:371" class="id"><a name="HC:371" class="">1/16</a></span>)<br/>
&nbsp;(<span class="id">HC</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{measure</span> <span class="id">#|</span> <span class="id">0</span>.<span class="id">-support</span> (<span class="id">tau</span> <span class="id">X</span> <span class="id">HC</span>)<span class="id">|</span> <span class="id">}</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">Bool.bool_dec</span> (<span class="id">Weighted.total</span> <span class="id">P</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.Init.Datatypes.html#true">C</a></span> <span class="id">!=</span> <span class="id">0</span>) <span class="id">true</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">right</span> <span class="id">_</span> <span class="id">=&gt;</span>  <span class="id">None</span><br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">left</span> <span class="id">H</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">#|</span> <span class="id">0</span>.<span class="id">-support</span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.fintype.html#234f50e13366f794cd6877cf832a5935">tau</a></span> <span class="id">X</span> <span class="id">H</span>) <span class="id">|</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">0</span>      <span class="id">=&gt;</span> <span class="id">None</span><br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">S</span> <span class="id"><a href="https://coq.inria.fr/doc/V8.18.0/stdlib/Coq.ssr.ssreflect.html#::boolean_if_scope:'if'_x_'then'_x_'else'_x">gas'</a></span> <span class="id">=&gt;</span> <span class="gallina-kwd">if</span> <span class="id">Rleb</span> (<span class="id"><a href="robustmean.weightedmean.html#filter1d.X">var_hat</a></span> <span class="id">X</span> <span class="id"><a href="robustmean.weightedmean.html#filter1d.X">H</a></span>) (<span class="id">var</span> <span class="id">X</span> <span class="id">good</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">then</span> <span class="id">Some</span> (<span class="id">mu_hat</span> <span class="id">X</span> <span class="id">H</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">else</span> <span class="id">filter1d</span> <span class="id">C01</span> <span class="id">Prbad</span> <span class="id"><a href="robustmean.weightedmean.html#update_valid_weight">epsmax</a></span> (<span class="id">update_valid_weight</span> <span class="id">X</span> <span class="id">C01</span> <span class="id">HC</span> <span class="id">Prbad</span> <span class="id">epsmax</span>)<br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span><br/>
<span class="gallina-kwd">end</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof41')">Next Obligation.</span></div>
<div class="proofscript" id="proof41">
<span class="comment">(*move=&gt;&nbsp;/=&nbsp;C&nbsp;HC&nbsp;_&nbsp;H&nbsp;_&nbsp;n&nbsp;Hn.<br/>
move:&nbsp;(ltn0Sn&nbsp;n);&nbsp;rewrite&nbsp;Hn&nbsp;=&gt;&nbsp;/card_gt0P&nbsp;[]&nbsp;u;&nbsp;rewrite&nbsp;supportE.<br/>
move:&nbsp;(tau_ge0&nbsp;X&nbsp;H&nbsp;u)=&gt;&nbsp;/[swap]&nbsp;/eqP&nbsp;/nesym&nbsp;/[conj]&nbsp;/ltR_neqAle&nbsp;Hu.*)</span><br/>
<span class="comment">(*<br/>
set&nbsp;stuC&nbsp;:=&nbsp;0.-support&nbsp;(tau&nbsp;(update&nbsp;C)).<br/>
set&nbsp;stC&nbsp;:=&nbsp;0.-support&nbsp;(tau&nbsp;C).<br/>
have&nbsp;stuC_stC:&nbsp;stuC&nbsp;\subset&nbsp;stC&nbsp;by&nbsp;admit.<br/>
have&nbsp;max_notin_sutC:&nbsp;arg_tau_max&nbsp;C&nbsp;\notin&nbsp;stuC.<br/>
-&nbsp;rewrite&nbsp;supportE;&nbsp;apply/negPn.<br/>
&nbsp;&nbsp;rewrite&nbsp;/tau&nbsp;/trans_min_RV&nbsp;sq_RV_pow2;&nbsp;apply/eqP/mulR_eq0;&nbsp;left.<br/>
&nbsp;&nbsp;rewrite&nbsp;/mu_hat.<br/>
&nbsp;&nbsp;rewrite&nbsp;/update.<br/>
*)</span><br/>
<span class="comment">(*<br/>
have&nbsp;max_in_stC:&nbsp;arg_tau_max&nbsp;C&nbsp;\in&nbsp;stC.<br/>
-&nbsp;rewrite&nbsp;supportE.<br/>
&nbsp;&nbsp;apply/eqP/nesym;&nbsp;apply&nbsp;ltR_neqAle.<br/>
&nbsp;&nbsp;by&nbsp;apply/(ltR_leR_trans&nbsp;Hu)/RleP/arg_rmax2_cond.<br/>
suff:&nbsp;stuC&nbsp;\proper&nbsp;stC&nbsp;by&nbsp;move/proper_card/leP.<br/>
apply/properP;&nbsp;split&nbsp;=&gt;&nbsp;//.<br/>
by&nbsp;exists&nbsp;(arg_tau_max&nbsp;C).<br/>
*)</span><br/>
Admitted.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof42')">Next Obligation.</span></div>
<div class="proofscript" id="proof42">
 Admitted.</div>
<br/>
<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof43')">Next Obligation.</span></div>
<div class="proofscript" id="proof43">
 Admitted.</div>
<br/>
<span class="vernacular">End</span> <span class="id">filter1d</span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
</body>
</html>
