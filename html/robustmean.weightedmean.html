
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module robustmean.weightedmean</title>
<meta name="description" content="Documentation of Coq module robustmean.weightedmean" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init('proofscript')">
<h1 class="title">Module robustmean.weightedmean</h1>
<div class="coq">
<span class="vernacular">From</span> <span class="id">mathcomp</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">all_ssreflect</span> <span class="id">ssralg</span> <span class="id">ssrnum</span> <span class="id">matrix</span>.<br/>
<span class="vernacular">From</span> <span class="id">mathcomp</span> <span class="vernacular">Require</span> <span class="id">boolp</span>.<br/>
<span class="vernacular">From</span> <span class="id">mathcomp</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">Rstruct</span> <span class="id">reals</span> <span class="id">mathcomp_extra</span>.<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">Reals</span> <span class="id">Lra</span>.<br/>
<span class="vernacular">From</span> <span class="id">infotheo</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">ssrR</span> <span class="id">Reals_ext</span> <span class="id">realType_ext</span> <span class="id">logb</span> <span class="id">ssr_ext</span> <span class="id">ssralg_ext</span>.<br/>
<span class="vernacular">From</span> <span class="id">infotheo</span> <span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">bigop_ext</span> <span class="id">fdist</span> <span class="id">proba</span>.<br/>
<br/>
<span class="gallina-kwd">Set</span> <span class="vernacular">Implicit</span> <span class="vernacular">Arguments</span>.<br/>
<span class="vernacular">Unset</span> <span class="vernacular">Strict</span> <span class="vernacular">Implicit</span>.<br/>
<span class="vernacular">Unset</span> <span class="vernacular">Printing</span> <span class="vernacular">Implicit</span> <span class="vernacular">Defensive</span>.<br/>
<br/>
<span class="vernacular">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">R_scope</span>.<br/>
<span class="vernacular">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">reals_ext_scope</span>.<br/>
<span class="vernacular">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">fdist_scope</span>.<br/>
<span class="vernacular">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">proba_scope</span>.<br/>
<br/>
<span class="vernacular">Import</span> <span class="id">Order.POrderTheory</span> <span class="id">Order.Theory</span> <span class="id">Num.Theory</span> <span class="id">GRing.Theory</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">R</span> <span class="id">:=</span> <span class="id">real_realType</span>.<br/>
<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">Interval.Tactic</span>.<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">robustmean</span>.<br/>
<br/>
<div class="ssrdoc md">
# lemmas 1.4, 1.5, etc.                                                    
                                                                           
This file contains a formalization of lemmas from the chapter 1 of         
Jacob Steinhardt, Robust learning: information theory and algorithms,      
PhD Standford 2018.                                                        
                                                                           
|   Definitions |    | Meaning                                            |
|---------------|----|----------------------------------------------------|
|       is_01 C | := | forall i, 0 &lt;= C i &lt;= 1                             
|    Weighted.d | == | given a distribution $d_0$ and a non-negative       
|               |    | function $g$, returns the distribution              
|               |    | $a\mapsto \frac{g(a) * d_0(a)}{\sum_b g(b) * d_0(b)}$ 
|       Split.d | == | given a distribution $d_0$ and a non-negative       
|               |    | function $h$, returns the distribution              
|               |    | $\begin{array}{rl} (a,b) \mapsto &amp; h(a) * d_0(a) \textrm{ if } b \\ &amp; (1 - h(a))*d_0(a) \textrm{ o.w.}\end{array}$ 
|      mean X A | := | `E_[X \| A]                                         
|      sq_dev X | == | "squared deviation": $(X - mean)^2$                 
|       var X A | := | `V_[X \| A]                                         
|         emean | == | empirical/estimate mean of the data,                
|               |    | weighted mean of all the points                     
|          evar | == | empirical variance                                  
|    emean_cond | == | mean of the at least $1 - \varepsilon$ fraction     
|               |    | (under c) of remaining good points                  
|     evar_cond | == |                                                     
|  filter1D_inv | == | the amount of mass removed from the good points is  
|               |    | smaller than that removed from the bad points       
| filter1D_invW | == | the amount of mass attached to the good points is   
|               |    | at least $1 - \varepsilon$                          
|      filter1D | == | robust mean estimation by comparing mean and        
|               |    | variance                                            
                                                                           
</div>
<br/>
<span class="vernacular">Section</span> <span class="id">move_to_mathcomp</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">setT_bool</span> <span class="id">:</span> <span class="id">[set:</span> <span class="id">bool]</span> <span class="id">=</span> <span class="id">[set</span> <span class="id">true;</span> <span class="id">false]</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
<span class="id">apply/eqP;</span> <span class="id">rewrite</span> <span class="id">eqEsubset;</span> <span class="id">apply/andP;</span> <span class="id">split</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply/subsetP</span> <span class="id">=&gt;</span> <span class="id">x;</span> <span class="id">rewrite</span> <span class="id">!inE;</span> <span class="id">case:</span> <span class="id">x</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">fsumr_gt0</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">eqType</span>) (<span class="id">F</span> <span class="id">:</span> <span class="id">U</span> <span class="id">-&gt;</span> <span class="id">R</span>) (<span class="id">s</span> <span class="id">:</span> <span class="id">seq</span> <span class="id">U</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">0</span> <span class="id">&lt;</span> <span class="id">\sum_</span>(<span class="id">i</span> <span class="id">&lt;-</span> <span class="id">s</span>) <span class="id">F</span> <span class="id">i</span>)<span class="id">%mcR</span> <span class="id">-&gt;</span> <span class="gallina-kwd">exists2</span> <span class="id">i,</span> <span class="id">i</span> <span class="id">\in</span> <span class="id">s</span> <span class="id">&amp;</span> <span class="id">0</span> <span class="id">&lt;</span> <span class="id">F</span> <span class="id">i</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</span></div>
<div class="proofscript" id="proof2">
<span class="id">elim:</span> <span class="id">s</span> <span class="id">=&gt;</span> <span class="id">[|h</span> <span class="id">t</span> <span class="id">ih];</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">big_nil</span> <span class="id">ltxx</span>.<br/>
<span class="id">rewrite</span> <span class="id">big_cons</span>.<br/>
<span class="id">have</span> <span class="id">H</span> <span class="id">:</span> <span class="gallina-kwd">forall</span> <span class="id">x</span> <span class="id">y</span> <span class="id">:</span> <span class="id">R,</span> <span class="id">0</span> <span class="id">&lt;</span> <span class="id">x</span> <span class="id">+</span> <span class="id">y</span> <span class="id">-&gt;</span> <span class="id">0</span> <span class="id">&lt;</span> <span class="id">x</span> <span class="id">\/</span> <span class="id">0</span> <span class="id">&lt;</span> <span class="id">y</span> <span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">x</span> <span class="id">y;</span> <span class="id">lra</span>.<br/>
<span class="id">move/RltP/H</span> <span class="id">=&gt;</span> <span class="id">[Fh0|];</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="gallina-kwd">exists</span> <span class="id">h</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">rewrite</span> <span class="id">mem_head</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">move/RltP/ih</span> <span class="id">=&gt;</span> <span class="id">[u</span> <span class="id">ut</span> <span class="id">Fu0];</span> <span class="gallina-kwd">exists</span> <span class="id">u</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">rewrite</span> <span class="id">inE</span> <span class="id">ut</span> <span class="id">orbT</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">move_to_mathcomp</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">move_to_infotheo</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">nneg_finfun</span>. <br/>
<span class="vernacular">Local</span> <span class="vernacular">Open</span> <span class="vernacular">Scope</span> <span class="id">R_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">nneg_finfun_ge0</span> (<span class="id">I</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">f</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">I</span>) <span class="id">i</span> <span class="id">:</span> (<span class="id">0</span> <span class="id">&lt;=</span> <span class="id">f</span> <span class="id">i</span>)<span class="id">%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</span></div>
<div class="proofscript" id="proof3">
 <span class="gallina-kwd">by</span> <span class="id">case:</span> <span class="id">f</span> <span class="id">=&gt;</span> <span class="id">/=</span> <span class="id">f</span> <span class="id">/forallP</span> <span class="id">/</span>(<span class="id">_</span> <span class="id">i</span>). Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">nneg_finfun_le0</span> (<span class="id">I</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">F</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">I</span>) <span class="id">i</span> <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="id">F</span> <span class="id">i</span> <span class="id">==</span> <span class="id">0</span>) <span class="id">=</span> (<span class="id">F</span> <span class="id">i</span> <span class="id">&lt;=</span> <span class="id">0</span>)<span class="id">%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
<span class="id">apply/idP/idP</span> <span class="id">=&gt;</span> <span class="id">[/eqP</span> <span class="id">-&gt;</span> <span class="id">//|]</span>.<br/>
<span class="id">case:</span> <span class="id">F</span> <span class="id">=&gt;</span> <span class="id">F</span> <span class="id">/=</span> <span class="id">/forallP</span> <span class="id">/</span>(<span class="id">_</span> <span class="id">i</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">eq_le</span> <span class="id">coqRE</span> <span class="id">=&gt;</span> <span class="id">-&gt;</span> <span class="id">-&gt;</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Fail</span> <span class="vernacular">Check</span> <span class="id">F</span> <span class="id">:</span> <span class="id">pos_fun</span> <span class="id">_</span>. <br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">pos_ffun_bigmaxR0P</span> (<span class="id">I</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">r</span> <span class="id">:</span> <span class="id">seq</span> <span class="id">I</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">pred</span> <span class="id">I</span>) (<span class="id">F</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">I</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">reflect</span> (<span class="gallina-kwd">forall</span> <span class="id">i</span> <span class="id">:</span> <span class="id">I,</span> <span class="id">i</span> <span class="id">\in</span> <span class="id">r</span> <span class="id">-&gt;</span> <span class="id">P</span> <span class="id">i</span> <span class="id">-&gt;</span> <span class="id">F</span> <span class="id">i</span> <span class="id">=</span> <span class="id">0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\rmax_</span>(<span class="id">i</span> <span class="id">&lt;-</span> <span class="id">r</span> <span class="id">|</span> <span class="id">P</span> <span class="id">i</span>) <span class="id">F</span> <span class="id">i</span> <span class="id">==</span> <span class="id">0</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
<span class="id">apply:</span> (<span class="id">iffP</span> <span class="id">idP</span>) <span class="id">=&gt;</span> <span class="id">[/eqP</span> <span class="id">H</span> <span class="id">i</span> <span class="id">ir</span> <span class="id">Pi|H]</span>.<br/>
<span class="id">-</span> <span class="id">apply/eqP;</span> <span class="id">rewrite</span> <span class="id">nneg_finfun_le0</span> <span class="id">-coqRE</span> <span class="id">-H</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-big_filter;</span> <span class="id">apply/RleP;</span> <span class="id">apply:</span> <span class="id">leR_bigmaxR</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">mem_filter</span> <span class="id">ir</span> <span class="id">Pi</span>.<br/>
<span class="id">-</span> <span class="id">rewrite</span> <span class="id">-big_filter</span> <span class="id">big_seq</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id">eq_bigr=&gt;</span> <span class="id">i</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">mem_filter=&gt;</span> <span class="id">/andP</span> <span class="id">[]</span> <span class="id">/[swap]</span> <span class="id">/</span>(<span class="id">H</span> <span class="id">i</span>) <span class="id">/[apply]</span> <span class="id">-&gt;</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-big_seq</span> <span class="id">big_const_seq</span> <span class="id">iter_fix</span> <span class="id">//</span> <span class="id">maxRR</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">nneg_finfun</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">pmax_eq0</span> <span class="id">[I</span> <span class="id">:</span> <span class="id">eqType]</span> (<span class="id">r</span> <span class="id">:</span> <span class="id">seq</span> <span class="id">I</span>) <span class="id">[P</span> <span class="id">:</span> <span class="id">pred</span> <span class="id">I]</span> <span class="id">[F</span> <span class="id">:</span> <span class="id">I</span> <span class="id">-&gt;</span> <span class="id">R]</span> <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span> <span class="id">i,</span> <span class="id">P</span> <span class="id">i</span> <span class="id">-&gt;</span> (<span class="id">0</span> <span class="id">&lt;=</span> <span class="id">F</span> <span class="id">i</span>)<span class="id">%mcR</span>) <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;((<span class="id">\rmax_</span>(<span class="id">i</span> <span class="id">&lt;-</span> <span class="id">r</span> <span class="id">|</span> <span class="id">P</span> <span class="id">i</span>) <span class="id">F</span> <span class="id">i</span>)<span class="id">%mcR</span> <span class="id">==</span> <span class="id">0%mcR</span>) <span class="id">=</span> <span class="id">all</span> (<span class="gallina-kwd">fun</span> <span class="id">i</span> <span class="id">=&gt;</span> <span class="id">P</span> <span class="id">i</span> <span class="id">==&gt;</span> (<span class="id">F</span> <span class="id">i</span> <span class="id">==</span> <span class="id">0%mcR</span>)) <span class="id">r</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</span></div>
<div class="proofscript" id="proof6">
<span class="id">elim:</span> <span class="id">r</span> <span class="id">=&gt;</span> <span class="id">/=</span> <span class="id">[|h</span> <span class="id">t</span> <span class="id">ih</span> <span class="id">PF0]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">big_nil</span> <span class="id">eqxx</span>.<br/>
<span class="id">rewrite</span> <span class="id">big_cons</span>.<br/>
<span class="id">case:</span> <span class="id">ifP</span> <span class="id">=&gt;</span> <span class="id">Ph</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">implyTb;</span> <span class="id">apply/idP/andP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span> <span class="id">[Fh|Fh]</span> <span class="id">:=</span> <span class="id">leP</span> (<span class="id">F</span> <span class="id">h</span>) (<span class="id">\rmax_</span>(<span class="id">j</span> <span class="id">&lt;-</span> <span class="id">t</span> <span class="id">|</span> <span class="id">P</span> <span class="id">j</span>) <span class="id">F</span> <span class="id">j</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Rmax_right//;</span> <span class="id">last</span> <span class="id">exact/RleP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span> <span class="id">tPF;</span> <span class="id">rewrite</span> <span class="id">-ih//;</span> <span class="id">split</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">eq_le</span> <span class="id">PF0//</span> <span class="id">andbT</span> <span class="id">-</span>(<span class="id">eqP</span> <span class="id">tPF</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Rmax_left//;</span> <span class="id">last</span> <span class="id">exact/ltRW/RltP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span> <span class="id">Fh0;</span> <span class="id">rewrite</span> <span class="id">Fh0;</span> <span class="id">split</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-ih//</span> <span class="id">eq_le;</span> <span class="id">apply/andP;</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-</span>(<span class="id">eqP</span> <span class="id">Fh0</span>)<span class="id">;</span> <span class="id">exact/RleP/ltRW/RltP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/RleP;</span> <span class="id">rewrite</span> <span class="id">-big_filter;</span> <span class="id">apply/bigmaxR_ge0</span> <span class="id">=&gt;</span> <span class="id">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">mem_filter</span> <span class="id">=&gt;</span> <span class="id">/andP[/PF0</span> <span class="id">/RleP]</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span> <span class="id">[/eqP</span> <span class="id">Fh0</span> <span class="id">/allP</span> <span class="id">tPF]</span>.<br/>
&nbsp;<span class="id">rewrite</span> <span class="id">Fh0;</span> <span class="id">apply/eqP/Rmax_left;</span> <span class="id">apply/leR_eqVlt;</span> <span class="id">left</span>.<br/>
&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply/eqP;</span> <span class="id">rewrite</span> <span class="id">ih//;</span> <span class="id">apply/allP</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">implyFb</span> <span class="id">/=</span> <span class="id">ih</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Section</span> <span class="id">bigmaxR</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">eqType</span>) (<span class="id">F</span> <span class="id">:</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">R</span>) (<span class="id">s</span> <span class="id">:</span> <span class="id">seq</span> <span class="id">A</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">leR_bigmaxR_P</span> (<span class="id">P</span> <span class="id">:</span> <span class="id">pred</span> <span class="id">A</span>) <span class="id">:</span> <span class="gallina-kwd">forall</span> <span class="id">m,</span> <span class="id">m</span> <span class="id">\in</span> <span class="id">s</span> <span class="id">-&gt;</span> <span class="id">P</span> <span class="id">m</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">F</span> <span class="id">m</span> <span class="id">&lt;=</span> <span class="id">\rmax_</span>(<span class="id">m</span> <span class="id">&lt;-</span> <span class="id">s</span> <span class="id">|</span> <span class="id">P</span> <span class="id">m</span>) (<span class="id">F</span> <span class="id">m</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
<span class="id">elim:</span> <span class="id">s</span> <span class="id">=&gt;</span> <span class="id">//</span> <span class="id">hd</span> <span class="id">tl</span> <span class="id">IH</span> <span class="id">m;</span> <span class="id">rewrite</span> <span class="id">in_cons;</span> <span class="id">case/orP</span>.<br/>
<span class="id">-</span> <span class="id">move/eqP</span> <span class="id">=&gt;</span> <span class="id">-&gt;</span> <span class="id">Pm;</span> <span class="id">rewrite</span> <span class="id">big_cons</span> <span class="id">Pm;</span> <span class="id">exact/leR_maxl</span>.<br/>
<span class="id">-</span> <span class="id">move/IH</span> <span class="id">=&gt;</span> <span class="id">H</span> <span class="id">Pm;</span> <span class="id">rewrite</span> <span class="id">big_cons;</span> <span class="id">case:</span> <span class="id">ifPn</span> <span class="id">=&gt;</span> <span class="id">Phd;</span> <span class="id">last</span> <span class="id">exact:</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/</span>(<span class="id">leR_trans</span> (<span class="id">H</span> <span class="id">Pm</span>))<span class="id">/leR_maxr</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">bigmaxR_gt0</span> (<span class="id">P</span> <span class="id">:</span> <span class="id">pred</span> <span class="id">A</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">exists</span> <span class="id">i,</span> <span class="id">[/\</span> <span class="id">i</span> <span class="id">\in</span> <span class="id">s,</span> <span class="id">P</span> <span class="id">i</span> <span class="id">&amp;</span> <span class="id">0</span> <span class="id">&lt;</span> <span class="id">F</span> <span class="id">i]</span>) <span class="id">-&gt;</span> <span class="id">0</span> <span class="id">&lt;</span> <span class="id">\rmax_</span>(<span class="id">m</span> <span class="id">&lt;-</span> <span class="id">s</span> <span class="id">|</span> <span class="id">P</span> <span class="id">m</span>) (<span class="id">F</span> <span class="id">m</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
<span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">[a</span> <span class="id">[?</span> <span class="id">?</span> <span class="id">Fa0]];</span> <span class="id">exact/</span>(<span class="id">Rlt_le_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Fa0</span>)<span class="id">/leR_bigmaxR_P</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">bigmaxR</span>.<br/>
<br/>
<span class="vernacular">End</span> <span class="id">move_to_infotheo</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">is_01</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">C</span> <span class="id">:</span> <span class="id">{ffun</span> <span class="id">U</span> <span class="id">-&gt;</span> <span class="id">R}</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span> <span class="id">i,</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">C</span> <span class="id">i</span> <span class="id">&lt;=</span> <span class="id">1</span>.<br/>
<br/>
<span class="vernacular">Module</span> <span class="id">Weighted</span>.<br/>
<span class="vernacular">Section</span> <span class="id">def</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">d0</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">A}</span>) (<span class="id">g</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">A</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">total</span> <span class="id">:=</span> <span class="id">\sum_</span>(<span class="id">a</span> <span class="gallina-kwd">in</span> <span class="id">A</span>) <span class="id">g</span> <span class="id">a</span> <span class="id">*</span> <span class="id">d0</span> <span class="id">a</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span> <span class="id">total_neq0</span> <span class="id">:</span> <span class="id">total</span> <span class="id">!=</span> <span class="id">0</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">f</span> <span class="id">:=</span> <span class="id">[ffun</span> <span class="id">a</span> <span class="id">=&gt;</span> <span class="id">g</span> <span class="id">a</span> <span class="id">*</span> <span class="id">d0</span> <span class="id">a</span> <span class="id">/</span> <span class="id">total]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">total_gt0</span> <span class="id">:</span> (<span class="id">0</span> <span class="id">&lt;</span> <span class="id">total</span>)<span class="id">%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</span></div>
<div class="proofscript" id="proof9">
<span class="id">rewrite</span> <span class="id">lt_neqAle</span> <span class="id">eq_sym</span> <span class="id">total_neq0/=</span> <span class="id">/total</span> <span class="id">sumr_ge0//</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply/mulr_ge0/FDist</span>.<span class="id">ge0;</span> <span class="id">case:</span> <span class="id">g</span> <span class="id">=&gt;</span> <span class="id">?</span> <span class="id">/=</span> <span class="id">/forallP</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Let</span> <span class="id">f0</span> <span class="id">a</span> <span class="id">:</span> (<span class="id">0</span> <span class="id">&lt;=</span> <span class="id">f</span> <span class="id">a</span>)<span class="id">%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</span></div>
<div class="proofscript" id="proof10">
<span class="id">rewrite</span> <span class="id">ffunE</span> <span class="id">/f</span> <span class="id">coqRE</span> <span class="id">divr_ge0//;</span> <span class="id">last</span> <span class="id">exact/ltW/total_gt0</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">coqRE</span> <span class="id">mulr_ge0</span> <span class="id">//;</span> <span class="id">case:</span> <span class="id">g</span> <span class="id">=&gt;</span> <span class="id">?</span> <span class="id">/=</span> <span class="id">/forallP;</span> <span class="id">exact</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Let</span> <span class="id">f1</span> <span class="id">:</span> <span class="id">\sum_</span>(<span class="id">a</span> <span class="gallina-kwd">in</span> <span class="id">A</span>) <span class="id">f</span> <span class="id">a</span> <span class="id">=</span> <span class="id">1</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</span></div>
<div class="proofscript" id="proof11">
<span class="id">rewrite</span> <span class="id">/f;</span> <span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">ffunE</span> <span class="id">divRE</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-big_distrl</span> <span class="id">/=</span> <span class="id">mulRV</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">d</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">A}</span> <span class="id">:=</span> <span class="id">locked</span> (<span class="id">FDist.make</span> <span class="id">f0</span> <span class="id">f1</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">dE</span> <span class="id">a</span> <span class="id">:</span> <span class="id">d</span> <span class="id">a</span> <span class="id">=</span> <span class="id">g</span> <span class="id">a</span> <span class="id">*</span> <span class="id">d0</span> <span class="id">a</span> <span class="id">/</span> <span class="id">total</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</span></div>
<div class="proofscript" id="proof12">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/d;</span> <span class="id">unlock;</span> <span class="id">rewrite</span> <span class="id">ffunE</span>. Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">def</span>.<br/>
<span class="vernacular">End</span> <span class="id">Weighted</span>.<br/>
<br/>
<span class="vernacular">Module</span> <span class="id">Split</span>.<br/>
<span class="vernacular">Section</span> <span class="id">def</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">d0</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">A}</span>) (<span class="id">h</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">A</span>).<br/>
<span class="vernacular">Hypothesis</span> <span class="id">weight_C</span> <span class="id">:</span> <span class="id">is_01</span> <span class="id">h</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">g</span> <span class="id">:=</span> <span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="gallina-kwd">if</span> <span class="id">x</span>.<span class="id">2</span> <span class="gallina-kwd">then</span> <span class="id">h</span> <span class="id">x</span>.<span class="id">1</span> <span class="gallina-kwd">else</span> <span class="id">1</span> <span class="id">-</span> <span class="id">h</span> <span class="id">x</span>.<span class="id">1</span>.<br/>
<span class="vernacular">Definition</span> <span class="id">f</span> <span class="id">:=</span> <span class="id">[ffun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">g</span> <span class="id">x</span> <span class="id">*</span> <span class="id">d0</span> <span class="id">x</span>.<span class="id">1]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">g_ge0</span> <span class="id">x</span> <span class="id">:</span> (<span class="id">0</span> <span class="id">&lt;=</span> <span class="id">g</span> <span class="id">x</span>)<span class="id">%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</span></div>
<div class="proofscript" id="proof13">
<span class="id">rewrite</span> <span class="id">/g;</span> <span class="id">case:</span> <span class="id">ifPn</span> <span class="id">=&gt;</span> <span class="id">_;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">case:</span> <span class="id">h</span> <span class="id">=&gt;</span> <span class="id">?</span> <span class="id">/=</span> <span class="id">/forallP</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">have</span> <span class="id">[_</span> <span class="id">?]</span> <span class="id">:=</span> <span class="id">weight_C</span> <span class="id">x</span>.<span class="id">1;</span> <span class="id">exact/RleP/subR_ge0</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Let</span> <span class="id">f0</span> <span class="id">a</span> <span class="id">:</span> (<span class="id">0</span> <span class="id">&lt;=</span> <span class="id">f</span> <span class="id">a</span>)<span class="id">%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</span></div>
<div class="proofscript" id="proof14">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">ffunE</span> <span class="id">/f</span> <span class="id">coqRE</span> <span class="id">mulr_ge0</span> <span class="id">//;</span> <span class="id">exact:</span> <span class="id">g_ge0</span>. Qed.</div>
<br/>
<span class="vernacular">Let</span> <span class="id">f1</span> <span class="id">:</span> <span class="id">\sum_a</span> <span class="id">f</span> <span class="id">a</span> <span class="id">=</span> <span class="id">1</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</span></div>
<div class="proofscript" id="proof15">
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">x</span> <span class="gallina-kwd">in</span> (<span class="id">[set:</span> <span class="id">A]</span> <span class="id">`*</span> <span class="id">setT</span>)<span class="id">%SET</span>) <span class="id">f</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">eq_bigl</span> <span class="id">=&gt;</span> <span class="id">/=</span> <span class="id">-[a</span> <span class="id">b];</span> <span class="id">rewrite</span> <span class="id">!inE</span>.<br/>
<span class="id">rewrite</span> <span class="id">big_setX/=</span> <span class="id">exchange_big//=</span> <span class="id">setT_bool</span>.<br/>
<span class="id">rewrite</span> <span class="id">big_setU1//=</span> <span class="id">?inE//</span> <span class="id">big_set1//=</span>.<br/>
<span class="id">rewrite</span> <span class="id">-big_split//=</span> <span class="id">-</span>(<span class="id">Pr_setT</span> <span class="id">d0</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">a</span> <span class="id">_;</span> <span class="id">rewrite</span> <span class="id">!ffunE</span> <span class="id">/g</span> <span class="id">/=;</span> <span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">d</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">_}</span> <span class="id">:=</span> <span class="id">locked</span> (<span class="id">FDist.make</span> <span class="id">f0</span> <span class="id">f1</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">fst_RV</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">d0</span> <span class="id">-&gt;</span> <span class="id">R}</span>) <span class="id">:</span> <span class="id">{RV</span> <span class="id">d</span> <span class="id">-&gt;</span> <span class="id">R}</span> <span class="id">:=</span> <span class="gallina-kwd">fun</span> <span class="id">x</span> <span class="id">=&gt;</span> <span class="id">X</span> <span class="id">x</span>.<span class="id">1</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">dE</span> <span class="id">a</span> <span class="id">:</span> <span class="id">d</span> <span class="id">a</span> <span class="id">=</span> (<span class="gallina-kwd">if</span> <span class="id">a</span>.<span class="id">2</span> <span class="gallina-kwd">then</span> <span class="id">h</span> <span class="id">a</span>.<span class="id">1</span> <span class="gallina-kwd">else</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">h</span> <span class="id">a</span>.<span class="id">1</span>)) <span class="id">*</span> <span class="id">d0</span> <span class="id">a</span>.<span class="id">1</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</span></div>
<div class="proofscript" id="proof16">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/d;</span> <span class="id">unlock;</span> <span class="id">rewrite</span> <span class="id">ffunE</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">Pr_setXT</span> <span class="id">good</span> <span class="id">:</span> <span class="id">Pr</span> <span class="id">d0</span> <span class="id">good</span> <span class="id">=</span> <span class="id">Pr</span> <span class="id">d</span> (<span class="id">good</span> <span class="id">`*</span> <span class="id">[set:</span> <span class="id">bool]</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</span></div>
<div class="proofscript" id="proof17">
<span class="id">rewrite</span> <span class="id">/Pr</span> <span class="id">big_setX/=;</span> <span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">u</span> <span class="id">ugood</span>.<br/>
<span class="id">rewrite</span> <span class="id">setT_bool</span> <span class="id">big_setU1//=</span> <span class="id">?inE//</span> <span class="id">big_set1</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">!dE/=</span> <span class="id">-mulRDl</span> <span class="id">addRCA</span> <span class="id">addR_opp</span> <span class="id">subRR</span> <span class="id">addR0</span> <span class="id">mul1R</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">cEx</span> (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">d0</span> <span class="id">-&gt;</span> <span class="id">R}</span>) <span class="id">good</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">`E_[X</span> <span class="id">|</span> <span class="id">good]</span> <span class="id">=</span> <span class="id">`E_[fst_RV</span> <span class="id">X</span> <span class="id">|</span> (<span class="id">good</span> <span class="id">`*</span> <span class="id">[set:</span> <span class="id">bool]</span>)<span class="id">]</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</span></div>
<div class="proofscript" id="proof18">
<span class="id">rewrite</span> <span class="id">!cExE</span> <span class="id">-Pr_setXT;</span> <span class="id">congr</span> (<span class="id">_</span> <span class="id">/</span> <span class="id">_</span>).<br/>
<span class="id">rewrite</span> <span class="id">big_setX//=;</span> <span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">u</span> <span class="id">ugood</span>.<br/>
<span class="id">rewrite</span> <span class="id">setT_bool</span> <span class="id">big_setU1//=</span> <span class="id">?inE//</span> <span class="id">big_set1</span>.<br/>
<span class="id">rewrite</span> <span class="id">!dE/=</span> <span class="id">/fst_RV/=</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-mulRDr</span> <span class="id">-mulRDl</span> <span class="id">addRCA</span> <span class="id">addR_opp</span> <span class="id">subRR</span> <span class="id">addR0</span> <span class="id">mul1R</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">def</span>.<br/>
<span class="vernacular">End</span> <span class="id">Split</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">nnegP</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">C</span> <span class="id">:</span> <span class="id">{ffun</span> <span class="id">U</span> <span class="id">-&gt;</span> <span class="id">R}</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span> <span class="id">u</span> <span class="id">:</span> <span class="id">U,</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">C</span> <span class="id">u</span>) <span class="id">-&gt;</span> <span class="id">[forall</span> <span class="id">a,</span> (<span class="id">0</span> <span class="id">&lt;=</span> <span class="id">C</span> <span class="id">a</span>)<span class="id">%mcR]</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</span></div>
<div class="proofscript" id="proof19">
 <span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">h;</span> <span class="id">apply/forallP</span> <span class="id">=&gt;</span> <span class="id">u;</span> <span class="id">apply/RleP</span>. Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">Cpos_fun</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">h</span> <span class="id">:</span> <span class="gallina-kwd">forall</span> <span class="id">u</span> <span class="id">:</span> <span class="id">U,</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">C</span> <span class="id">u</span>) <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">mkNNFinfun</span> (<span class="id">nnegP</span> <span class="id">h</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">mean</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">A</span> <span class="id">:</span> <span class="id">{set</span> <span class="id">U}</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">`E_[X</span> <span class="id">|</span> <span class="id">A]</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">var</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">A</span> <span class="id">:</span> <span class="id">{set</span> <span class="id">U}</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">`V_[X</span> <span class="id">|</span> <span class="id">A]</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">emean</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>)<br/>
&nbsp;&nbsp;(<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>) (<span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">emean</span> <span class="id">:=</span> <span class="gallina-kwd">let</span> <span class="id">WP</span> <span class="id">:=</span> <span class="id">Weighted.d</span> <span class="id">PC_neq0</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">let</span> <span class="id">WX</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">WP</span> <span class="id">-&gt;</span> <span class="id">R}</span> <span class="id">:=</span> <span class="id">X</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">`E</span> <span class="id">WX</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">emeanE</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">emean</span> <span class="id">=</span> (<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">X</span> <span class="id">i</span>) <span class="id">/</span> <span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</span></div>
<div class="proofscript" id="proof20">
<span class="id">rewrite</span> <span class="id">/emean</span> <span class="id">/Ex</span> <span class="id">/ambient_dist</span> <span class="id">divRE</span> <span class="id">big_distrl/=;</span> <span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">u</span> <span class="id">_</span>.<br/>
<span class="id">rewrite</span> <span class="id">-mulRA</span> <span class="id">mulRCA;</span> <span class="id">congr</span> (<span class="id">_</span> <span class="id">*</span> <span class="id">_</span>).<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">Weighted.dE</span> (<span class="id">mulRC</span> <span class="id">_</span> (<span class="id">P</span> <span class="id">u</span>)) <span class="id">-divRE;</span> <span class="id">congr</span> (<span class="id">_</span> <span class="id">/</span> <span class="id">_</span>).<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">emean0</span> <span class="id">:</span> (<span class="gallina-kwd">forall</span> <span class="id">u,</span> <span class="id">X</span> <span class="id">u</span> <span class="id">=</span> <span class="id">0</span>) <span class="id">-&gt;</span> <span class="id">emean</span> <span class="id">=</span> <span class="id">0</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</span></div>
<div class="proofscript" id="proof21">
<span class="id">move=&gt;</span> <span class="id">X0</span>.<br/>
<span class="id">rewrite</span> <span class="id">emeanE</span>.<br/>
<span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">X0</span> <span class="id">mulR0</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">big1</span> <span class="id">//</span> <span class="id">divRE</span> <span class="id">mul0R</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">emean</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">sq_dev</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>) (<span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">sq_dev</span> <span class="id">:=</span> <span class="gallina-kwd">let</span> <span class="id">mu_hat</span> <span class="id">:=</span> <span class="id">emean</span> <span class="id">X</span> <span class="id">PC_neq0</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span> <span class="id">`-cst</span> <span class="id">mu_hat</span>)<span class="id">`^2</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">sq_devE</span> <span class="id">:</span> <span class="id">sq_dev</span> <span class="id">=</span> (<span class="id">X</span> <span class="id">`-cst</span> (<span class="id">emean</span> <span class="id">X</span> <span class="id">PC_neq0</span>))<span class="id">`^2</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</span></div>
<div class="proofscript" id="proof22">
 <span class="gallina-kwd">by</span> <span class="id">[]</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">sq_dev_ge0</span> <span class="id">u</span> <span class="id">:</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">sq_dev</span> <span class="id">u</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</span></div>
<div class="proofscript" id="proof23">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/sq_dev</span> <span class="id">sq_RV_pow2;</span> <span class="id">exact:</span> <span class="id">pow2_ge_0</span>. Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">sq_dev_max</span> <span class="id">:=</span> <span class="id">\rmax_</span>(<span class="id">i</span> <span class="id">|</span> <span class="id">C</span> <span class="id">i</span> <span class="id">!=</span> <span class="id">0</span>) <span class="id">sq_dev</span> <span class="id">i</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">Weighted_support_nonempty</span> <span class="id">:</span> <span class="id">{i</span> <span class="id">|</span> <span class="id">C</span> <span class="id">i</span> <span class="id">!=</span> <span class="id">0}</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</span></div>
<div class="proofscript" id="proof24">
<span class="id">move:</span> <span class="id">PC_neq0;</span> <span class="id">rewrite</span> <span class="id">psumr_neq0;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">*;</span> <span class="id">apply:</span> <span class="id">mulr_ge0</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">exact:</span> <span class="id">nneg_finfun_ge0</span>.<br/>
<span class="id">case/hasP/sig2W=&gt;</span> <span class="id">/=</span> <span class="id">x</span> <span class="id">?</span>.<br/>
<span class="id">move/RltP/pmulR_lgt0'</span>.<br/>
<span class="id">have:=</span> <span class="id">fdist_ge0_le1</span> <span class="id">P</span> <span class="id">x</span>.<br/>
<span class="id">case/andP=&gt;</span> <span class="id">/[swap]</span> <span class="id">_</span> <span class="id">/RleP</span> <span class="id">/[swap]</span> <span class="id">/[apply]</span>.<br/>
<span class="id">move/ltR_eqF;</span> <span class="id">rewrite</span> <span class="id">eq_sym</span> <span class="id">=&gt;</span> <span class="id">?</span>.<br/>
<span class="gallina-kwd">by</span> <span class="gallina-kwd">exists</span> <span class="id">x</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Local</span> <span class="vernacular">Notation</span> <span class="id">j</span> <span class="id">:=</span> (<span class="id">sval</span> <span class="id">Weighted_support_nonempty</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">sq_dev_arg_max</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">[arg</span> <span class="id">max_</span>(<span class="id">i</span> <span class="id">&gt;</span> <span class="id">j</span> <span class="id">|</span> <span class="id">C</span> <span class="id">i</span> <span class="id">!=</span> <span class="id">0</span>) <span class="id">sq_dev</span> <span class="id">i]%O</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">sq_dev_max_eq_arg</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">sq_dev_max</span> <span class="id">=</span> <span class="id">sq_dev</span> (<span class="id">sq_dev_arg_max</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</span></div>
<div class="proofscript" id="proof25">
<span class="id">rewrite</span> <span class="id">/sq_dev_max</span> <span class="id">bigmaxRE</span>.<br/>
<span class="id">apply:</span> <span class="id">bigmax_eq_arg;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">case:</span> <span class="id">Weighted_support_nonempty</span>.<br/>
<span class="id">move=&gt;</span> <span class="id">*;</span> <span class="id">exact/RleP/sq_dev_ge0</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">sq_dev_max_ge0</span> <span class="id">:</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">sq_dev_max</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</span></div>
<div class="proofscript" id="proof26">
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/sq_dev_max</span> <span class="id">-big_filter;</span> <span class="id">apply</span> <span class="id">bigmaxR_ge0=&gt;</span> <span class="id">*;</span> <span class="id">exact:</span> <span class="id">sq_dev_ge0</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">sq_dev_max_ge</span> <span class="id">u</span> <span class="id">:</span> <span class="id">C</span> <span class="id">u</span> <span class="id">!=</span> <span class="id">0</span> <span class="id">-&gt;</span> <span class="id">sq_dev</span> <span class="id">u</span> <span class="id">&lt;=</span> <span class="id">sq_dev_max</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</span></div>
<div class="proofscript" id="proof27">
<span class="id">move=&gt;</span> <span class="id">Cu0</span>.<br/>
<span class="id">rewrite</span> <span class="id">/sq_dev_max</span> <span class="id">-big_filter;</span> <span class="id">apply:</span> <span class="id">leR_bigmaxR</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">mem_filter</span> <span class="id">Cu0</span> <span class="id">mem_index_enum</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">sq_dev</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">evar</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>)<br/>
&nbsp;&nbsp;(<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>) (<span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">evar</span> <span class="id">:=</span> <span class="gallina-kwd">let</span> <span class="id">WP</span> <span class="id">:=</span> <span class="id">Weighted.d</span> <span class="id">PC_neq0</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">let</span> <span class="id">WX</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">WP</span> <span class="id">-&gt;</span> <span class="id">R}</span> <span class="id">:=</span> <span class="id">X</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">`V</span> <span class="id">WX</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">evarE</span> <span class="id">:</span> <span class="id">evar</span> <span class="id">=</span> <span class="id">emean</span> (<span class="id">sq_dev</span> <span class="id">X</span> <span class="id">PC_neq0</span>) <span class="id">PC_neq0</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</span></div>
<div class="proofscript" id="proof28">
 <span class="gallina-kwd">by</span> <span class="id">[]</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">evar0P</span> <span class="id">:</span> <span class="id">reflect</span> (<span class="gallina-kwd">forall</span> <span class="id">i,</span> <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">sq_dev</span> <span class="id">X</span> <span class="id">PC_neq0</span> <span class="id">i</span> <span class="id">=</span> <span class="id">0</span>) (<span class="id">evar</span> <span class="id">==</span> <span class="id">0</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</span></div>
<div class="proofscript" id="proof29">
<span class="id">rewrite</span> <span class="id">evarE</span> <span class="id">emeanE</span>.<br/>
<span class="id">apply:</span> (<span class="id">iffP</span> <span class="id">idP</span>)<span class="id">;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span> <span class="id">H;</span> <span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">big1</span> <span class="id">//</span> <span class="id">div0R</span>.<br/>
<span class="id">rewrite</span> <span class="id">mulR_eq0'</span> <span class="id">=&gt;</span> <span class="id">/orP</span> <span class="id">[];</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">move/invR_eq0';</span> <span class="id">have:=</span> <span class="id">PC_neq0;</span> <span class="id">rewrite</span> <span class="id">/Weighted</span>.<span class="id">total</span> <span class="id">=&gt;</span> <span class="id">/negPf</span> <span class="id">-&gt;</span>.<br/>
<span class="id">move/[swap]</span> <span class="id">=&gt;</span> <span class="id">i</span>.<br/>
<span class="id">rewrite</span> <span class="id">psumr_eq0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">move/allP/</span>(<span class="id">_</span> <span class="id">i</span>)<span class="id">/[!mem_index_enum]/</span>(<span class="id">_</span> <span class="id">erefl</span>)<span class="id">/implyP/[!inE]/</span>(<span class="id">_</span> <span class="id">erefl</span>)<span class="id">/eqP-&gt;</span>.<br/>
<span class="id">move=&gt;</span> <span class="id">x</span> <span class="id">_;</span> <span class="id">apply/RleP/mulR_ge0;</span> <span class="id">last</span> <span class="id">exact:</span> <span class="id">sq_dev_ge0</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply/mulR_ge0=&gt;</span> <span class="id">//;</span> <span class="id">exact/RleP/nneg_finfun_ge0</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">evar_ge0</span> <span class="id">:</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">evar</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</span></div>
<div class="proofscript" id="proof30">
<span class="id">rewrite</span> <span class="id">evarE</span> <span class="id">emeanE;</span> <span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/invR_ge0/RltP/Weighted</span>.<span class="id">total_gt0</span>.<br/>
<span class="id">have-&gt;:</span> <span class="id">0</span> <span class="id">=</span> <span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id">0</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">big1</span>.<br/>
<span class="id">apply:</span> <span class="id">leR_sumR=&gt;</span> <span class="id">i</span> <span class="id">iU</span>.<br/>
<span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">last</span> <span class="id">exact:</span> <span class="id">sq_dev_ge0</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">mulR_ge0</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">exact/RleP/nneg_finfun_ge0</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">evar</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">pos_evar</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>)<br/>
&nbsp;&nbsp;(<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>) (<span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>)<br/>
&nbsp;&nbsp;(<span class="id">evar_gt0</span> <span class="id">:</span> <span class="id">0</span> <span class="id">&lt;</span> <span class="id">evar</span> <span class="id">X</span> <span class="id">PC_neq0</span>).<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">pos_evar_index</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> <span class="id">i,</span> <span class="id">0</span> <span class="id">&lt;</span> <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">sq_dev</span> <span class="id">X</span> <span class="id">PC_neq0</span> <span class="id">i</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof31')">Proof.</span></div>
<div class="proofscript" id="proof31">
<span class="id">move:</span> <span class="id">evar_gt0;</span> <span class="id">rewrite</span> <span class="id">ltR_neqAle</span> <span class="id">=&gt;</span> <span class="id">-[]</span> <span class="id">/nesym</span> <span class="id">/eqP</span> <span class="id">/[swap]</span> <span class="id">_</span>.<br/>
<span class="id">case/evar0P/boolp</span>.<span class="id">existsNP=&gt;</span> <span class="id">x</span> <span class="id">/eqP</span> <span class="id">?;</span> <span class="gallina-kwd">exists</span> <span class="id">x</span>.<br/>
<span class="id">rewrite</span> <span class="id">ltR_neqAle;</span> <span class="id">split;</span> <span class="id">first</span> <span class="id">exact/nesym/eqP</span>.<br/>
<span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">last</span> <span class="id">exact/sq_dev_ge0</span>.<br/>
<span class="id">apply:</span> <span class="id">mulR_ge0=&gt;</span> <span class="id">//;</span> <span class="id">exact/RleP/nneg_finfun_ge0</span>.<br/>
Qed.</div>
<span class="vernacular">End</span> <span class="id">pos_evar</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">emean_cond</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>) (<span class="id">A</span> <span class="id">:</span> <span class="id">{set</span> <span class="id">U}</span>) (<span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span> <span class="id">WP</span> <span class="id">:=</span> <span class="id">Weighted.d</span> <span class="id">PC_neq0</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span> <span class="id">WX</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">WP</span> <span class="id">-&gt;</span> <span class="id">R}</span> <span class="id">:=</span> <span class="id">X</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">`E_[WX</span> <span class="id">|</span> <span class="id">A]</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">evar_cond</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>) (<span class="id">A</span> <span class="id">:</span> <span class="id">{set</span> <span class="id">U}</span>) (<span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span> <span class="id">WP</span> <span class="id">:=</span> <span class="id">Weighted.d</span> <span class="id">PC_neq0</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span> <span class="id">WX</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">WP</span> <span class="id">-&gt;</span> <span class="id">R}</span> <span class="id">:=</span> <span class="id">X</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">`V_[WX</span> <span class="id">|</span> <span class="id">A]</span>.<br/>
<br/>
<div class="doc md"> ## eqn I, page 5 </div>
<span class="vernacular">Definition</span> <span class="id">filter1D_inv</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">good</span> <span class="id">:</span> <span class="id">{set</span> <span class="id">U}</span>) (<span class="id">eps</span> <span class="id">:</span> <span class="id">R</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">good</span>) (<span class="id">1</span> <span class="id">-</span> <span class="id">C</span> <span class="id">i</span>) <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">&lt;=</span><br/>
&nbsp;&nbsp;(<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>) <span class="id">/</span> <span class="id">2</span> <span class="id">*</span> <span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">~:</span> <span class="id">good</span>) (<span class="id">1</span> <span class="id">-</span> <span class="id">C</span> <span class="id">i</span>) <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>.<br/>
<br/>
<div class="doc md"> ## page 62, line -1 </div>
<span class="vernacular">Definition</span> <span class="id">filter1D_invW</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">good</span> <span class="id">:</span> <span class="id">{set</span> <span class="id">U}</span>) (<span class="id">eps</span> <span class="id">:</span> <span class="id">R</span>) (<span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>) <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span> <span class="id">WP</span> <span class="id">:=</span> <span class="id">Weighted.d</span> <span class="id">PC_neq0</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span> <span class="id">&lt;=</span> <span class="id">Pr</span> <span class="id">WP</span> <span class="id">good</span>.<br/>
<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">bounding_empirical_mean</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>) (<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>)<br/>
&nbsp;&nbsp;(<span class="id">good</span> <span class="id">:</span> <span class="id">{set</span> <span class="id">U}</span>) (<span class="id">eps</span> <span class="id">:</span> <span class="id">R</span>).<br/>
<span class="vernacular">Hypotheses</span> (<span class="id">C01</span> <span class="id">:</span> <span class="id">is_01</span> <span class="id">C</span>) (<span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>).<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">WP</span> <span class="id">:=</span> <span class="id">Weighted.d</span> <span class="id">PC_neq0</span>.<br/>
<span class="vernacular">Let</span> <span class="id">SP</span> <span class="id">:=</span> <span class="id">Split.d</span> <span class="id">P</span> <span class="id">C01</span>.<br/>
<span class="vernacular">Let</span> <span class="id">bad</span> <span class="id">:=</span> <span class="id">~:</span> <span class="id">good</span>.<br/>
<span class="vernacular">Let</span> <span class="id">eps_max</span> <span class="id">:=</span> <span class="id">1/16</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span> <span class="id">pr_bad</span> <span class="id">:</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">bad</span> <span class="id">=</span> <span class="id">eps</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">pr_good</span> <span class="id">:</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span> <span class="id">=</span> <span class="id">1</span> <span class="id">-</span> <span class="id">eps</span><br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof32')">Proof.</span></div>
<div class="proofscript" id="proof32">
 <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">Pr_to_cplt</span> <span class="id">pr_bad</span>. Qed.</div>
<br/>
<span class="vernacular">Hypothesis</span> <span class="id">low_eps</span> <span class="id">:</span> <span class="id">eps</span> <span class="id">&lt;=</span> <span class="id">eps_max</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">eps0</span> <span class="id">:</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">eps</span><br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof33')">Proof.</span></div>
<div class="proofscript" id="proof33">
 <span class="id">rewrite</span> <span class="id">-pr_bad</span>. <span class="id">exact:</span> <span class="id">Pr_ge0</span>. Qed.</div>
<br/>
<span class="vernacular">Let</span> <span class="id">WX</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">WP</span> <span class="id">-&gt;</span> <span class="id">R}</span> <span class="id">:=</span> <span class="id">X</span>.<br/>
<span class="vernacular">Let</span> <span class="id">SX</span> <span class="id">:=</span> <span class="id">Split.fst_RV</span> <span class="id">C01</span> <span class="id">X</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">mu</span> <span class="id">:=</span> <span class="id">mean</span> <span class="id">X</span> <span class="id">good</span>.<br/>
<span class="vernacular">Let</span> <span class="id">var</span> <span class="id">:=</span> <span class="id">var</span> <span class="id">X</span> <span class="id">good</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">mu_hat</span> <span class="id">:=</span> <span class="id">emean</span> <span class="id">X</span> <span class="id">PC_neq0</span>.<br/>
<span class="vernacular">Let</span> <span class="id">var_hat</span> <span class="id">:=</span> <span class="id">evar</span> <span class="id">X</span> <span class="id">PC_neq0</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">mu_wave</span> <span class="id">:=</span> <span class="id">emean_cond</span> <span class="id">X</span> <span class="id">good</span> <span class="id">PC_neq0</span>.<br/>
<span class="vernacular">Let</span> <span class="id">evar_wave</span> <span class="id">:=</span> <span class="id">evar_cond</span> <span class="id">X</span> <span class="id">good</span> <span class="id">PC_neq0</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">tau</span> <span class="id">:=</span> <span class="id">sq_dev</span> <span class="id">X</span> <span class="id">PC_neq0</span>.<br/>
<span class="vernacular">Let</span> <span class="id">tau_max</span> <span class="id">:=</span> <span class="id">sq_dev_max</span> <span class="id">X</span> <span class="id">PC_neq0</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">pr_good_gt0</span> <span class="id">:</span> <span class="id">0</span> <span class="id">&lt;</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof34')">Proof.</span></div>
<div class="proofscript" id="proof34">
<span class="id">unfold</span> <span class="id">eps_max</span> <span class="gallina-kwd">in</span> <span class="id">low_eps</span>.<br/>
<span class="id">have</span> <span class="id">:</span> <span class="id">1</span> <span class="id">-</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span> <span class="id">&lt;</span> <span class="id">1;</span> <span class="id">last</span> <span class="id">lra</span>.<br/>
<span class="id">rewrite</span> <span class="id">-Pr_of_cplt</span> <span class="id">pr_bad;</span> <span class="id">lra</span>.<br/>
Qed.</div>
<span class="vernacular">Let</span> <span class="id">hprgoodgt0</span> <span class="id">:=</span> <span class="id">pr_good_gt0</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">weighted_total_gt0</span> <span class="id">:</span> <span class="id">0</span> <span class="id">&lt;</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof35')">Proof.</span></div>
<div class="proofscript" id="proof35">
 <span class="gallina-kwd">by</span> <span class="id">apply/RltP;</span> <span class="id">apply</span> <span class="id">Weighted.total_gt0</span>. Qed.</div>
<span class="vernacular">Let</span> <span class="id">hweightedtotalgt0</span> <span class="id">:=</span> <span class="id">weighted_total_gt0</span>.<br/>
<br/>
<div class="doc md"> ## eqn 1.1, page 5 </div>
<span class="vernacular">Lemma</span> <span class="id">eqn1_1</span> <span class="id">:</span><br/>
&nbsp;(<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">good</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span>) <span class="id">/</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span> <span class="id">&lt;=</span> <span class="id">var</span> <span class="id">+</span> (<span class="id">mu</span> <span class="id">-</span> <span class="id">mu_hat</span>)².<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof36')">Proof.</span></div>
<div class="proofscript" id="proof36">
<span class="id">apply</span> (<span class="id">@leR_trans</span> (<span class="id">`E_[tau</span> <span class="id">|</span> <span class="id">good]</span>))<span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">apply/leR_eqVlt;left;apply/cVarDist</span>.<br/>
<span class="id">rewrite</span> <span class="id">cExE</span>.<br/>
<span class="id">apply</span> <span class="id">leR_pmul2r;</span> <span class="id">[by</span> <span class="id">apply</span> <span class="id">invR_gt0|]</span>.<br/>
<span class="id">apply</span> <span class="id">leR_sumRl</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">Higood;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">[]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">mulRC</span> (<span class="id">tau</span> <span class="id">i</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_wpmul2r;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">sq_dev_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">[_</span> <span class="id">c1]</span> <span class="id">:=</span> <span class="id">C01</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">/RleP</span> <span class="id">hp</span> <span class="id">:=</span> <span class="id">FDist.ge0</span> <span class="id">P</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-{2}</span>(<span class="id">mul1R</span> (<span class="id">P</span> <span class="id">i</span>))<span class="id">;</span> <span class="id">apply</span> <span class="id">leR_wpmul2r</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">mulR_ge0</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">apply</span> <span class="id">sq_dev_ge0</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Let</span> <span class="id">invariant</span> <span class="id">:=</span> <span class="id">filter1D_inv</span> <span class="id">P</span> <span class="id">C</span> <span class="id">good</span> <span class="id">eps</span>.<br/>
<span class="vernacular">Let</span> <span class="id">invariantW</span> <span class="id">:=</span> <span class="id">filter1D_invW</span> <span class="id">good</span> <span class="id">eps</span> <span class="id">PC_neq0</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">lemma1_4_start</span> <span class="id">:</span> <span class="id">invariant</span> <span class="id">-&gt;</span> <span class="id">invariantW</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof37')">Proof.</span></div>
<div class="proofscript" id="proof37">
<span class="id">rewrite</span> <span class="id">/invariant</span> <span class="id">/invariantW</span> <span class="id">/filter1D_invW</span> <span class="id">=&gt;</span> <span class="id">hinv</span>.<br/>
<span class="id">rewrite</span> <span class="id">-!pr_good</span>.<br/>
<span class="id">apply</span> (<span class="id">@leR_trans</span> ((<span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span> <span class="id">/</span> <span class="id">2</span> <span class="id">*</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">1</span> <span class="id">+</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span> <span class="id">+</span> (<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">bad</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>))) <span class="id">/</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply</span> (<span class="id">@leR_pmul2r</span> ((<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>) <span class="id">*</span> <span class="id">2</span>))<span class="id">;</span> <span class="id">first</span> <span class="id">exact:</span> <span class="id">mulR_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">!mulRA</span> <span class="id">!</span>(<span class="id">mulRC</span> <span class="id">_</span> <span class="id">2</span>) <span class="id">-</span>(<span class="id">mulRA</span> <span class="id">_</span> (<span class="id">/</span> <span class="id">_</span>)) <span class="id">mulVR;</span> <span class="id">last</span> <span class="id">exact:</span> <span class="id">gtR_eqF</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">mulR1</span> <span class="id">!mulRA</span> (<span class="id">mulRC</span> <span class="id">_</span> (<span class="id">/2</span>)) <span class="id">mulRA</span> <span class="id">mulVR;</span> <span class="id">last</span> <span class="id">exact:</span> <span class="id">gtR_eqF</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">mul1R</span> <span class="id">-addRR</span> <span class="id">mulRDl</span> <span class="id">-addRA</span> <span class="id">mulRDr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">leR_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_pmul2l;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">move:</span> <span class="id">low_eps;</span> <span class="id">rewrite</span> <span class="id">pr_good</span> <span class="id">/eps_max;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">Pr_setT</span> <span class="id">P</span>) <span class="id">/Pr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_sumRl</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_</span> <span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">//-{2}</span>(<span class="id">mul1R</span> (<span class="id">P</span> <span class="id">i</span>))<span class="id">;</span> <span class="id">apply</span> <span class="id">leR_wpmul2r;</span> <span class="id">[|apply</span> <span class="id">C01]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_pmul2l;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">move:</span> <span class="id">low_eps;</span> <span class="id">rewrite</span> <span class="id">/eps_max</span> <span class="id">pr_good;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/Pr</span> <span class="id">addRC</span> <span class="id">-bigID2</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_sumR</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">HiU</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span> <span class="id">ifPn</span> <span class="id">=&gt;</span> <span class="id">igood;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">Rle_refl</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-{2}</span>(<span class="id">mul1R</span> (<span class="id">P</span> <span class="id">i</span>))<span class="id">;</span> <span class="id">apply</span> <span class="id">leR_pmul</span> <span class="id">=&gt;</span> <span class="id">//;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[apply</span> <span class="id">C01|apply</span> <span class="id">C01|exact:</span> <span class="id">Rle_refl]</span>.<br/>
<span class="id">under</span> <span class="id">[X</span> <span class="gallina-kwd">in</span> <span class="id">_</span> <span class="id">&lt;=</span> <span class="id">X]eq_bigr</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">Weighted.dE</span> <span class="id">/Weighted</span>.<span class="id">total</span>.<br/>
<span class="id">rewrite</span> <span class="id">-big_distrl/=</span> <span class="id">divRE</span>.<br/>
<span class="id">apply</span> <span class="id">leR_pmul2r;</span> <span class="id">first</span> <span class="id">exact:</span> <span class="id">invR_gt0</span>.<br/>
<span class="id">apply</span> <span class="id">Ropp_le_cancel</span>.<br/>
<span class="id">rewrite</span> <span class="id">{2}pr_good</span> <span class="id">addRA</span> <span class="id">-addRA</span> <span class="id">-pr_bad</span> <span class="id">mulRDr</span> <span class="id">oppRD</span> <span class="id">addRC</span>.<br/>
<span class="id">apply</span> <span class="id">leR_subl_addr</span>.<br/>
<span class="id">rewrite</span> <span class="id">/Rminus</span> <span class="id">oppRK</span> <span class="id">-mulRN</span> <span class="id">addRC</span> <span class="id">{1}/Rdiv</span> <span class="id">-mulRA</span> <span class="id">mulVR;</span> <span class="id">last</span> <span class="id">exact:</span> <span class="id">gtR_eqF</span>.<br/>
<span class="id">rewrite</span> <span class="id">mulR1</span> <span class="id">oppRD</span> <span class="id">oppRK</span> <span class="id">!big_morph_oppR-!big_split/=</span>.<br/>
<span class="id">have</span> <span class="id">H</span> <span class="id">:</span> <span class="gallina-kwd">forall</span> <span class="id">S,</span> <span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">S</span>) (<span class="id">P</span> <span class="id">i</span> <span class="id">+</span> <span class="id">-</span> (<span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>)) <span class="id">=</span> <span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">S</span>) (<span class="id">1</span> <span class="id">-</span> <span class="id">C</span> <span class="id">i</span>) <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">move</span> <span class="id">=&gt;</span> <span class="id">p</span> <span class="id">S;</span> <span class="id">apply</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_;</span> <span class="id">rewrite</span> <span class="id">mulRBl</span> <span class="id">mul1R</span> <span class="id">addR_opp</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">!H</span> <span class="id">pr_good</span>.<br/>
Qed.</div>
<br/>
<div class="doc md"> ## eqn page 63, line 3 </div>
<span class="vernacular">Lemma</span> <span class="id">bound_emean</span> <span class="id">:</span> <span class="id">Pr</span> <span class="id">WP</span> <span class="id">good</span> <span class="id">!=</span> <span class="id">0</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">invariantW</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">mu_hat</span> <span class="id">-</span> <span class="id">mu_wave</span>)² <span class="id">&lt;=</span> <span class="id">var_hat</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span> <span class="id">/</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof38')">Proof.</span></div>
<div class="proofscript" id="proof38">
<span class="id">move=&gt;</span> <span class="id">pgoodC</span> <span class="id">invC</span>.<br/>
<span class="id">unfold</span> <span class="id">eps_max</span> <span class="gallina-kwd">in</span> <span class="id">low_eps</span>.<br/>
<span class="id">suff</span> <span class="id">h</span> <span class="id">:</span> <span class="id">`|</span> <span class="id">mu_hat</span> <span class="id">-</span> <span class="id">mu_wave</span> <span class="id">|</span> <span class="id">&lt;=</span> <span class="id">sqrt</span> (<span class="id">var_hat</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span> <span class="id">/</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Rsqr_abs</span> <span class="id">-[X</span> <span class="gallina-kwd">in</span> <span class="id">_</span> <span class="id">&lt;=</span> <span class="id">X]Rsqr_sqrt;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">apply/invR_ge0/subR_gt0;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-mulRA;</span> <span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">[exact:</span> <span class="id">variance_ge0|lra]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply/Rsqr_incr_1</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">[exact/normR_ge0|exact:</span> <span class="id">sqrt_pos]</span>.<br/>
<span class="id">pose</span> <span class="id">delta</span> <span class="id">:=</span> <span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>.<br/>
<span class="id">have</span> <span class="id">{1}-&gt;</span> <span class="id">:</span> <span class="id">eps</span> <span class="id">=</span> <span class="id">1</span> <span class="id">-</span> <span class="id">delta</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">subRB</span> <span class="id">subRR</span> <span class="id">add0R</span>.<br/>
<span class="id">rewrite</span> <span class="id">-/delta</span> <span class="id">distRC</span>.<br/>
<span class="id">rewrite</span> <span class="id">/mu_hat</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">resilience</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">rewrite</span> <span class="id">/delta;</span> <span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<div class="doc md"> ## eqn page 63, line 5 </div>
<span class="vernacular">Lemma</span> <span class="id">good_mass</span> <span class="id">:</span> <span class="id">invariant</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">1</span> <span class="id">-</span> <span class="id">eps/2</span> <span class="id">&lt;=</span> (<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">good</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>) <span class="id">/</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof39')">Proof.</span></div>
<div class="proofscript" id="proof39">
<span class="id">rewrite</span> <span class="id">/eps_max/is_01</span> <span class="id">=&gt;</span> <span class="id">Hinv</span>.<br/>
<span class="id">unfold</span> <span class="id">eps_max</span> <span class="gallina-kwd">in</span> <span class="id">low_eps</span>.<br/>
<span class="id">apply</span> (<span class="id">@leR_trans</span> (<span class="id">1</span> <span class="id">-</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>) <span class="id">/</span> <span class="id">2</span> <span class="id">/</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span> <span class="id">*</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">bad</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">pr_bad</span> <span class="id">pr_good</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-!mulRA</span> <span class="id">mulRC</span> (<span class="id">mulRC</span> (<span class="id">/</span>(<span class="id">_-_</span>))) <span class="id">mulRA</span> <span class="id">-mulRA</span> <span class="id">mulVR</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">mulR1</span> <span class="id">mulRC;</span> <span class="id">right</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">/gtR_eqF;</span> <span class="id">lra</span>.<br/>
<span class="id">apply</span> (<span class="id">@leR_trans</span> (<span class="id">1</span> <span class="id">-</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>) <span class="id">/</span> <span class="id">2</span> <span class="id">/</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span> <span class="id">*</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">bad</span>) <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">C</span> <span class="id">i</span>))).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">leR_add2l</span> <span class="id">leR_oppl</span> <span class="id">oppRK</span> <span class="id">leR_pmul2l;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">pr_good</span> <span class="id">/Rdiv</span> <span class="id">mulRC</span> <span class="id">mulRA</span> <span class="id">mulVR;</span> <span class="id">[lra|rewrite</span> <span class="id">gt_eqF//;</span> <span class="id">apply/RltP;</span> <span class="id">lra]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_sumR</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">Hi_bad</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-{2}</span>(<span class="id">mulR1</span> (<span class="id">P</span> <span class="id">i</span>)).<br/>
&nbsp;&nbsp;<span class="id">move:</span> (<span class="id">FDist.ge0</span> <span class="id">P</span> <span class="id">i</span>)<span class="id">;</span> <span class="id">move/RleP</span> <span class="id">=&gt;</span> <span class="id">[HPi_gt0|HPi_eq0]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply/RleP;</span> <span class="id">rewrite</span> <span class="id">!coqRE</span> <span class="id">ler_wpM2l//</span> <span class="id">gerBl//;</span> <span class="id">move:</span> (<span class="id">C01</span> <span class="id">i</span>).<span class="id">1</span> <span class="id">=&gt;</span> <span class="id">/RleP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-HPi_eq0</span> <span class="id">!mul0R</span>.<br/>
<span class="id">rewrite</span> <span class="id">-pr_good</span> <span class="id">/Rdiv</span> <span class="id">-</span>(<span class="id">mulRA</span> (<span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span>)) (<span class="id">mulRC</span> (<span class="id">/2</span>)) <span class="id">mulRA</span> <span class="id">mulRV;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">gtR_eqF;</span> <span class="id">rewrite</span> <span class="id">pr_good;</span> <span class="id">lra</span>.<br/>
<span class="id">apply</span> (<span class="id">@leR_pmul2r</span> (<span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span>))<span class="id">;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">pr_good;</span> <span class="id">lra</span>.<br/>
<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">mulRA</span> <span class="id">_</span> (<span class="id">/</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span>)) <span class="id">mulVR;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">gtR_eqF//</span> <span class="id">pr_good;</span> <span class="id">lra</span>.<br/>
<span class="id">rewrite</span> <span class="id">mul1R</span> <span class="id">mulR1</span>.<br/>
<span class="id">rewrite</span> <span class="id">mulRDl</span> <span class="id">mul1R</span> <span class="id">{2}pr_good</span> <span class="id">mulRC</span> <span class="id">mulRN</span>.<br/>
<span class="id">apply</span> (<span class="id">@Rplus_le_reg_l</span> (<span class="id">-</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span>)).<br/>
<span class="id">rewrite</span> <span class="id">addRA</span> (<span class="id">addRC</span> (<span class="id">-</span> <span class="id">_</span>)) <span class="id">addRN</span> <span class="id">add0R</span> <span class="id">mulRA</span>.<br/>
<span class="id">apply</span> <span class="id">leR_oppl</span>.<br/>
<span class="id">rewrite</span> <span class="id">oppRD</span> <span class="id">oppRK</span> <span class="id">/Pr</span> <span class="id">-</span>(<span class="id">mul1R</span> (<span class="id">-</span> <span class="id">_</span>)) <span class="id">mulRN</span> <span class="id">-mulNR</span> <span class="id">big_distrr</span> <span class="id">-big_split</span> <span class="id">-divRE/=</span>.<br/>
<span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_</span> <span class="id">do</span><br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">mulNR</span> <span class="id">mul1R</span> <span class="id">-{1}</span>(<span class="id">mul1R</span> (<span class="id">P</span> <span class="id">i</span>)) <span class="id">-mulNR</span> <span class="id">-Rmult_plus_distr_r</span> <span class="id">addR_opp</span>.<br/>
<span class="id">under</span> <span class="id">[X</span> <span class="gallina-kwd">in</span> <span class="id">_</span> <span class="id">&lt;=</span> <span class="id">_</span> <span class="id">/</span> <span class="id">_</span> <span class="id">*</span> <span class="id">X]eq_bigr</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">mulRC</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">[]</span>.<br/>
Qed.</div>
<br/>
<div class="doc md"> ## eqn page 63, line 4 </div>
<span class="vernacular">Lemma</span> <span class="id">bound_mean</span> <span class="id">:</span> <span class="id">invariant</span> <span class="id">-&gt;</span> (<span class="id">mu</span> <span class="id">-</span> <span class="id">mu_wave</span>)² <span class="id">&lt;=</span> <span class="id">var</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span> <span class="id">/</span> (<span class="id">2</span> <span class="id">-</span> <span class="id">eps</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof40')">Proof.</span></div>
<div class="proofscript" id="proof40">
<span class="id">move=&gt;</span> <span class="id">Hinv</span>.<br/>
<span class="id">unfold</span> <span class="id">eps_max</span> <span class="gallina-kwd">in</span> <span class="id">low_eps</span>.<br/>
<span class="id">have</span> <span class="id">-&gt;</span> <span class="id">:</span> <span class="id">mu</span> <span class="id">=</span> <span class="id">`E_[SX</span> <span class="id">|</span> <span class="id">good</span> <span class="id">`*</span> <span class="id">[set:</span> <span class="id">bool]]</span> <span class="gallina-kwd">by</span> <span class="id">exact:</span> <span class="id">Split.cEx</span>.<br/>
<span class="id">have</span> <span class="id">-&gt;</span> <span class="id">:</span> <span class="id">mu_wave</span> <span class="id">=</span> <span class="id">`E_[SX</span> <span class="id">|</span> <span class="id">good</span> <span class="id">`*</span> <span class="id">[set</span> <span class="id">true]]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/mu_wave</span> <span class="id">/emean_cond</span> <span class="id">!cExE</span> <span class="id">!divRE</span> <span class="id">!big_distrl/=</span> <span class="id">big_setX//=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/Pr</span> <span class="id">big_setX//=;</span> <span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">u</span> <span class="id">ugood</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">big_set1</span> <span class="id">/WP</span> <span class="id">/SP</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/WX</span> <span class="id">/SX</span> <span class="id">/Split</span>.<span class="id">fst_RV</span> <span class="id">/=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-!mulRA</span>.<br/>
&nbsp;&nbsp;<span class="id">congr</span> (<span class="id">X</span> <span class="id">u</span> <span class="id">*</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id">[in</span> <span class="id">RHS]eq_bigr</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">big_set1</span> <span class="id">Split.dE</span><span class="id">/=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Split.dE</span><span class="id">/=</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id">[in</span> <span class="id">LHS]eq_bigr</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">Weighted.dE</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-big_distrl/=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-divRE</span> <span class="id">Rdiv_mult_distr</span> <span class="id">divRE</span> <span class="id">invRK</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">mulRC</span> <span class="id">!mulRA;</span> <span class="id">congr</span> (<span class="id">_</span> <span class="id">*</span> <span class="id">/</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">Weighted.dE</span> <span class="id">mulRA</span> <span class="id">mulRAC</span> <span class="id">-divRE</span> <span class="id">divRR</span> <span class="id">?mul1R</span>.<br/>
<span class="id">rewrite</span> <span class="id">Rsqr_neg_minus</span>.<br/>
<span class="id">apply:</span> (<span class="id">@leR_trans</span> (<span class="id">`V_[</span> <span class="id">SX</span> <span class="id">|</span> <span class="id">good</span> <span class="id">`*</span> <span class="id">[set:</span> <span class="id">bool]]</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">1</span> <span class="id">-</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span> <span class="id">/</span> <span class="id">2</span>)<span class="id">%mcR</span>) <span class="id">/</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span> <span class="id">/</span> <span class="id">2</span>)<span class="id">%mcR</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">sqrt_le_0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id">exact:</span> <span class="id">Rle_0_sqr</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id">apply:</span> <span class="id">mulR_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="id">apply:</span> <span class="id">mulR_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span> <span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">[exact:</span> <span class="id">cvariance_ge0|lra]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-!coqRE</span> <span class="id">subRB</span> <span class="id">subRR</span> <span class="id">add0R;</span> <span class="id">exact:</span> <span class="id">divR_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">invR_ge0;</span> <span class="id">rewrite</span> <span class="id">-!coqRE</span> (<span class="id">_</span> <span class="id">:</span> <span class="id">2%:R</span> <span class="id">=</span> <span class="id">2</span>)<span class="id">//;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id">rewrite</span> <span class="id">sqrt_Rsqr_abs;</span> <span class="id">apply:</span> (<span class="id">cresilience</span> (<span class="id">delta</span> <span class="id">:=</span> <span class="id">1</span> <span class="id">-</span> <span class="id">eps</span> <span class="id">/</span> <span class="id">2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-!coqRE</span> (<span class="id">_</span> <span class="id">:</span> <span class="id">2%:R</span> <span class="id">=</span> <span class="id">2</span>)<span class="id">//;</span> <span class="id">nra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="id">have</span> <span class="id">:=</span> <span class="id">good_mass</span> <span class="id">Hinv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-!coqRE</span> <span class="id">=&gt;</span> <span class="id">/leR_trans;</span> <span class="id">apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/leR_eqVlt;</span> <span class="id">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/Pr</span> <span class="id">!big_setX/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">under</span> <span class="id">[X</span> <span class="gallina-kwd">in</span> <span class="id">_</span> <span class="id">=</span> <span class="id">X</span> <span class="id">*</span> <span class="id">_]eq_bigr</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">big_set1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">congr</span> (<span class="id">_</span> <span class="id">/</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">u</span> <span class="id">ugood</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/SP</span> <span class="id">Split.dE</span><span class="id">/=</span> <span class="id">mulRC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">u</span> <span class="id">ugood</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">setT_bool</span> <span class="id">big_setU1//=</span> <span class="id">?inE//</span> <span class="id">big_set1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/SP</span> <span class="id">!Split</span>.<span class="id">dE/=</span> <span class="id">-mulRDl</span> <span class="id">addRCA</span> <span class="id">addR_opp</span> <span class="id">subRR</span> <span class="id">addR0</span> <span class="id">mul1R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="id">apply</span> <span class="id">leR_sumRl</span> <span class="id">=&gt;</span> <span class="id">i;</span> <span class="id">rewrite</span> <span class="id">inE</span> <span class="id">=&gt;</span> <span class="id">/andP[igood</span> <span class="id">_]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span> <span class="gallina-kwd">by</span> <span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span> <span class="id">rewrite</span> <span class="id">Split.dE</span><span class="id">;</span> <span class="id">apply</span> <span class="id">mulR_ge0</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">case:</span> <span class="id">ifPn</span> <span class="id">=&gt;</span> <span class="id">_;</span> <span class="id">move:</span> (<span class="id">C01</span> <span class="id">i</span>.<span class="id">1</span>) <span class="id">=&gt;</span> <span class="id">[c0</span> <span class="id">c1]//;</span> <span class="id">apply</span> <span class="id">subR_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">inE</span> <span class="id">igood</span> <span class="id">in_setT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="id">apply/subsetP</span> <span class="id">=&gt;</span> <span class="id">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">!inE</span> <span class="id">=&gt;</span> <span class="id">/andP[-&gt;]</span>.<br/>
<span class="id">have</span> <span class="id">-&gt;</span> <span class="id">:</span> <span class="id">`V_[</span> <span class="id">SX</span> <span class="id">|</span> <span class="id">good</span> <span class="id">`*</span> <span class="id">[set:</span> <span class="id">bool]]</span> <span class="id">=</span> <span class="id">var</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/var</span> <span class="id">/cVar</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">-&gt;</span> <span class="id">:</span> <span class="id">`E_[</span> <span class="id">SX</span> <span class="id">|</span> (<span class="id">good</span> <span class="id">`*</span> <span class="id">[set:</span> <span class="id">bool]</span>)<span class="id">]</span> <span class="id">=</span> <span class="id">`E_[X</span> <span class="id">|</span> <span class="id">good]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply/esym;</span> <span class="id">exact:</span> <span class="id">Split.cEx</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply/esym;</span> <span class="id">exact:</span> <span class="id">Split.cEx</span>.<br/>
<span class="id">rewrite</span> <span class="id">!divRE</span> <span class="id">-</span>(<span class="id">mulRA</span> <span class="id">_</span> <span class="id">eps</span>) <span class="id">-</span>(<span class="id">mulRA</span> <span class="id">_</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">_</span>)).<br/>
<span class="id">apply</span> <span class="id">leR_wpmul2l</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">[exact:</span> <span class="id">cvariance_ge0|lra]</span>.<br/>
<span class="id">rewrite</span> <span class="id">-!coqRE</span> <span class="id">subRB</span> <span class="id">subRR</span> <span class="id">add0R</span>.<br/>
<span class="id">rewrite</span> <span class="id">-!divRE</span> <span class="id">-Rdiv_mult_distr</span> <span class="id">Rmult_minus_distr_l</span> <span class="id">mulR1</span>.<br/>
<span class="id">rewrite</span> <span class="id">Rmult_div_assoc</span> (<span class="id">mulRC</span> <span class="id">2</span>) <span class="id">-Rmult_div_assoc</span> <span class="id">divRR</span> <span class="id">?mulR1</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> (<span class="id">_</span> <span class="id">:</span> <span class="id">2%:R</span> <span class="id">=</span> <span class="id">2</span>)<span class="id">//;</span> <span class="id">exact:</span> <span class="id">Rle_refl</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply/eqP;</span> <span class="id">lra</span>.<br/>
Qed.</div>
<br/>
<div class="doc md"> ## lemma 1.4, page 5 (part 1) </div>
<span class="vernacular">Lemma</span> <span class="id">bound_mean_emean</span> <span class="id">:</span> <span class="id">invariant</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">`|mu</span> <span class="id">-</span> <span class="id">mu_hat|</span> <span class="id">&lt;=</span> <span class="id">sqrt</span> (<span class="id">var</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span> <span class="id">/</span> (<span class="id">2</span> <span class="id">-</span> <span class="id">eps</span>)) <span class="id">+</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sqrt</span> (<span class="id">var_hat</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span> <span class="id">/</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof41')">Proof.</span></div>
<div class="proofscript" id="proof41">
<span class="id">move=&gt;</span> <span class="id">IC</span>.<br/>
<span class="id">unfold</span> <span class="id">eps_max</span> <span class="gallina-kwd">in</span> <span class="id">low_eps</span>.<br/>
<span class="id">have</span> <span class="id">I1C</span> <span class="id">:</span> <span class="id">invariantW</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">lemma1_4_start</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
<span class="id">apply:</span> (<span class="id">@Rle_trans</span> <span class="id">_</span> (<span class="id">`|mu</span> <span class="id">-</span> <span class="id">mu_wave|</span> <span class="id">+</span> <span class="id">`|mu_hat</span> <span class="id">-</span> <span class="id">mu_wave|</span>)).<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">-&gt;</span> <span class="id">:</span> <span class="id">mu</span> <span class="id">-</span> <span class="id">mu_hat</span> <span class="id">=</span> (<span class="id">mu</span> <span class="id">-</span> <span class="id">mu_wave</span>) <span class="id">+</span> (<span class="id">mu_wave</span> <span class="id">-</span> <span class="id">mu_hat</span>) <span class="gallina-kwd">by</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">Rle_trans</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">Rabs_triang</span> <span class="id">_</span> <span class="id">_</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Rplus_le_compat_l</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">Rabs_minus_sym;</span> <span class="id">exact:</span> <span class="id">Rle_refl</span>.<br/>
<span class="id">have</span> <span class="id">?</span> <span class="id">:</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">eps</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-pr_bad;</span> <span class="id">apply</span> <span class="id">Pr_ge0</span>.<br/>
<span class="id">apply:</span> <span class="id">leR_add</span>.<br/>
<span class="id">-</span> <span class="id">rewrite</span> <span class="id">-</span>(<span class="id">geR0_norm</span> <span class="id">_</span> (<span class="id">sqrt_pos</span> <span class="id">_</span>))<span class="id">;</span> <span class="id">apply</span> <span class="id">Rsqr_le_abs_0;</span> <span class="id">rewrite</span> <span class="id">Rsqr_sqrt</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span> <span class="id">exact:</span> <span class="id">bound_mean</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span> <span class="id">rewrite</span> <span class="id">-!mulRA;</span> <span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">invR_ge0;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">[exact:</span> <span class="id">cvariance_ge0|lra]</span>.<br/>
<span class="id">-</span> <span class="id">rewrite</span> <span class="id">-</span>(<span class="id">geR0_norm</span> <span class="id">_</span> (<span class="id">sqrt_pos</span> <span class="id">_</span>))<span class="id">;</span> <span class="id">apply</span> <span class="id">Rsqr_le_abs_0;</span> <span class="id">rewrite</span> <span class="id">Rsqr_sqrt</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span> <span class="id">apply</span> <span class="id">bound_emean</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/invariantW</span> <span class="id">/filter1D_invW</span> <span class="id">-/WP</span> <span class="gallina-kwd">in</span> <span class="id">I1C;</span> <span class="id">apply/eqP;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span> <span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">invR_ge0;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-mulRA;</span> <span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">[exact:</span> <span class="id">variance_ge0|lra]</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">bounding_empirical_mean</span>.<br/>
<br/>
<div class="doc">WIP </div>
<span class="vernacular">Section</span> <span class="id">update</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>) (<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>).<br/>
<span class="vernacular">Hypotheses</span> (<span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>).<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">tau</span> <span class="id">:=</span> <span class="id">sq_dev</span> <span class="id">X</span> <span class="id">PC_neq0</span>.<br/>
<span class="vernacular">Let</span> <span class="id">tau_max</span> <span class="id">:=</span> <span class="id">sq_dev_max</span> <span class="id">X</span> <span class="id">PC_neq0</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">arg_tau_max</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">[arg</span> <span class="id">max_</span>(<span class="id">i</span> <span class="id">&gt;</span> (<span class="id">fdist_supp_choice</span> <span class="id">P</span>) <span class="gallina-kwd">in</span> <span class="id">[set:</span> <span class="id">U]</span>) <span class="id">tau</span> <span class="id">i]%O</span>.<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">update_ffun</span> <span class="id">:</span> <span class="id">{ffun</span> <span class="id">U</span> <span class="id">-&gt;</span> <span class="id">R}</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="id">[ffun</span> <span class="id">i</span> <span class="id">=&gt;</span> <span class="gallina-kwd">if</span> (<span class="id">tau_max</span> <span class="id">==</span> <span class="id">0</span>) <span class="id">||</span> (<span class="id">C</span> <span class="id">i</span> <span class="id">==</span> <span class="id">0</span>) <span class="gallina-kwd">then</span> <span class="id">0</span> <span class="gallina-kwd">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">C</span> <span class="id">i</span> <span class="id">*</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">tau</span> <span class="id">i</span> <span class="id">/</span> <span class="id">tau_max</span>)<span class="id">]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">update_pos_ffun</span> <span class="id">:</span> <span class="id">[forall</span> <span class="id">a,</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">update_ffun</span> <span class="id">a]%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof42')">Proof.</span></div>
<div class="proofscript" id="proof42">
<span class="id">apply/forallP=&gt;</span> <span class="id">u;</span> <span class="id">apply/RleP</span>.<br/>
<span class="id">rewrite</span> <span class="id">/update_ffun</span> <span class="id">ffunE</span>.<br/>
<span class="id">have</span> <span class="id">[_|/=]</span> <span class="id">:=</span> <span class="id">eqVneq</span> <span class="id">tau_max</span> <span class="id">0</span> <span class="id">=&gt;</span> <span class="id">//=</span>.<br/>
<span class="id">move/eqP;</span> <span class="id">rewrite</span> <span class="id">eqR_le</span> <span class="id">=&gt;</span> <span class="id">/boolp</span>.<span class="id">not_andP</span> <span class="id">[];</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">move/</span>(<span class="id">_</span> (<span class="id">sq_dev_max_ge0</span> <span class="id">_</span> <span class="id">_</span>)).<br/>
<span class="id">rewrite</span> <span class="id">-ltRNge</span> <span class="id">=&gt;</span> <span class="id">tau_max_gt0</span>.<br/>
<span class="id">case:</span> <span class="id">ifPn=&gt;</span> <span class="id">[|Cu0];</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">_</span>.<br/>
<span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">first</span> <span class="id">exact/RleP/nneg_finfun_ge0</span>.<br/>
<span class="id">rewrite</span> <span class="id">subR_ge0</span> <span class="id">leR_pdivr_mulr</span> <span class="id">//</span> <span class="id">mul1R</span>.<br/>
<span class="id">exact:</span> <span class="id">sq_dev_max_ge</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">update</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span> <span class="id">:=</span> <span class="id">mkNNFinfun</span> <span class="id">update_pos_ffun</span>.<br/>
<br/>
<span class="vernacular">End</span> <span class="id">update</span>.<br/>
<br/>
<div class="doc">part 2 of lemma 1.4 </div>
<span class="vernacular">Section</span> <span class="id">bounding_empirical_variance</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>) (<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>)<br/>
&nbsp;&nbsp;(<span class="id">good</span> <span class="id">:</span> <span class="id">{set</span> <span class="id">U}</span>) (<span class="id">eps</span> <span class="id">:</span> <span class="id">R</span>).<br/>
<span class="vernacular">Hypotheses</span> (<span class="id">C01</span> <span class="id">:</span> <span class="id">is_01</span> <span class="id">C</span>) (<span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>).<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">WP</span> <span class="id">:=</span> <span class="id">Weighted.d</span> <span class="id">PC_neq0</span>.<br/>
<span class="vernacular">Let</span> <span class="id">SP</span> <span class="id">:=</span> <span class="id">Split.d</span> <span class="id">P</span> <span class="id">C01</span>.<br/>
<span class="vernacular">Let</span> <span class="id">bad</span> <span class="id">:=</span> <span class="id">~:</span> <span class="id">good</span>.<br/>
<span class="vernacular">Let</span> <span class="id">eps_max</span> <span class="id">:=</span> <span class="id">1/16</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span> <span class="id">pr_bad</span> <span class="id">:</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">bad</span> <span class="id">=</span> <span class="id">eps</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">low_eps</span> <span class="id">:</span> <span class="id">eps</span> <span class="id">&lt;=</span> <span class="id">eps_max</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">eps0</span> <span class="id">:</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">eps</span><br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof43')">Proof.</span></div>
<div class="proofscript" id="proof43">
 <span class="id">rewrite</span> <span class="id">-pr_bad</span>. <span class="id">exact:</span> <span class="id">Pr_ge0</span>. Qed.</div>
<br/>
<span class="vernacular">Let</span> <span class="id">WX</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">WP</span> <span class="id">-&gt;</span> <span class="id">R}</span> <span class="id">:=</span> <span class="id">X</span>.<br/>
<span class="vernacular">Let</span> <span class="id">SX</span> <span class="id">:=</span> <span class="id">Split.fst_RV</span> <span class="id">C01</span> <span class="id">X</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">mu</span> <span class="id">:=</span> <span class="id">mean</span> <span class="id">X</span> <span class="id">good</span>.<br/>
<span class="vernacular">Let</span> <span class="id">var</span> <span class="id">:=</span> <span class="id">var</span> <span class="id">X</span> <span class="id">good</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">mu_hat</span> <span class="id">:=</span> <span class="id">emean</span> <span class="id">X</span> <span class="id">PC_neq0</span>.<br/>
<span class="vernacular">Let</span> <span class="id">var_hat</span> <span class="id">:=</span> <span class="id">evar</span> <span class="id">X</span> <span class="id">PC_neq0</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">tau</span> <span class="id">:=</span> <span class="id">sq_dev</span> <span class="id">X</span> <span class="id">PC_neq0</span>.<br/>
<span class="vernacular">Let</span> <span class="id">tau_max</span> <span class="id">:=</span> <span class="id">sq_dev_max</span> <span class="id">X</span> <span class="id">PC_neq0</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">invariant</span> <span class="id">:=</span> <span class="id">filter1D_inv</span> <span class="id">P</span> <span class="id">C</span> <span class="id">good</span> <span class="id">eps</span>.<br/>
<span class="vernacular">Let</span> <span class="id">invariantW</span> <span class="id">:=</span> <span class="id">filter1D_invW</span> <span class="id">good</span> <span class="id">eps</span> <span class="id">PC_neq0</span>.<br/>
<br/>
<div class="doc md"> ## lemma 1.4, page 5 (part 2) </div>
<div class="doc md"> ## eqn A.6--A.9, page 63 </div>
<span class="vernacular">Lemma</span> <span class="id">bound_empirical_variance_good</span> <span class="id">:</span> <span class="id">16</span> <span class="id">*</span> <span class="id">var</span> <span class="id">&lt;=</span> <span class="id">var_hat</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">invariant</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">good</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span> <span class="id">&lt;=</span> <span class="id">0</span>.<span class="id">25</span> <span class="id">*</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>) <span class="id">*</span> <span class="id">var_hat</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof44')">Proof.</span></div>
<div class="proofscript" id="proof44">
<span class="id">rewrite</span> <span class="id">/eps_max;</span> <span class="id">move</span> <span class="id">=&gt;</span> <span class="id">var16</span> <span class="id">IC</span>.<br/>
<span class="id">unfold</span> <span class="id">eps_max</span> <span class="gallina-kwd">in</span> <span class="id">low_eps</span>.<br/>
<span class="id">have</span> <span class="id">I1C</span> <span class="id">:</span> <span class="id">invariantW</span>. <span class="comment">(*&nbsp;todo:&nbsp;repeated,&nbsp;factor&nbsp;out&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">lemma1_4_start</span>.<br/>
<span class="id">have</span> <span class="id">Hvar_hat_2_eps:</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">var_hat</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-mulRA;</span> <span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">[exact:</span> <span class="id">variance_ge0|lra]</span>.<br/>
<span class="id">rewrite</span> <span class="id">/var_hat</span>.<br/>
<span class="id">have</span> <span class="id">PrPgoodpos</span> <span class="id">:</span> <span class="id">0</span> <span class="id">&lt;</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span> <span class="gallina-kwd">by</span> <span class="id">move:</span> <span class="id">pr_bad;</span> <span class="id">rewrite</span> <span class="id">Pr_of_cplt;</span> <span class="id">lra</span>.<br/>
<span class="comment">(*a6*)</span><br/>
<span class="id">apply</span> (<span class="id">@leR_trans</span> ((<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>) <span class="id">*</span> (<span class="id">var</span> <span class="id">+</span> (<span class="id">mu</span> <span class="id">-</span> <span class="id">mu_hat</span>)²))).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-!</span>(<span class="id">pr_good</span> <span class="id">pr_bad</span>) <span class="id">Rmult_comm</span> <span class="id">-leR_pdivr_mulr//;</span> <span class="id">apply:</span> <span class="id">eqn1_1</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">rewrite</span> <span class="id">pr_bad</span>.<br/>
<span class="comment">(*a6-a7*)</span><br/>
<span class="id">apply</span> (<span class="id">@leR_trans</span> ((<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>) <span class="id">*</span> (<span class="id">var</span> <span class="id">+</span> (<span class="id">sqrt</span> (<span class="id">var</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span> <span class="id">/</span> (<span class="id">2</span> <span class="id">-</span> <span class="id">eps</span>)) <span class="id">+</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sqrt</span> (<span class="id">var_hat</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span> <span class="id">/</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>)))²))).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_wpmul2l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-pr_bad</span> <span class="id">subR_ge0;</span> <span class="id">exact:</span> <span class="id">Pr_1</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/leR_add2l/Rsqr_le_abs_1</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">[x</span> <span class="gallina-kwd">in</span> <span class="id">_</span> <span class="id">&lt;=</span> <span class="id">x]geR0_norm;</span> <span class="id">first</span> <span class="id">exact:</span> <span class="id">bound_mean_emean</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/addR_ge0/sqrt_pos/sqrt_pos</span>.<br/>
<span class="comment">(*a7-a8*)</span><br/>
<span class="id">apply</span> (<span class="id">@leR_trans</span> ((<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>) <span class="id">*</span> <span class="id">var_hat</span> <span class="id">*</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">/16</span> <span class="id">+</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span> <span class="id">*</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">/</span> (<span class="id">4</span> <span class="id">*</span> <span class="id">sqrt</span> (<span class="id">2</span> <span class="id">-</span> <span class="id">eps</span>)) <span class="id">+</span> <span class="id">/</span> (<span class="id">sqrt</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>)))²))).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-</span>(<span class="id">mulRA</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_pmul2l;</span> <span class="id">first</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">mulRDr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_add;</span> <span class="id">first</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">2!mulRA</span> <span class="id">-</span>(<span class="id">Rsqr_sqrt</span> (<span class="id">var_hat</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span>))<span class="id">;</span> <span class="id">last</span> <span class="id">exact:</span> <span class="id">Hvar_hat_2_eps</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-Rsqr_mult</span> <span class="id">mulRDr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Rsqr_incr_1;</span> <span class="id">last</span> <span class="id">2</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">addR_ge0;</span> <span class="id">apply</span> <span class="id">sqrt_pos</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">addR_ge0;</span> <span class="id">apply:</span> <span class="id">mulR_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span> <span class="id">sqrt_pos</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">invR_ge0;</span> <span class="id">interval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span> <span class="id">sqrt_pos</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">invR_ge0;</span> <span class="id">interval</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">leR_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@leR_trans</span> (<span class="id">sqrt</span> (<span class="id">var_hat</span> <span class="id">*</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span> <span class="id">*</span> <span class="id">/</span> (<span class="id">4</span> <span class="id">*</span> <span class="id">4</span> <span class="id">*</span> (<span class="id">2</span> <span class="id">-</span> <span class="id">eps</span>)))))<span class="id">;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">sqrt_mult;</span> <span class="id">[|lra|apply:</span> <span class="id">invR_ge0;</span> <span class="id">lra]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">sqrt_inv//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">sqrt_mult</span> (<span class="id">4</span> <span class="id">*</span> <span class="id">4</span>))<span class="id">;</span> <span class="id">[|lra|lra]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-Rsqr_def</span> <span class="id">sqrt_Rsqr;</span> <span class="id">[exact:</span> <span class="id">Rle_refl|lra]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">sqrt_le_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span> <span class="id">rewrite</span> <span class="id">/Rdiv</span> <span class="id">-!mulRA;</span> <span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">first</span> <span class="id">exact:</span> <span class="id">cvariance_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">first</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">[lra|by</span> <span class="id">apply</span> <span class="id">invR_ge0;</span> <span class="id">lra]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span> <span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">first</span> <span class="id">exact:</span> <span class="id">Hvar_hat_2_eps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">[lra|left;apply</span> <span class="id">invR_gt0;lra]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span> <span class="id">rewrite</span> <span class="id">invRM;</span> <span class="id">[|by</span> <span class="id">apply/eqP;</span> <span class="id">lra</span>..<span class="id">]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">mulRC</span> (<span class="id">/</span> <span class="id">_</span>)) <span class="id">mulRA</span> (<span class="id">mulRC</span> <span class="id">_</span> (<span class="id">/</span> <span class="id">_</span>)) <span class="id">mulRA</span> <span class="id">mulRA</span> <span class="id">mulRA</span> <span class="id">/Rdiv</span> <span class="id">-4!mulRA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_pmul</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="id">exact:</span> <span class="id">cvariance_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="id">apply:</span> <span class="id">mulR_ge0;</span> <span class="id">first</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">mulR_ge0</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">apply:</span> <span class="id">invR_ge0;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">mulRC</span> <span class="id">/Rsqr;</span> <span class="gallina-kwd">by</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="id">exact:</span> <span class="id">Rle_refl</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-sqrt_inv</span> <span class="id">-sqrt_mult;</span> <span class="id">[|exact:</span> <span class="id">Hvar_hat_2_eps|by</span> <span class="id">apply:</span> <span class="id">invR_ge0;</span> <span class="id">lra]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">Rsqr_sqrt;</span> <span class="id">[by</span> <span class="id">right|nra]</span>.<br/>
<span class="comment">(*a8-a9*)</span><br/>
<span class="id">apply</span> (<span class="id">@leR_trans</span> ((<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>) <span class="id">*</span> <span class="id">var_hat</span> <span class="id">*</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">/16</span> <span class="id">+</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps_max</span> <span class="id">*</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Rsqr</span> (<span class="id">/</span> (<span class="id">4</span> <span class="id">*</span> <span class="id">sqrt</span> (<span class="id">2</span> <span class="id">-</span> <span class="id">eps_max</span>)) <span class="id">+</span> <span class="id">/sqrt</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps_max</span>))))).<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">leR_pmul</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">[lra|exact:</span> <span class="id">variance_ge0]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">addR_ge0;</span> <span class="id">[lra|apply:</span> <span class="id">mulR_ge0;</span> <span class="id">[lra|exact:</span> <span class="id">Rle_0_sqr]]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id">exact:</span> <span class="id">Rle_refl</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="id">apply</span> <span class="id">leR_add;</span> <span class="id">first</span> <span class="id">exact/Rle_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_pmul;</span> <span class="id">[lra|exact:</span> <span class="id">Rle_0_sqr|by</span> <span class="id">rewrite</span> <span class="id">/eps_max;</span> <span class="id">lra|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">Rsqr_bounds_le;</span> <span class="id">split;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">interval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="id">apply</span> <span class="id">mulR_gt0;</span> <span class="id">first</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">sqrt_lt_R0;</span> <span class="id">rewrite</span> <span class="id">/eps_max;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span> <span class="id">apply</span> <span class="id">leR_wpmul2l;</span> <span class="id">first</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">sqrt_le_1;</span> <span class="id">rewrite</span> <span class="id">/eps_max;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">sqrt_lt_R0;</span> <span class="id">rewrite</span> <span class="id">/eps_max;</span> <span class="id">lra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">sqrt_le_1;</span> <span class="id">rewrite</span> <span class="id">/eps_max;</span> <span class="id">lra</span>.<br/>
<span class="id">rewrite</span> <span class="id">mulRC</span> <span class="id">mulRA</span>.<br/>
<span class="id">apply:</span> <span class="id">leR_wpmul2r</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">first</span> <span class="id">exact:</span> <span class="id">variance_ge0</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">leR_wpmul2r;</span> <span class="id">[lra|rewrite</span> <span class="id">/eps_max;</span> <span class="id">interval]</span>.<br/>
Qed.</div>
<br/>
<div class="doc md"> ## eqn A.10--A.11, page 63 </div>
<span class="vernacular">Lemma</span> <span class="id">bound_empirical_variance_bad</span> <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">16</span> <span class="id">*</span> <span class="id">var</span> <span class="id">&lt;=</span> <span class="id">var_hat</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">0</span> <span class="id">&lt;</span> <span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">invariant</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">2/3</span> <span class="id">*</span> <span class="id">var_hat</span> <span class="id">&lt;=</span> <span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">bad</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof45')">Proof.</span></div>
<div class="proofscript" id="proof45">
<span class="id">rewrite</span> <span class="id">/eps_max;</span> <span class="id">move</span> <span class="id">=&gt;</span> <span class="id">var16</span> <span class="id">sumCi_pos</span> <span class="id">HiC</span>.<br/>
<span class="id">unfold</span> <span class="id">eps_max</span> <span class="gallina-kwd">in</span> <span class="id">low_eps</span>.<br/>
<span class="id">have</span> <span class="id">?</span> <span class="id">:</span> <span class="id">0</span> <span class="id">&lt;</span> <span class="id">Pr</span> <span class="id">P</span> <span class="id">good;</span> <span class="id">first</span> <span class="id">exact:</span> (<span class="id">pr_good_gt0</span> <span class="id">_</span> <span class="id">low_eps</span>).<br/>
<br/>
<span class="id">have</span> <span class="id">-&gt;:</span> <span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">bad</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span> <span class="id">=</span><br/>
&nbsp;&nbsp;<span class="id">var_hat</span> <span class="id">*</span> (<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>) <span class="id">-</span> (<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">good</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/var_hat</span> <span class="id">/evar</span> <span class="id">/Var</span> <span class="id">{1}/Ex</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">Rplus_eq_reg_r</span> (<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">good</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-addRA</span> <span class="id">Rplus_opp_l</span> <span class="id">addR0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/bad</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">-&gt;</span> <span class="id">:</span> <span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">~:</span> <span class="id">good</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span> <span class="id">+</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">good</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span> <span class="id">=</span> <span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-big_union/=;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">disjoints_subset</span> <span class="id">setCK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">setUC</span> <span class="id">setUCr/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">eq_bigl</span> <span class="id">=&gt;</span> <span class="id">//=</span> <span class="id">u;</span> <span class="id">rewrite</span> <span class="id">inE</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">big_distrl/=</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/tau</span> <span class="id">/mu_hat</span> <span class="id">/WP</span> <span class="id">Weighted.dE</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">mulRC</span> <span class="id">-mulRA;</span> <span class="id">congr</span> (<span class="id">_</span> <span class="id">*</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/Weighted</span>.<span class="id">total</span> <span class="id">-mulRA</span> <span class="id">Rinv_l</span> <span class="id">?mulR1//</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> <span class="id">Rgt_not_eq</span>.<br/>
<span class="id">apply</span> (<span class="id">@leR_trans</span> (<span class="id">var_hat</span> <span class="id">*</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">3</span> <span class="id">/</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span>) <span class="id">-</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">good</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span>))<span class="id">;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-!addR_opp;</span> <span class="id">apply:</span> <span class="id">Rplus_le_compat_r</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_wpmul2l;</span> <span class="id">first</span> <span class="id">exact:</span> <span class="id">variance_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@leR_trans</span> ((<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span> <span class="id">/</span> <span class="id">2</span>) <span class="id">*</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>)))<span class="id">;</span> <span class="id">first</span> <span class="id">nra</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">leR_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span> (<span class="id">@good_mass</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">C01</span> <span class="id">pr_bad</span> <span class="id">low_eps</span> <span class="id">HiC</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move/</span>(<span class="id">Rmult_le_compat_r</span> (<span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span>) <span class="id">_</span> <span class="id">_</span> (<span class="id">Pr_ge0</span> <span class="id">_</span> <span class="id">good</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-Rmult_div_swap</span> <span class="id">Rmult_div_l;</span> <span class="id">last</span> <span class="id">exact:</span> <span class="id">Rgt_not_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">Pr_to_cplt</span> <span class="id">pr_bad;</span> <span class="id">exact</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_sumRl</span> <span class="id">=&gt;</span> <span class="id">//i</span> <span class="id">igood</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span> <span class="id">exact:</span> <span class="id">Rle_refl</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">mulR_ge0</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">apply</span> (<span class="id">C01</span> <span class="id">_</span>).<span class="id">1</span>.<br/>
<span class="id">apply</span> (<span class="id">@leR_trans</span> ((<span class="id">1</span> <span class="id">-</span> <span class="id">3</span> <span class="id">/</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps</span> <span class="id">-</span> <span class="id">0</span>.<span class="id">25</span> <span class="id">*</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>)) <span class="id">*</span> <span class="id">var_hat</span>))<span class="id">;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">mulRBl</span> (<span class="id">mulRC</span> <span class="id">var_hat</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span> <span class="id">leR_add;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">Ropp_le_contravar;</span> <span class="id">exact:</span> <span class="id">bound_empirical_variance_good</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> <span class="id">Rle_refl</span>.<br/>
<span class="id">apply</span> (<span class="id">@leR_trans</span> ((<span class="id">1</span> <span class="id">-</span> <span class="id">3</span> <span class="id">/</span> <span class="id">2</span> <span class="id">*</span> <span class="id">eps_max</span> <span class="id">-</span> <span class="id">0</span>.<span class="id">25</span> <span class="id">*</span> (<span class="id">1</span> <span class="id">-</span> <span class="id">eps_max</span>)) <span class="id">*</span> <span class="id">var_hat</span>))<span class="id">;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">leR_wpmul2r;</span> <span class="id">first</span> <span class="id">exact:</span> <span class="id">variance_ge0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">/eps_max;</span> <span class="id">nra</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite/eps_max;</span> <span class="id">apply</span> <span class="id">leR_wpmul2r;</span> <span class="id">[exact:</span> <span class="id">variance_ge0|nra]</span>.<br/>
Qed.</div>
<br/>
<div class="doc md"> ## eqn 1.3--1.4, page 7 </div>
<span class="vernacular">Lemma</span> <span class="id">eqn1_3_4</span> (<span class="id">S</span> <span class="id">:</span> <span class="id">{set</span> <span class="id">U}</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span> <span class="id">C'</span> <span class="id">:=</span> <span class="id">update</span> <span class="id">X</span> <span class="id">PC_neq0</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">0</span> <span class="id">&lt;</span> <span class="id">tau_max</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">S</span>) (<span class="id">1</span> <span class="id">-</span> <span class="id">C'</span> <span class="id">i</span>) <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">S</span>) (<span class="id">1</span> <span class="id">-</span> <span class="id">C</span> <span class="id">i</span>) <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>) <span class="id">+</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">1</span> <span class="id">/</span> <span class="id">tau_max</span> <span class="id">*</span> (<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">S</span> ) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof46')">Proof.</span></div>
<div class="proofscript" id="proof46">
<span class="id">move</span> <span class="id">=&gt;</span> <span class="id">C'</span> <span class="id">tau_max_gt0</span>.<br/>
<span class="id">have</span> <span class="id">&lt;-</span> <span class="id">:</span> <span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">S</span>) (<span class="id">C</span> <span class="id">i</span> <span class="id">-</span> <span class="id">C'</span> <span class="id">i</span>) <span class="id">*</span> <span class="id">P</span> <span class="id">i=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">1</span> <span class="id">/</span> <span class="id">tau_max</span> <span class="id">*</span> (<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">S</span>) <span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span> <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/C'</span> <span class="id">/update</span> <span class="id">big_distrr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_</span> <span class="id">/=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/update_ffun</span> <span class="id">ffunE</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">[-&gt;|Ci-]</span> <span class="id">:=</span> <span class="id">eqVneq</span> (<span class="id">C</span> <span class="id">i</span>) <span class="id">0;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">orbT</span> <span class="id">subRR</span> <span class="id">!</span>(<span class="id">mulR0,mul0R</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">orbF</span> <span class="id">ifF;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">rewrite</span> (<span class="id">negbTE</span> (<span class="id">gtR_eqF</span> <span class="id">_</span> <span class="id">_</span> <span class="id">tau_max_gt0</span>))<span class="id">/=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/tau_max</span> <span class="id">/tau</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">field;</span> <span class="id">exact/eqP/gtR_eqF</span>.<br/>
<span class="id">rewrite</span> <span class="id">-big_split/=</span>.<br/>
<span class="id">apply</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">HiS</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-mulRDl</span> <span class="id">addRA</span> <span class="id">subRK</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">bounding_empirical_variance</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">filter1D_invariant_update</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>) (<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>)<br/>
&nbsp;&nbsp;(<span class="id">good</span> <span class="id">:</span> <span class="id">{set</span> <span class="id">U}</span>) (<span class="id">eps</span> <span class="id">:</span> <span class="id">R</span>).<br/>
<span class="vernacular">Hypothesis</span> <span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>.<br/>
<br/>
<span class="vernacular">Let</span> <span class="id">tau</span> <span class="id">:=</span> <span class="id">sq_dev</span> <span class="id">X</span> <span class="id">PC_neq0</span>.<br/>
<span class="vernacular">Let</span> <span class="id">tau_max</span> <span class="id">:=</span> <span class="id">sq_dev_max</span> <span class="id">X</span> <span class="id">PC_neq0</span>.<br/>
<br/>
<div class="doc md"> ## lemma 1.5, page 5, update preserves the invariant of filter1D </div>
<span class="vernacular">Lemma</span> <span class="id">filter1D_inv_update</span> <span class="id">:</span> <span class="gallina-kwd">let</span> <span class="id">C'</span> <span class="id">:=</span> <span class="id">update</span> <span class="id">X</span> <span class="id">PC_neq0</span> <span class="gallina-kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">0</span> <span class="id">&lt;</span> <span class="id">tau_max</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">good</span>) (<span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>) <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span> <span class="id">&lt;=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">1</span> <span class="id">-</span> <span class="id">eps</span>) <span class="id">/</span> <span class="id">2</span> <span class="id">*</span> (<span class="id">\sum_</span>(<span class="id">i</span> <span class="gallina-kwd">in</span> <span class="id">~:</span> <span class="id">good</span>) (<span class="id">C</span> <span class="id">i</span> <span class="id">*</span> <span class="id">P</span> <span class="id">i</span>) <span class="id">*</span> <span class="id">tau</span> <span class="id">i</span>) <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">filter1D_inv</span> <span class="id">P</span> <span class="id">C</span> <span class="id">good</span> <span class="id">eps</span> <span class="id">-&gt;</span> <span class="id">filter1D_inv</span> <span class="id">P</span> <span class="id">C'</span> <span class="id">good</span> <span class="id">eps</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof47')">Proof.</span></div>
<div class="proofscript" id="proof47">
<span class="id">rewrite</span> <span class="id">/filter1D_inv</span> <span class="id">=&gt;</span> <span class="id">tau_max_gt0</span> <span class="id">H1</span> <span class="id">H2</span>.<br/>
<span class="id">rewrite</span> <span class="id">!eqn1_3_4//</span> <span class="id">!mulRDr;</span> <span class="id">apply</span> <span class="id">leR_add;</span> <span class="id">first</span> <span class="id">exact</span> <span class="id">H2</span>.<br/>
<span class="id">rewrite</span> <span class="id">mulRCA</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">leR_pmul2l;</span> <span class="id">[exact/divR_gt0|exact:</span> <span class="id">H1]</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">filter1D_invariant_update</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">update_invariant</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>) (<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>).<br/>
<span class="vernacular">Hypothesis</span> <span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>.<br/>
<span class="vernacular">Hypothesis</span> <span class="id">C01</span> <span class="id">:</span> <span class="id">is_01</span> <span class="id">C</span>.<br/>
<br/>
<span class="vernacular">End</span> <span class="id">update_invariant</span>.<br/>
<br/>
<span class="vernacular">Section</span> <span class="id">base_case</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">A</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">A}</span>) (<span class="id">eps</span> <span class="id">:</span> <span class="id">R</span>) (<span class="id">good</span> <span class="id">:</span> <span class="id">{set</span> <span class="id">A}</span>).<br/>
<br/>
<span class="vernacular">Definition</span> <span class="id">ffun1</span> <span class="id">:</span> <span class="id">{ffun</span> <span class="id">A</span> <span class="id">-&gt;</span> <span class="id">R}</span> <span class="id">:=</span> <span class="id">[ffun=&gt;</span> <span class="id">1]</span>.<br/>
<span class="vernacular">Let</span> <span class="id">ffun1_subproof</span> <span class="id">:</span> <span class="id">[forall</span> <span class="id">a,</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">ffun1</span> <span class="id">a]%mcR</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof48')">Proof.</span></div>
<div class="proofscript" id="proof48">
 <span class="gallina-kwd">by</span> <span class="id">apply/forallP</span> <span class="id">=&gt;</span> <span class="id">u;</span> <span class="id">rewrite</span> <span class="id">ffunE;</span> <span class="id">apply/RleP</span>. Qed.</div>
<span class="vernacular">Definition</span> <span class="id">Cpos_ffun1</span> <span class="id">:=</span> <span class="id">@mkNNFinfun</span> <span class="id">A</span> <span class="id">ffun1</span> <span class="id">ffun1_subproof</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">PC1_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">Cpos_ffun1</span>  <span class="id">!=</span> <span class="id">0</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof49')">Proof.</span></div>
<div class="proofscript" id="proof49">
<span class="id">rewrite/Weighted</span>.<span class="id">total</span>.<br/>
<span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">/Cpos_ffun1/=/ffun1</span> <span class="id">ffunE</span> <span class="id">mul1R</span>.<br/>
<span class="id">rewrite</span> <span class="id">FDist.f1</span>.<br/>
<span class="id">apply</span> <span class="id">oner_neq0</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">C1_is01</span> <span class="id">:</span> <span class="id">is_01</span> <span class="id">Cpos_ffun1</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof50')">Proof.</span></div>
<div class="proofscript" id="proof50">
 <span class="gallina-kwd">by</span> <span class="id">move</span> <span class="id">=&gt;</span> <span class="id">i;</span> <span class="id">rewrite</span> <span class="id">ffunE;</span> <span class="id">lra</span>. Qed.</div>
<br/>
<span class="vernacular">Lemma</span> <span class="id">base_case:</span> <span class="id">Pr</span> <span class="id">P</span> (<span class="id">~:</span> <span class="id">good</span>) <span class="id">=</span> <span class="id">eps</span> <span class="id">-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">filter1D_inv</span> <span class="id">P</span> <span class="id">Cpos_ffun1</span> <span class="id">good</span> <span class="id">eps</span> <span class="id">/\</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">filter1D_invW</span> <span class="id">good</span> <span class="id">eps</span> <span class="id">PC1_neq0</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof51')">Proof.</span></div>
<div class="proofscript" id="proof51">
<span class="id">move=&gt;</span> <span class="id">Hbad_ratio;</span> <span class="id">rewrite</span> <span class="id">/filter1D_inv;</span> <span class="id">split</span>.<br/>
<span class="id">-</span> <span class="id">rewrite</span> <span class="id">/Cpos_fun</span> <span class="id">/=</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">ffunE</span> <span class="id">subRR</span> <span class="id">mul0R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">big1;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">[]</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">ffunE</span> <span class="id">subRR</span> <span class="id">mul0R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">big1;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">[]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">mulR0;</span> <span class="id">exact/RleP</span>.<br/>
<span class="id">-</span> <span class="id">rewrite</span> <span class="id">/filter1D_invW</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/Pr</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">Weighted.dE</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/Weighted</span>.<span class="id">total</span> <span class="id">/Cpos_ffun1/=</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id">eq_bigr</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">/ffun1</span> <span class="id">/=</span> <span class="id">ffunE</span> <span class="id">mul1R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">-big_distrl/=</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span> <span class="id">[in</span> <span class="id">X</span> <span class="gallina-kwd">in</span> <span class="id">_</span> <span class="id">&lt;=</span> <span class="id">_</span> <span class="id">*</span> <span class="id">/</span> <span class="id">X]eq_bigr</span> <span class="id">do</span> <span class="id">rewrite</span> <span class="id">/ffun1</span> <span class="id">/=</span> <span class="id">ffunE</span> <span class="id">mul1R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">FDist.f1</span> <span class="id">invR1</span> <span class="id">mulR1</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">-/</span>(<span class="id">Pr</span> <span class="id">P</span> <span class="id">good</span>) <span class="id">Pr_to_cplt</span> <span class="id">Hbad_ratio;</span> <span class="id">exact/RleP</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">End</span> <span class="id">base_case</span>.<br/>
<br/>
<div class="doc md"> ## Algorithm 2, page 4 </div>
<span class="vernacular">Section</span> <span class="id">filter1D</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">U</span> <span class="id">:</span> <span class="id">finType</span>) (<span class="id">P</span> <span class="id">:</span> <span class="id">{fdist</span> <span class="id">U}</span>) (<span class="id">X</span> <span class="id">:</span> <span class="id">{RV</span> <span class="id">P</span> <span class="id">-&gt;</span> <span class="id">R}</span>) (<span class="id">target_var</span> <span class="id">:</span> <span class="id">R</span>)<br/>
.<br/>
<span class="vernacular">Hypothesis</span> (<span class="id">pos_var</span> <span class="id">:</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">target_var</span>).<br/>
<br/>
<br/>
<span class="vernacular">Require</span> <span class="vernacular">Import</span> <span class="id">Program.Wf</span>.<br/>
<br/>
<span class="vernacular">Local</span> <span class="vernacular">Obligation</span> <span class="vernacular">Tactic</span> <span class="id">:=</span> <span class="id">idtac</span>.<br/>
<br/>
<span class="vernacular">Lemma</span> <span class="id">C01_update</span> (<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>) (<span class="id">PC_neq0</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>) <span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">is_01</span> <span class="id">C</span> <span class="id">-&gt;</span> <span class="id">is_01</span> (<span class="id">update</span> <span class="id">X</span> <span class="id">PC_neq0</span>).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof52')">Proof.</span></div>
<div class="proofscript" id="proof52">
<span class="id">move=&gt;</span> <span class="id">C01</span> <span class="id">u;</span> <span class="id">rewrite</span> <span class="id">/update/=;</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/RleP</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">/forallP</span> <span class="id">:=</span> <span class="id">update_pos_ffun</span> <span class="id">X</span> <span class="id">PC_neq0</span>.<br/>
&nbsp;&nbsp;<span class="id">exact</span>.<br/>
<span class="id">rewrite</span> <span class="id">/update_ffun</span> <span class="id">ffunE;</span> <span class="id">case:</span> <span class="id">ifPn</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
<span class="id">rewrite</span> <span class="id">negb_or</span> <span class="id">=&gt;</span> <span class="id">/andP[sq_dev_neq0</span> <span class="id">Cu_neq0]</span>.<br/>
<span class="id">move=&gt;</span> <span class="id">[:sq_gt0]</span>.<br/>
<span class="id">apply/RleP/mulr_ile1</span>.<br/>
<span class="id">-</span> <span class="id">exact/RleP/</span>(<span class="id">C01</span> <span class="id">u</span>).<span class="id">1</span>.<br/>
<span class="id">-</span> <span class="id">apply/RleP;</span> <span class="id">rewrite</span> <span class="id">subR_ge0</span> <span class="id">leR_pdivr_mulr//</span> <span class="id">?mul1R//;</span> <span class="id">last</span> <span class="id">first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">abstract:</span> <span class="id">sq_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply/ltR_neqAle;</span> <span class="id">split;</span> <span class="id">[exact/nesym/eqP|exact/sq_dev_max_ge0]</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> <span class="id">sq_dev_max_ge</span>.<br/>
<span class="id">-</span> <span class="id">exact/RleP/</span>(<span class="id">C01</span> <span class="id">u</span>).<span class="id">2</span>.<br/>
<span class="id">-</span> <span class="id">apply/RleP;</span> <span class="id">rewrite</span> <span class="id">leR_subl_addr</span> <span class="id">addRC</span> <span class="id">-leR_subl_addr</span> <span class="id">subRR</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply/divR_ge0</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">exact:</span> <span class="id">sq_dev_ge0</span>.<br/>
Qed.</div>
<br/>
<span class="id">Program</span> <span class="vernacular">Fixpoint</span> <span class="id">filter1D_rec</span> (<span class="id">C</span> <span class="id">:</span> <span class="id">nneg_finfun</span> <span class="id">U</span>) (<span class="id">C01</span> <span class="id">:</span> <span class="id">is_01</span> <span class="id">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">HC</span> <span class="id">:</span> <span class="id">Weighted.total</span> <span class="id">P</span> <span class="id">C</span> <span class="id">!=</span> <span class="id">0</span>) <span class="id">{measure</span> <span class="id">#|</span> <span class="id">0</span>.<span class="id">-support</span> <span class="id">C</span> <span class="id">|</span> <span class="id">}</span> <span class="id">:=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">Bool.bool_dec</span> (<span class="id">Rleb</span> (<span class="id">evar</span> <span class="id">X</span> <span class="id">HC</span>) (<span class="id">16</span> <span class="id">*</span> <span class="id">target_var</span> )) <span class="id">true</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">left</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">Some</span> (<span class="id">emean</span> <span class="id">X</span> <span class="id">HC</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span> <span class="id">right</span> <span class="id">K</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">#|</span> <span class="id">0</span>.<span class="id">-support</span> <span class="id">C</span> <span class="id">|</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">0</span> <span class="id">=&gt;</span> <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">_</span>.<span class="id">+1</span> <span class="id">=&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">match</span> <span class="id">Bool.bool_dec</span> (<span class="id">Weighted.total</span> <span class="id">P</span> (<span class="id">update</span> <span class="id">X</span> <span class="id">HC</span>) <span class="id">!=</span> <span class="id">0</span>) <span class="id">true</span> <span class="gallina-kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">right</span> <span class="id">_</span> <span class="id">=&gt;</span> <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span> <span class="id">left</span> <span class="id">H</span> <span class="id">=&gt;</span> <span class="id">filter1D_rec</span> (<span class="id">C01_update</span> <span class="id">HC</span> <span class="id">C01</span>) <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof53')">Next Obligation.</span></div>
<div class="proofscript" id="proof53">
<span class="id">rewrite/Weighted</span>.<span class="id">total=&gt;</span> <span class="id">C</span> <span class="id">C01</span> <span class="id">HCneq0</span> <span class="id">_</span> <span class="id">/=</span> <span class="id">evar16</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>.<br/>
<span class="id">apply/ssrnat</span>.<span class="id">ltP/proper_card/properP;</span> <span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/subsetP</span> <span class="id">=&gt;</span> <span class="id">u;</span> <span class="id">rewrite</span> <span class="id">!supportE</span> <span class="id">/update_ffun</span> <span class="id">ffunE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">case:</span> <span class="id">ifPn;</span> <span class="id">[rewrite</span> <span class="id">eqxx|rewrite</span> <span class="id">negb_or</span> <span class="id">=&gt;</span> <span class="id">/andP[]]</span>.<br/>
<span class="comment">(*&nbsp;here&nbsp;we&nbsp;should&nbsp;find&nbsp;the&nbsp;index&nbsp;of&nbsp;(sq_dev_max&nbsp;X&nbsp;HC).&nbsp;*)</span><br/>
<span class="id">have</span> <span class="id">HCge0</span> <span class="id">:</span> (<span class="id">\sum_</span>(<span class="id">a</span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id">C</span> <span class="id">a</span> <span class="id">*</span> <span class="id">P</span> <span class="id">a</span> <span class="id">&gt;=</span> <span class="id">0</span>)<span class="id">%mcR</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">sumr_ge0</span> <span class="id">=&gt;</span> <span class="id">i</span> <span class="id">_;</span> <span class="id">rewrite</span> <span class="id">mulr_ge0//;</span> <span class="id">apply/RleP;</span> <span class="id">exact</span> (<span class="id">C01</span> <span class="id">i</span>).<span class="id">1</span>.<br/>
<span class="id">have</span> <span class="id">h5</span> <span class="id">:</span> (<span class="id">0</span> <span class="id">&lt;</span> <span class="id">\sum_</span>(<span class="id">a</span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id">C</span> <span class="id">a</span> <span class="id">*</span> <span class="id">P</span> <span class="id">a</span>)<span class="id">%mcR</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">lt_neqAle</span> <span class="id">eq_sym</span> <span class="id">HCneq0</span> <span class="id">HCge0</span>.<br/>
<span class="id">move:</span> (<span class="id">h5</span>) <span class="id">=&gt;</span> <span class="id">/fsumr_gt0[u</span> <span class="id">_</span> <span class="id">/RltP]</span>.<br/>
<span class="id">rewrite</span> <span class="id">mulr_ge0_gt0//;</span> <span class="id">last</span> <span class="gallina-kwd">by</span> <span class="id">apply/RleP;</span> <span class="id">exact:</span> (<span class="id">C01</span> <span class="id">u</span>).<span class="id">1</span>.<br/>
<span class="id">move=&gt;</span> <span class="id">/andP[Cu0</span> <span class="id">Pu0]</span>.<br/>
<span class="id">have</span> <span class="id">Cmax_neq0</span> <span class="id">:</span> <span class="id">C</span> <span class="id">[arg</span> <span class="id">max_</span>(<span class="id">i</span> <span class="id">&gt;</span> <span class="id">u</span> <span class="id">|</span> <span class="id">C</span> <span class="id">i</span> <span class="id">!=</span> <span class="id">0</span>) <span class="id">sq_dev</span> <span class="id">X</span> <span class="id">HCneq0</span> <span class="id">i]%O</span> <span class="id">!=</span> <span class="id">0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">case:</span> <span class="id">arg_maxP</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">rewrite</span> <span class="id">gt_eqF</span>.<br/>
<span class="id">have</span> <span class="id">sq_dev_max_neq0</span> <span class="id">:</span> <span class="id">sq_dev_max</span> <span class="id">X</span> <span class="id">HCneq0</span> <span class="id">!=</span> <span class="id">0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/sq_dev_max</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span> <span class="id">evar16</span> <span class="id">=&gt;</span> <span class="id">/negP/RlebP/RleP;</span> <span class="id">rewrite</span> <span class="id">-ltNge</span> <span class="id">=&gt;</span> <span class="id">/RltP</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/evar</span> <span class="id">/Var</span> <span class="id">/sq_dev</span> <span class="id">/var</span> <span class="id">/emean</span> <span class="id">/Ex</span> <span class="id">=&gt;</span> <span class="id">h1</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;have&nbsp;h2&nbsp;:&nbsp;0&nbsp;&lt;=&nbsp;16&nbsp;*&nbsp;`V_[&nbsp;X&nbsp;|&nbsp;good]&nbsp;by&nbsp;apply&nbsp;mulR_ge0;&nbsp;[lra|exact:&nbsp;cvariance_ge0].&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">:</span> <span class="id">0</span> <span class="id">&lt;=</span> <span class="id">16</span> <span class="id">*</span> <span class="id">target_var</span> <span class="gallina-kwd">by</span> <span class="id">apply</span> <span class="id">mulR_ge0;</span> <span class="id">[lra|]</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span> <span class="id">/leR_ltR_trans</span> <span class="id">=&gt;</span> <span class="id">/</span>(<span class="id">_</span> <span class="id">_</span> <span class="id">h1</span>) <span class="id">/RltP</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span> <span class="id">/fsumr_gt0[i</span> <span class="id">_]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">Weighted.dE</span> <span class="id">=&gt;</span> <span class="id">/[dup]</span>.<br/>
&nbsp;&nbsp;<span class="id">move/pmulR_lgt0'</span> <span class="id">=&gt;</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">/[apply]</span> <span class="id">:=</span> <span class="id">pmulR_rgt0'</span> <span class="id">_</span> (<span class="id">sq_RV_ge0</span> (<span class="id">X</span> <span class="id">`-cst</span> <span class="id">\sum_</span>(<span class="id">v</span> <span class="gallina-kwd">in</span> <span class="id">U</span>) <span class="id">X</span> <span class="id">v</span> <span class="id">*</span> <span class="id">Weighted.d</span> <span class="id">HCneq0</span> <span class="id">v</span>) <span class="id">i</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/Weighted</span>.<span class="id">total</span>.<br/>
&nbsp;&nbsp;<span class="id">move/RltP</span> <span class="gallina-kwd">in</span> <span class="id">h5</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">/[apply]</span> <span class="id">:=</span> <span class="id">pmulR_lgt0'</span> <span class="id">_</span> (<span class="id">invR_ge0</span> <span class="id">_</span> <span class="id">h5</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">/RleP</span> <span class="id">Pige0</span> <span class="id">:=</span> <span class="id">FDist.ge0</span> <span class="id">P</span> <span class="id">i</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">/[apply]</span> <span class="id">Cigt0</span> <span class="id">:=</span> <span class="id">pmulR_lgt0'</span> <span class="id">_</span> <span class="id">Pige0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">gt_eqF//</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/RltP/bigmaxR_gt0;</span> <span class="gallina-kwd">exists</span> <span class="id">i;</span> <span class="id">split</span> <span class="id">=&gt;</span> <span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">gt_eqF//;</span> <span class="id">exact/RltP</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/h/mulR_ge0;</span> <span class="id">first</span> <span class="gallina-kwd">by</span> <span class="id">apply/mulR_ge0</span> <span class="id">=&gt;</span> <span class="id">//;</span> <span class="id">apply</span> (<span class="id">C01</span> <span class="id">_</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/invR_ge0/weighted_total_gt0</span>.<br/>
<span class="gallina-kwd">exists</span> <span class="id">[arg</span> <span class="id">max_</span>(<span class="id">i</span> <span class="id">&gt;</span> <span class="id">u</span> <span class="id">|</span> <span class="id">C</span> <span class="id">i</span> <span class="id">!=</span> <span class="id">0</span>) <span class="id">sq_dev</span> <span class="id">X</span> <span class="id">HCneq0</span> <span class="id">i]%O</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">rewrite</span> <span class="id">supportE</span>.<br/>
<span class="id">rewrite</span> <span class="id">/update_ffun</span> <span class="id">supportE</span> <span class="id">ffunE</span> <span class="id">negbK</span> <span class="id">ifF</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">!coqRE</span> <span class="id">mulf_eq0</span> <span class="id">subr_eq0</span> <span class="id">-invr1</span> <span class="id">-</span>(<span class="id">mul1r</span> (<span class="id">1^-1</span>))<span class="id">%mcR</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">eqr_div</span> <span class="id">?oner_eq0//</span> <span class="id">?mulr1</span> <span class="id">?mul1r//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> <span class="id">/sq_dev_max</span> <span class="id">bigmaxRE</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@bigmax_eq_arg</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">u</span>) <span class="id">?eq_refl</span> <span class="id">?orbT</span> <span class="id">?gt_eqF//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id">move=&gt;</span> <span class="id">i</span> <span class="id">_;</span> <span class="id">exact/RleP/sq_dev_ge0</span>.<br/>
<span class="gallina-kwd">by</span> <span class="id">rewrite</span> (<span class="id">negbTE</span> <span class="id">sq_dev_max_neq0</span>)<span class="id">/=;</span> <span class="id">exact/negbTE</span>.<br/>
Qed.</div>
<div><span class="toggleproof" onclick="toggleDisplay('proof54')">Next Obligation.</span></div>
<div class="proofscript" id="proof54">
<span class="gallina-kwd">by</span> <span class="id">apply:</span> <span class="id">well_founded_lt_compat</span> <span class="id">=&gt;</span> <span class="id">/=</span> <span class="id">x</span> <span class="id">y;</span> <span class="id">exact</span>.<br/>
Qed.</div>
<br/>
<span class="vernacular">Definition</span> <span class="id">filter1D</span> <span class="id">:=</span> <span class="id">@filter1D_rec</span> (<span class="id">Cpos_ffun1</span> <span class="id">U</span>) (<span class="id">@C1_is01</span> <span class="id">U</span>) (<span class="id">@PC1_neq0</span> <span class="id">_</span> <span class="id">_</span>).<br/>
<br/>
<span class="vernacular">End</span> <span class="id">filter1D</span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
</body>
</html>
